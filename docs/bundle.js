(()=>{"use strict";var t={};function r(t,r,e,i){return new(e||(e=Promise))((function(o,n){function a(t){try{c(i.next(t))}catch(t){n(t)}}function s(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){var r;t.done?o(t.value):(r=t.value,r instanceof e?r:new e((function(t){t(r)}))).then(a,s)}c((i=i.apply(t,r||[])).next())}))}function e(t,r){var e,i,o,n,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){a.label=n[1];break}if(6===n[0]&&a.label<o[1]){a.label=o[1],o=n;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(n);break}o[2]&&a.ops.pop(),a.trys.pop();continue}n=r.call(t,a)}catch(t){n=[6,t],i=0}finally{e=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var r;t.g.importScripts&&(r=t.g.location+"");var e=t.g.document;if(!r&&e&&(e.currentScript&&(r=e.currentScript.src),!r)){var i=e.getElementsByTagName("script");i.length&&(r=i[i.length-1].src)}if(!r)throw new Error("Automatic publicPath is not supported in this browser");r=r.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=r})(),t.p,t.p;var i,o,n,a,s,c=/\s+/;!function(t){t.WEBGL_CANVAS_ID="qrius-glCanvas",t.WEBGL_CONTEXT="webgl2",t.WEBGL_CONTEXT_EXPERIMENTAL="experimental-webgl",t.WEBGL_CONTEXT_WEBKIT="webkit-3d",t.WEBGL_CONTEXT_MOZ="moz-webgl",t.WEBGL_DEPTH_TEXTURE="WEBGL_depth_texture",t.WEBGL_CONTEXT_ERROR_MESSAGE="Could not initialise WebGL",t.WEBGL_DEPTH_TEXTUR_ERROR_MESSAGE="need WEBGL_depth_texture",t.PATH_ASSETS_OBJ="/webgl-3d-renderer/assets/resources/formula_1/source/formula_1.obj",t.PATH_ASSETS_TEXTURE="/webgl-3d-renderer/assets/resources/formula_1/textures/formula_1.png",t[t.DEPTH_TEXTURE_SIZE=512]="DEPTH_TEXTURE_SIZE"}(i||(i={})),function(t){t[t.NEAR_PLANE=.1]="NEAR_PLANE",t[t.FAR_PLANE=100]="FAR_PLANE",t[t.FIELD_OF_VIEW=45]="FIELD_OF_VIEW",t[t.MODE_FREE=0]="MODE_FREE",t[t.MODE_ORBIT=1]="MODE_ORBIT"}(o||(o={})),function(t){t.KEY_DOWN_EVENT="keydown",t.KEY_UP_EVENT="keyup",t[t.KEY_DOWN=40]="KEY_DOWN",t[t.KEY_UP=38]="KEY_UP",t[t.KEY_LEFT=37]="KEY_LEFT",t[t.KEY_RIGHT=39]="KEY_RIGHT",t.MOUSE_UP="mouseup",t.MOUSE_DOWN="mousedown",t.MOUSE_WHEEL="mousewheel",t.MOUSE_MOVE="mousemove",t[t.ROTATION_RATE=-300]="ROTATION_RATE",t[t.PAN_RATE=5]="PAN_RATE",t[t.ZOOM_RATE=200]="ZOOM_RATE"}(n||(n={})),function(t){t[t.DEFAULT_OFFSET=0]="DEFAULT_OFFSET",t[t.DEFAULT_STRIDE=0]="DEFAULT_STRIDE",t[t.GRID_VECTOR_SIZE=3]="GRID_VECTOR_SIZE",t[t.GRID_VERTEX_LEN=4]="GRID_VERTEX_LEN",t.ATTR_POSITION_NAME="a_position",t.ATTR_NORMAL_NAME="a_norm",t.ATTR_UV_NAME="a_texCoord",t.UNI_COLOR="u_color",t.UNI_MODEL_MAT="u_mVMatrix",t.UNI_PERSPECTIV_MAT="u_pMatrix",t.UNI_ORTHO_MAT="u_oMatrix",t.UNI_CAMERA_MAT="u_cameraViewMatrix",t.UNI_LIGHT_VIEW_CAMERA_MAT="u_lightViewCameraMatrix",t.UNI_REVERSE_LIGHT_DIRECTION_MAT="u_reverseLightDirection",t.UNI_TEXTURE_MAT="u_textureMatrix",t.UNI_DIFFUSE="u_diffuse",t.UNI_PROJECTED_TEXTURE="u_projectedTexture",t.UNI_LIGHT_AMBIENT="u_ambientLightColor",t.UNI_LIGHT_DIRECTION="u_lightDirection",t.UNI_LIGHT_POSITION="u_lightPosition",t.UNI_CAMERA_POSITION="u_cameraPosition",t.UNI_CAMERA_SHININESS="u_shininess",t.UNI_LIGHT_COLOR="u_lightColor",t.UNI_SPECULAR_COLOR="u_specularColor",t.UNI_SPECULAR_FACTOR="u_specularFactor",t.BUFFER_TYPE_ELEMENT_ARRAY="array_elements",t.BUFFER_TYPE_ARRAY="arrays"}(a||(a={})),function(t){t.V="v",t.VN="vn",t.VT="vt",t.F="f"}(s||(s={}));var u=function(t){return{vertices:t}},h=function(t,r,e){return{position:t,normal:r,uv:e}},l=function(t,r,e){return{x:t,y:r,z:e}},f=function(t){return t*Math.PI/180},m=function(t){var r=[t.red/255,t.green/255,t.blue/255,1];return new Float32Array(r)},p=function(){function t(t,r,e){this.x=t||0,this.y=r||0,this.z=e||0}return t.prototype.magnitude=function(t){if(void 0===t&&(t={x:0,y:0,z:0}),void 0===t)return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);var r=t.x-this.x,e=t.y-this.y,i=t.y-this.z;return Math.sqrt(r*r+e*e+i*i)},t.prototype.normalize=function(){var t=this.magnitude();return this.x/=t,this.y/=t,this.z/=t,this},t.prototype.set=function(t,r,e){return this.x=t,this.y=r,this.z=e,this},t.prototype.multiScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.getArray=function(){return[this.x,this.y,this.z]},t.prototype.getFloatArray=function(){return new Float32Array([this.x,this.y,this.z])},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t}(),_=function(){function t(){this.matrix=t.identity()}return t.prototype.vtranslate=function(r){return t.translate(this.matrix,r.x,r.y,r.z),this},t.prototype.translate=function(r,e,i){return t.translate(this.matrix,r,e,i),this},t.prototype.rotateY=function(r){return t.rotateY(this.matrix,r),this},t.prototype.rotateX=function(r){return t.rotateX(this.matrix,r),this},t.prototype.rotateZ=function(r){return t.rotateZ(this.matrix,r),this},t.prototype.vscale=function(r){return t.scale(this.matrix,r.x,r.y,r.z),this},t.prototype.scale=function(r,e,i){return t.scale(this.matrix,r,e,i),this},t.prototype.invert=function(){return t.invert(this.matrix),this},t.prototype.resetRotation=function(){for(var t=0;t<this.matrix.length;t++)t>=12&&t<=14||(this.matrix[t]=t%5==0?1:0);return this},t.prototype.resetMat=function(){for(var t=0;t<this.matrix.length;t++)this.matrix[t]=t%5==0?1:0;return this},t.identity=function(){var t=new Float32Array(16);return t[0]=t[5]=t[10]=t[15]=1,t},t.perspective=function(t,r,e,i,o){var n=1/Math.tan(r/2),a=1/(i-o);t[0]=n/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(o+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*i*a,t[15]=0},t.ortho=function(t,r,e,i,o,n,a){var s=1/(r-e),c=1/(i-o),u=1/(n-a);t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(r+e)*s,t[13]=(o+i)*c,t[14]=(a+n)*u,t[15]=1},t.lookAt=function(r,e,i,o){void 0===o&&(o=null),o=o||new Float32Array(16);var n=t.normalize(t.subtractVectors(r,e)),a=t.normalize(t.cross(i,n)),s=t.normalize(t.cross(n,a));return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=0,o[4]=s[0],o[5]=s[1],o[6]=s[2],o[7]=0,o[8]=n[0],o[9]=n[1],o[10]=n[2],o[11]=0,o[12]=r[0],o[13]=r[1],o[14]=r[2],o[15]=1,o},t.subtractVectors=function(t,r,e){return void 0===e&&(e=null),(e=e||new Float32Array(3))[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},t.cross=function(t,r,e){return void 0===e&&(e=null),(e=e||new Float32Array(3))[0]=t[1]*r[2]-t[2]*r[1],e[1]=t[2]*r[0]-t[0]*r[2],e[2]=t[0]*r[1]-t[1]*r[0],e},t.normalize=function(t,r){void 0===r&&(r=null),r=r||new Float32Array(3);var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return e>1e-5&&(r[0]=t[0]/e,r[1]=t[1]/e,r[2]=t[2]/e),r},t.transpose=function(t,r){if(t===r){var e=r[1],i=r[2],o=r[3],n=r[6],a=r[7],s=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=e,t[6]=r[9],t[7]=r[13],t[8]=i,t[9]=n,t[11]=r[14],t[12]=o,t[13]=a,t[14]=s}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t},t.normalMat3=function(t,r){var e=r[0],i=r[1],o=r[2],n=r[3],a=r[4],s=r[5],c=r[6],u=r[7],h=r[8],l=r[9],f=r[10],m=r[11],p=r[12],_=r[13],v=r[14],d=r[15],E=e*s-i*a,g=e*c-o*a,T=e*u-n*a,M=i*c-o*s,x=i*u-n*s,R=o*u-n*c,A=h*_-l*p,L=h*v-f*p,w=h*d-m*p,y=l*v-f*_,P=l*d-m*_,F=f*d-m*v,U=E*F-g*P+T*y+M*w-x*L+R*A;return U?(U=1/U,t[0]=(s*F-c*P+u*y)*U,t[1]=(c*w-a*F-u*L)*U,t[2]=(a*P-s*w+u*A)*U,t[3]=(o*P-i*F-n*y)*U,t[4]=(e*F-o*w+n*L)*U,t[5]=(i*w-e*P-n*A)*U,t[6]=(_*R-v*x+d*M)*U,t[7]=(v*T-p*R-d*g)*U,t[8]=(p*x-_*T+d*E)*U,t):null},t.multiplyVector=function(t,r){var e=r[0],i=r[1],o=r[2],n=r[3],a=t[0],s=t[1],c=t[2],u=t[3],h=t[4],l=t[5],f=t[6],m=t[7],p=t[8],_=t[9],v=t[10],d=t[11];return[e*a+i*h+o*p+n*t[12],e*s+i*l+o*_+n*t[13],e*c+i*f+o*v+n*t[14],e*u+i*m+o*d+n*t[15]]},t.transformVec4=function(t,r,e){return t[0]=e[0]*r[0]+e[4]*r[1]+e[8]*r[2]+e[12]*r[3],t[1]=e[1]*r[0]+e[5]*r[1]+e[9]*r[2]+e[13]*r[3],t[2]=e[2]*r[0]+e[6]*r[1]+e[10]*r[2]+e[14]*r[3],t[3]=e[3]*r[0]+e[7]*r[1]+e[11]*r[2]+e[15]*r[3],t},t.mult=function(t,r,e){var i=r[0],o=r[1],n=r[2],a=r[3],s=r[4],c=r[5],u=r[6],h=r[7],l=r[8],f=r[9],m=r[10],p=r[11],_=r[12],v=r[13],d=r[14],E=r[15],g=e[0],T=e[1],M=e[2],x=e[3];return t[0]=g*i+T*s+M*l+x*_,t[1]=g*o+T*c+M*f+x*v,t[2]=g*n+T*u+M*m+x*d,t[3]=g*a+T*h+M*p+x*E,g=e[4],T=e[5],M=e[6],x=e[7],t[4]=g*i+T*s+M*l+x*_,t[5]=g*o+T*c+M*f+x*v,t[6]=g*n+T*u+M*m+x*d,t[7]=g*a+T*h+M*p+x*E,g=e[8],T=e[9],M=e[10],x=e[11],t[8]=g*i+T*s+M*l+x*_,t[9]=g*o+T*c+M*f+x*v,t[10]=g*n+T*u+M*m+x*d,t[11]=g*a+T*h+M*p+x*E,g=e[12],T=e[13],M=e[14],x=e[15],t[12]=g*i+T*s+M*l+x*_,t[13]=g*o+T*c+M*f+x*v,t[14]=g*n+T*u+M*m+x*d,t[15]=g*a+T*h+M*p+x*E,t},t.scale=function(t,r,e,i){return t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t[4]*=e,t[5]*=e,t[6]*=e,t[7]*=e,t[8]*=i,t[9]*=i,t[10]*=i,t[11]*=i,t},t.rotateY=function(t,r){var e=Math.sin(r),i=Math.cos(r),o=t[0],n=t[1],a=t[2],s=t[3],c=t[8],u=t[9],h=t[10],l=t[11];return t[0]=o*i-c*e,t[1]=n*i-u*e,t[2]=a*i-h*e,t[3]=s*i-l*e,t[8]=o*e+c*i,t[9]=n*e+u*i,t[10]=a*e+h*i,t[11]=s*e+l*i,t},t.rotateX=function(t,r){var e=Math.sin(r),i=Math.cos(r),o=t[4],n=t[5],a=t[6],s=t[7],c=t[8],u=t[9],h=t[10],l=t[11];return t[4]=o*i+c*e,t[5]=n*i+u*e,t[6]=a*i+h*e,t[7]=s*i+l*e,t[8]=c*i-o*e,t[9]=u*i-n*e,t[10]=h*i-a*e,t[11]=l*i-s*e,t},t.rotateZ=function(t,r){var e=Math.sin(r),i=Math.cos(r),o=t[0],n=t[1],a=t[2],s=t[3],c=t[4],u=t[5],h=t[6],l=t[7];return t[0]=o*i+c*e,t[1]=n*i+u*e,t[2]=a*i+h*e,t[3]=s*i+l*e,t[4]=c*i-o*e,t[5]=u*i-n*e,t[6]=h*i-a*e,t[7]=l*i-s*e,t},t.rotate=function(t,r,e){var i,o,n,a,s,c,u,h,l,f,m,p,_,v,d,E,g,T,M,x,R,A,L,w,y=e[0],P=e[1],F=e[2],U=Math.sqrt(y*y+P*P+F*F);if(Math.abs(U)<1e-6)return null;y*=U=1/U,P*=U,F*=U,i=Math.sin(r),n=1-(o=Math.cos(r)),a=t[0],s=t[1],c=t[2],u=t[3],h=t[4],l=t[5],f=t[6],m=t[7],p=t[8],_=t[9],v=t[10],d=t[11],E=y*y*n+o,g=P*y*n+F*i,T=F*y*n-P*i,M=y*P*n-F*i,x=P*P*n+o,R=F*P*n+y*i,A=y*F*n+P*i,L=P*F*n-y*i,w=F*F*n+o,t[0]=a*E+h*g+p*T,t[1]=s*E+l*g+_*T,t[2]=c*E+f*g+v*T,t[3]=u*E+m*g+d*T,t[4]=a*M+h*x+p*R,t[5]=s*M+l*x+_*R,t[6]=c*M+f*x+v*R,t[7]=u*M+m*x+d*R,t[8]=a*A+h*L+p*w,t[9]=s*A+l*L+_*w,t[10]=c*A+f*L+v*w,t[11]=u*A+m*L+d*w},t.invert=function(t,r){void 0===r&&(r=t);var e=r[0],i=r[1],o=r[2],n=r[3],a=r[4],s=r[5],c=r[6],u=r[7],h=r[8],l=r[9],f=r[10],m=r[11],p=r[12],_=r[13],v=r[14],d=r[15],E=e*s-i*a,g=e*c-o*a,T=e*u-n*a,M=i*c-o*s,x=i*u-n*s,R=o*u-n*c,A=h*_-l*p,L=h*v-f*p,w=h*d-m*p,y=l*v-f*_,P=l*d-m*_,F=f*d-m*v,U=E*F-g*P+T*y+M*w-x*L+R*A;return!!U&&(U=1/U,t[0]=(s*F-c*P+u*y)*U,t[1]=(o*P-i*F-n*y)*U,t[2]=(_*R-v*x+d*M)*U,t[3]=(f*x-l*R-m*M)*U,t[4]=(c*w-a*F-u*L)*U,t[5]=(e*F-o*w+n*L)*U,t[6]=(v*T-p*R-d*g)*U,t[7]=(h*R-f*T+m*g)*U,t[8]=(a*P-s*w+u*A)*U,t[9]=(i*w-e*P-n*A)*U,t[10]=(p*x-_*T+d*E)*U,t[11]=(l*T-h*x-m*E)*U,t[12]=(s*L-a*y-c*A)*U,t[13]=(e*y-i*L+o*A)*U,t[14]=(_*g-p*M-v*E)*U,t[15]=(h*M-l*g+f*E)*U,!0)},t.translate=function(t,r,e,i){t[12]=t[0]*r+t[4]*e+t[8]*i+t[12],t[13]=t[1]*r+t[5]*e+t[9]*i+t[13],t[14]=t[2]*r+t[6]*e+t[10]*i+t[14],t[15]=t[3]*r+t[7]*e+t[11]*i+t[15]},t}();const v=function(){function t(){this.position=new p(0,0,0),this.scale=new p(1,1,1),this.rotation=new p(0,0,0),this.matView=new _,this.matNormal=new Float32Array(9),this.forward=new Float32Array(4),this.up=new Float32Array(4),this.right=new Float32Array(4)}return t.prototype.updateMatrix=function(){return this.matView.resetMat().vtranslate(this.position).rotateX(f(this.rotation.x)).rotateY(f(this.rotation.y)).rotateZ(f(this.rotation.z)).vscale(this.scale),_.normalMat3(this.matNormal,this.matView.matrix),_.transformVec4(this.forward,[0,0,1,0],this.matView.matrix),_.transformVec4(this.up,[0,1,0,0],this.matView.matrix),_.transformVec4(this.right,[1,0,0,0],this.matView.matrix),this.matView.matrix},t.prototype.updateDirection=function(){return _.transformVec4(this.forward,[0,0,1,0],this.matView.matrix),_.transformVec4(this.up,[0,1,0,0],this.matView.matrix),_.transformVec4(this.right,[1,0,0,0],this.matView.matrix),this},t.prototype.getModelMatrix=function(){return this.matView.matrix},t.prototype.getNormalMatrix=function(){return this.matNormal},t.prototype.reset=function(){this.position.set(0,0,0),this.scale.set(1,1,1),this.rotation.set(0,0,0)},t}();var d=function(){function t(r,e,i,n){void 0===e&&(e=o.FIELD_OF_VIEW),void 0===i&&(i=o.NEAR_PLANE),void 0===n&&(n=o.FAR_PLANE),this.perspectiveProjection=new Float32Array(16),this.orthoProjection=new Float32Array(16);var a=r.canvas.width/r.canvas.height,s=-r.canvas.width/2,c=r.canvas.width/2,u=r.canvas.height/2,h=-r.canvas.height/2;_.perspective(this.perspectiveProjection,e,a,i,n),_.ortho(this.orthoProjection,s,c,h,u,1,10),this.transform=new v,this.viewMatrix=new Float32Array(16),this.mode=t.MODE_ORBIT}return t.prototype.panX=function(r){this.mode!=t.MODE_ORBIT&&(this.updateViewMatrix(),this.transform.position.x+=this.transform.right[0]*r,this.transform.position.y+=this.transform.right[1]*r,this.transform.position.z+=this.transform.right[2]*r)},t.prototype.panY=function(r){this.updateViewMatrix(),this.transform.position.y+=this.transform.up[1]*r,this.mode!=t.MODE_ORBIT&&(this.transform.position.x+=this.transform.up[0]*r,this.transform.position.z+=this.transform.up[2]*r)},t.prototype.panZ=function(r){this.updateViewMatrix(),this.mode==t.MODE_ORBIT?this.transform.position.z+=r:(this.transform.position.x+=this.transform.forward[0]*r,this.transform.position.y+=this.transform.forward[1]*r,this.transform.position.z+=this.transform.forward[2]*r)},t.prototype.updateViewMatrix=function(){return this.mode==t.MODE_FREE?this.transform.matView.resetMat().vtranslate(this.transform.position).rotateX(f(this.transform.rotation.x)).rotateY(f(this.transform.rotation.y)):this.transform.matView.resetMat().rotateX(f(this.transform.rotation.x)).rotateY(f(this.transform.rotation.y)).vtranslate(this.transform.position),this.transform.updateDirection(),_.invert(this.viewMatrix,this.transform.matView.matrix),this.viewMatrix},t.MODE_FREE=o.MODE_FREE,t.MODE_ORBIT=o.MODE_ORBIT,t}(),E=function(){function t(t,r){var e=this,i=t.canvas.getBoundingClientRect();this.canvas=t.canvas,this.camera=r,this.rotateRate=n.ROTATION_RATE,this.panRate=n.PAN_RATE,this.zoomRate=n.ZOOM_RATE,this.offsetX=i.left,this.offsetY=i.top,this.initX=0,this.initY=0,this.prevX=0,this.prevY=0,this.onUpHandler=function(t){return e.onMouseUp(t)},this.onMoveHandler=function(t){return e.onMouseMove(t)},this.canvas.addEventListener(n.MOUSE_DOWN,(function(t){return e.onMouseDown(t)})),this.canvas.addEventListener(n.MOUSE_WHEEL,(function(t){return e.onMouseWheel(t)}))}return t.prototype.getMouseVec2=function(t){return{x:t.pageX-this.offsetX,y:t.pageY-this.offsetY}},t.prototype.onMouseDown=function(t){this.initX=this.prevX=t.pageX-this.offsetX,this.initY=this.prevY=t.pageY-this.offsetY,this.canvas.addEventListener(n.MOUSE_UP,this.onUpHandler),this.canvas.addEventListener(n.MOUSE_MOVE,this.onMoveHandler)},t.prototype.onMouseUp=function(t){this.canvas.removeEventListener(n.MOUSE_UP,this.onUpHandler),this.canvas.removeEventListener(n.MOUSE_MOVE,this.onMoveHandler)},t.prototype.onMouseWheel=function(t){var r=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));this.camera.panZ(-r*(this.zoomRate/this.canvas.height))},t.prototype.onMouseMove=function(t){var r=t.pageX-this.offsetX,e=t.pageY-this.offsetY,i=r-this.prevX,o=e-this.prevY;t.shiftKey?(this.camera.panX(-i*(this.panRate/this.canvas.width)),this.camera.panY(o*(this.panRate/this.canvas.height))):(this.camera.transform.rotation.y+=i*(this.rotateRate/this.canvas.width),this.camera.transform.rotation.x+=o*(this.rotateRate/this.canvas.height)),this.prevX=r,this.prevY=e},t}();const g=function(){function t(t){var r,e,o,n,a,s,c;this.gl=null,this.rgb_32_bit=255,this.alpha=1;var u=document.getElementById(t);this.gl=u.getContext(i.WEBGL_CONTEXT),null!==(r=this.gl)&&void 0!==r||alert(i.WEBGL_CONTEXT_ERROR_MESSAGE),null===(e=this.gl)||void 0===e||e.cullFace(this.gl.BACK),null===(o=this.gl)||void 0===o||o.frontFace(this.gl.CCW),null===(n=this.gl)||void 0===n||n.enable(this.gl.DEPTH_TEST),null===(a=this.gl)||void 0===a||a.enable(this.gl.CULL_FACE),null===(s=this.gl)||void 0===s||s.depthFunc(this.gl.LEQUAL),null===(c=this.gl)||void 0===c||c.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.canvas=u}return t.prototype.setSize=function(t,r){var e;return this.canvas.style.width=t+"px",this.canvas.style.height=r+"px",this.canvas.width=t,this.canvas.height=r,null===(e=this.gl)||void 0===e||e.viewport(0,0,t,r),this},t.prototype.depthRender=function(t){var r,e,i,o,n,a;return null===(r=this.gl)||void 0===r||r.bindFramebuffer(null===(e=this.gl)||void 0===e?void 0:e.FRAMEBUFFER,t.depthFramebuffer),null===(i=this.gl)||void 0===i||i.viewport(0,0,t.depthTextureSize,t.depthTextureSize),null===(o=this.gl)||void 0===o||o.clear((null===(n=this.gl)||void 0===n?void 0:n.COLOR_BUFFER_BIT)|(null===(a=this.gl)||void 0===a?void 0:a.DEPTH_BUFFER_BIT)),this},t.prototype.fitScreen=function(t,r){return this.setSize(window.innerWidth*(t||1),window.innerHeight*(r||1))},t.prototype.setClearColor=function(t,r,e,i){var o;return void 0===i&&(i=1),null===(o=this.gl)||void 0===o||o.clearColor(t/this.rgb_32_bit,r/this.rgb_32_bit,e/this.rgb_32_bit,i),this},t.prototype.clearFramebuffer=function(){var t,r;return null===(t=this.gl)||void 0===t||t.bindFramebuffer(null===(r=this.gl)||void 0===r?void 0:r.FRAMEBUFFER,null),this},t.prototype.clear=function(){var t,r,e;return null===(t=this.gl)||void 0===t||t.clear((null===(r=this.gl)||void 0===r?void 0:r.COLOR_BUFFER_BIT)|(null===(e=this.gl)||void 0===e?void 0:e.DEPTH_BUFFER_BIT)),this},t.prototype.getContext=function(){return this.gl},t}(),T=function(){function t(t,r,e,i,o,n){void 0===r&&(r=m({red:255,green:255,blue:255})),void 0===e&&(e=m({red:10,green:10,blue:10})),void 0===i&&(i=m({red:195,green:210,blue:190})),void 0===o&&(o=5),void 0===n&&(n=500),this.lightPosition=t,this.lightColor=r,this.ambientLightColor=e,this.specularColor=i,this.specularFactor=o,this.shininess=n}return t.prototype.setUniforms=function(t,r){t.uniform3fv(r.lightPositionLoc,[this.lightPosition.x,this.lightPosition.y,this.lightPosition.z]),t.uniform4fv(r.lightColorLoc,this.lightColor),t.uniform4fv(r.ambientLightColorLoc,this.ambientLightColor),t.uniform4fv(r.specularColorLoc,this.specularColor),t.uniform1f(r.specularFactorLoc,this.specularFactor),t.uniform1f(r.shininessLoc,this.shininess)},t}(),M=function(){function t(t,r,e){this.gl=null,this.vertexShader=null,this.fragmentShader=null;var i=this.createShader(t,t.VERTEX_SHADER,r),o=this.createShader(t,t.FRAGMENT_SHADER,e),n=this.createShaderProgram(t,o,i);this.program=n,this.gl=t}return t.prototype.createShader=function(t,r,e){var i=t.createShader(r);return t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(console.error("An error occurred compiling the shaders: "+t.getShaderInfoLog(i)),t.deleteShader(i),null)},t.prototype.createShaderProgram=function(t,r,e){var i=t.createProgram();if(t.attachShader(i,r),t.attachShader(i,e),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw console.error("Error creating shader program.",t.getProgramInfoLog(i)),t.deleteProgram(i),new Error("Failed to link shaderProgram");return this.vertexShader=r,this.fragmentShader=e,t.detachShader(i,r),t.detachShader(i,e),t.deleteShader(e),t.deleteShader(r),i},t.prototype.activateShader=function(){return this.gl.useProgram(this.program),this},t.prototype.deactivateShader=function(){return this.gl.useProgram(null),this},t.prototype.dispose=function(){this.gl.getParameter(this.gl.CURRENT_PROGRAM)===this.program&&this.deactivateShader(),this.gl.deleteProgram(this.program)},t.prototype.renderModel=function(t){var r=this.gl;return t.mesh.noCulling&&r.disable(r.CULL_FACE),t.mesh.doBlending&&r.enable(r.BLEND),r.drawArrays(t.mesh.drawMode,0,t.mesh.vertexCount),t.mesh.noCulling&&r.enable(r.CULL_FACE),t.mesh.doBlending&&r.disable(r.BLEND),this},t}(),x=function(){function t(t){this.mesh=t,this.transform=new v}return t.prototype.setScale=function(t,r,e){return this.transform.scale.set(t,r,e),this},t.prototype.setPosition=function(t,r,e){return this.transform.position.set(t,r,e),this},t.prototype.setRotation=function(t,r,e){return this.transform.rotation.set(t,r,e),this},t.prototype.addScale=function(t,r,e){return this.transform.scale.x+=t,this.transform.scale.y+=r,this.transform.scale.y+=r,this},t.prototype.addPosition=function(t,r,e){return this.transform.position.x+=t,this.transform.position.y+=r,this.transform.position.z+=e,this},t.prototype.addRotation=function(t,r,e){return this.transform.rotation.x+=t,this.transform.rotation.y+=r,this.transform.rotation.z+=e,this},t.prototype.preRender=function(){return this.transform.updateMatrix(),this},t}(),R=function(){function t(t,r,e,i){switch(this.buffer=t.createBuffer(),i){case a.BUFFER_TYPE_ARRAY:t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW);break;case a.BUFFER_TYPE_ELEMENT_ARRAY:t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),t.STATIC_DRAW);break;default:t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW)}this.gl=t,this.size=r.length/e}return t.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)},t.prototype.bindToAttribute=function(t,r,e,i,o){void 0===i&&(i=this.size),void 0===o&&(o=a.BUFFER_TYPE_VERTICES);var n=this.gl;switch(o){case a.BUFFER_TYPE_ARRAY:n.enableVertexAttribArray(t),n.bindBuffer(n.ARRAY_BUFFER,this.buffer),n.vertexAttribPointer(t,i,n.FLOAT,!1,r,e),n.bindBuffer(n.ARRAY_BUFFER,null);break;case a.BUFFER_TYPE_ELEMENT_ARRAY:n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null);break;default:n.enableVertexAttribArray(t),n.bindBuffer(n.ARRAY_BUFFER,this.buffer),n.vertexAttribPointer(t,i,n.FLOAT,!1,r,e),n.bindBuffer(n.ARRAY_BUFFER,null)}},t}();var A=function(){function t(t,r){var e=new M(t,"#version 300 es\n\t\t\tlayout(location=8) in vec3 a_position;\n\n\t\t\tuniform mat4 u_mVMatrix;\n\t\t\tuniform mat4 u_cameraViewMatrix;\n\t\t\tuniform mat4 u_oMatrix;\n\n\t\t\tmat4 m_worldMatrix;\n\t\t\tmat4 m_viewProjectionMatrix;\n\t\t\tmat4 m_worldViewProjectionMatrix;\n\n\t\t\tvoid main(void){\n\n\t\t\t\tm_worldMatrix = u_mVMatrix;\n\t\t\t\tm_viewProjectionMatrix = u_oMatrix * u_cameraViewMatrix;\n\t\t\t\tm_worldViewProjectionMatrix = m_viewProjectionMatrix * m_worldMatrix;\n\n\t\t\t\tgl_Position = m_worldViewProjectionMatrix * vec4(a_position, 1.0);\n\t\t\t}","#version 300 es\n\t\t\tprecision mediump float;\n\t\t\tuniform vec4 u_color;\n\n\t\t\tout vec4 finalColor;\n\n\t\t\tvoid main(void) {\n\t\t\t\tfinalColor = u_color;\n\t\t\t}");e.activateShader(),this.positionLoc=t.getAttribLocation(e.program,a.ATTR_POSITION_NAME),this.modelViewMatrixLoc=t.getUniformLocation(e.program,a.UNI_MODEL_MAT),this.orthoMatrixLoc=t.getUniformLocation(e.program,a.UNI_ORTHO_MAT),this.cameraMatrixLoc=t.getUniformLocation(e.program,a.UNI_CAMERA_MAT),this.uColorLoc=t.getUniformLocation(e.program,a.UNI_COLOR),this.orthoProjectionMatrix=r.orthoProjection,this.viewModelMatrix=r.viewMatrix,this.shaderProgram=e,e.deactivateShader()}return t.prototype.setUniforms=function(t,r){return this.shaderProgram.activateShader(),t.uniformMatrix4fv(this.orthoMatrixLoc,!1,this.orthoProjectionMatrix),t.uniformMatrix4fv(this.cameraMatrixLoc,!1,this.viewModelMatrix),t.uniformMatrix4fv(this.modelViewMatrixLoc,!1,r.transform.getModelMatrix()),t.uniform4fv(this.uColorLoc,new Float32Array([0,0,0,1])),this},t}(),L=function(){function t(){}return t.createGeometry=function(r,e,i){return new x(t.createMesh(r,e,i))},t.createMesh=function(t,r,e){var i,o=e.vertexCount(),n={positions:new R(t,e.positions(),o,a.BUFFER_TYPE_ARRAY),drawMode:t.TRIANGLES,vertexCount:o};return null===(i=n.positions)||void 0===i||i.bindToAttribute(r.positionLoc,a.DEFAULT_STRIDE,a.DEFAULT_OFFSET),n},t}(),w=function(){function t(t,r,e){var i=new M(t,"#version 300 es\n            layout(location=5) in vec3 a_position;\n\n\t\t\tuniform mat4 u_mVMatrix;\n\t\t\tuniform mat4 u_cameraViewMatrix;\n\t\t\tuniform mat4 u_pMatrix;\n\n\t\t\tvec3 unprojectPoint(float x, float y, float z, mat4 view, mat4 projection) {\n                mat4 viewInv = inverse(view);\n                mat4 projInv = inverse(projection);\n                vec4 unprojectedPoint =  viewInv * projInv * vec4(x, y, z, 1.0);\n                return unprojectedPoint.xyz / unprojectedPoint.w;\n            }\n\n\t\t\tout vec3 nearPoint;\n\t\t\tout vec3 farPoint;\n\t\t\tout mat4 fragView;\n            out mat4 fragProj;\n\n\t\t\tout vec3 vertexPosition;\n\n\t\t\tvoid main(void){\n\t\t\t\tvec3 p = a_position;\n\n\t\t\t\tfragView = u_cameraViewMatrix;\n                fragProj = u_pMatrix;\n\t\t\t\tnearPoint = unprojectPoint(p.x, p.y, 0.0, u_cameraViewMatrix, u_pMatrix).xyz;\n\t\t\t\tfarPoint = unprojectPoint(p.x, p.y, 1.0, u_cameraViewMatrix, u_pMatrix).xyz;\n\n\t\t\t\tvertexPosition = p.xyz;\n\t\t\t\tgl_Position = vec4(p, 1.0);\n\n\t\t\t}","#version 300 es\n\t\t\tprecision highp float;\n\n\t\t\tin vec3 vertexPosition;\n\t\t\tin vec3 nearPoint;\n            in vec3 farPoint;\n            in mat4 fragView;\n            in mat4 fragProj;\n\n\t\t\t// computes Z-buffer depth value, and converts the range.\n\t\t\tfloat computeDepth(vec3 pos) {\n\t\t\t\t// get the clip-space coordinates\n\t\t\t\tvec4 clip_space_pos = fragProj * fragView * vec4(pos.xyz, 1.0);\n\n\t\t\t\t// get the depth value in normalized device coordinates\n\t\t\t\tfloat clip_space_depth = clip_space_pos.z / clip_space_pos.w;\n\n\t\t\t\t// and compute the range based on gl_DepthRange settings (not necessary with default settings, but left for completeness)\n\t\t\t\tfloat far = gl_DepthRange.far;\n\t\t\t\tfloat near = gl_DepthRange.near;\n\n\t\t\t\tfloat depth = (((far-near) * clip_space_depth) + near + far) / 2.0;\n\n\t\t\t\t// and return the result\n\t\t\t\treturn depth;\n\t\t\t}\n\n\t\t\t\n\t\t\tvec4 grid(vec3 fragPos3D, float scale) {\n                vec2 coord = fragPos3D.xz * scale;\n                vec2 derivative = fwidth(coord);\n                vec2 grid = abs(fract(coord - 0.5) - 0.5) / derivative;\n                float line = min(grid.x, grid.y);\n                float minimumz = min(derivative.y, 1.0);\n                float minimumx = min(derivative.x, 1.0);\n\t\t\t\tvec3 refColor = vec3(47.0, 56.0, 70.0);\n\t\t\t\tvec3 gridColor = vec3(1.0 - min(line, 1.0));\n                vec4 color = vec4(mix(refColor, gridColor, 1.0), 1.0);\n                return color;\n            }\n\n            out vec4 finalColor;\n\n\t\t\tvoid main(void){\n\n                float t = -nearPoint.y / (farPoint.y - nearPoint.y);\n                vec3 fragPos3D = nearPoint + t * (farPoint - nearPoint);\n\t\n\t\t\t\tfloat isIntersect = (t > 0.0) ? 1.0 : 0.0;\n\t\t\t\tfloat linearFieldSection = 0.02 * length(fragPos3D.xz);\n\t\t\t\tfloat fading = min(1.0, 1.5 - linearFieldSection);\n\n\t\t\t\tvec4 gridPattern = grid(fragPos3D, 0.5);\n\t\t\t\t\n\t\t\t\tvec4 outColor = gridPattern;\n\n\t\t\t\tfinalColor = outColor * isIntersect;\n\t\t\t\tfinalColor *= fading;\n\n\t\t\t\tgl_FragDepth = computeDepth(fragPos3D);\n            }");i.activateShader(),this.positionLoc=t.getAttribLocation(i.program,a.ATTR_POSITION_NAME),this.modelViewMatrixLoc=t.getUniformLocation(i.program,a.UNI_MODEL_MAT),this.perspectiveMatrixLoc=t.getUniformLocation(i.program,a.UNI_PERSPECTIV_MAT),this.cameraMatrixLoc=t.getUniformLocation(i.program,a.UNI_CAMERA_MAT),this.uColorLoc=t.getUniformLocation(i.program,a.UNI_COLOR),i.deactivateShader(),this.perspectiveProjectionMatrix=r.perspectiveProjection,this.orthoProjectionMatrix=r.orthoProjection,this.viewModelMatrix=r.viewMatrix,this.lightViewModelMatrix=e,this.shaderProgram=i}return t.prototype.setUniforms=function(t,r){return this.shaderProgram.activateShader(),t.uniformMatrix4fv(this.perspectiveMatrixLoc,!1,this.perspectiveProjectionMatrix),t.uniformMatrix4fv(this.cameraMatrixLoc,!1,this.viewModelMatrix),t.uniformMatrix4fv(this.modelViewMatrixLoc,!1,r.transform.getModelMatrix()),this},t}(),y=function(){function t(){}return t.createGeometry=function(r,e){return new x(t.createMesh(r,e))},t.createMesh=function(t,r){var e,i=[1,-1,0,1,1,0,-1,-1,0,-1,1,0,-1,-1,0,1,1,0],o=i.length/3,n=3*Float32Array.BYTES_PER_ELEMENT,s={positions:new R(t,i,o,a.BUFFER_TYPE_ARRAY),drawMode:t.TRIANGLES,vertexCount:o};return null===(e=s.positions)||void 0===e||e.bindToAttribute(r.positionLoc,n,a.DEFAULT_OFFSET,a.GRID_VECTOR_SIZE),s},t}(),P=function(){function t(t,r,e){this.lightViewMatrix=null;var i=new M(t,"#version 300 es\n\t\t\tin vec3 a_position;\n\t\t\tin vec3 a_norm;\n\t\t\tin vec2 a_texCoord;\n\n\t\t\tuniform vec3 u_lightPosition;\n\t\t\tuniform vec3 u_cameraPosition;\n\n\t\t\tuniform mat4 u_mVMatrix;\n\t\t\tuniform mat4 u_cameraViewMatrix;\n\t\t\tuniform mat4 u_pMatrix;\n\t\t\tuniform mat4 u_textureMatrix;\n\n\t\t\tmat4 m_worldMatrix;\n\t\t\tmat4 m_viewProjectionMatrix;\n\t\t\tmat4 m_worldViewProjectionMatrix;\n\t\t\t\n\t\t\tout vec3 v_normal;\n\t\t\tout vec3 v_surfaceToLight;\n\t\t\tout vec3 v_surfaceToCamera;\n\n\t\t\tout vec2 v_texCoord;\n\t\t\tout vec4 v_projectedTexcoord;\n\n\t\t\tvoid main(void){\n\n\t\t\t\tm_worldMatrix = u_mVMatrix;\n\t\t\t\tm_viewProjectionMatrix = u_pMatrix * u_cameraViewMatrix;\n\t\t\t\tm_worldViewProjectionMatrix = m_viewProjectionMatrix * m_worldMatrix;\n\n\t\t\t\tgl_Position = m_worldViewProjectionMatrix * vec4(a_position, 1.0);\n\t\t\t\t\n\t\t\t\tv_normal = (u_cameraViewMatrix * vec4(a_norm, 0.0)).xyz;\n\n\t\t\t\tvec3 v_surfaceWorldPosition = (m_worldMatrix * vec4(a_position, 1.0)).xyz;\n\t\t\t\tv_surfaceToLight = u_lightPosition - v_surfaceWorldPosition;\n\t\t\t\tv_surfaceToCamera = u_cameraPosition - v_surfaceWorldPosition;\n\n\t\t\t\tv_texCoord = a_texCoord;\n\t\t\t\tv_projectedTexcoord = u_textureMatrix * vec4(v_surfaceWorldPosition, 1.0);\n\t\t\t}","#version 300 es\n\t\t\tprecision highp float;\n\n\t\t\tin vec2 v_texCoord;\n\t\t\tin vec4 v_projectedTexcoord;\n\t\t\tin vec3 v_normal;\n\t\t\tin vec3 v_surfaceToLight;\n\t\t\tin vec3 v_surfaceToCamera;\n\t\t\t\n\t\t\t\n\t\t\tuniform vec4 u_lightColor;\n\t\t\tuniform vec4 u_ambientLightColor;\n\t\t\tuniform sampler2D u_diffuse;\n\t\t\tuniform sampler2D u_projectedTexture;\n\t\t\tuniform vec4 u_specularColor;\n\t\t\tuniform float u_shininess;\n\t\t\tuniform float u_specularFactor;\n\t\t\tuniform float u_bias;\n\t\t\tuniform vec3 u_reverseLightDirection;\n\n\t\t\tvec4 lit(float l ,float h, float m) {\n\t\t\t\treturn vec4(\n\t\t\t\t\t1.0,\n\t\t\t\t\tabs(l),\n\t\t\t\t\t(l > 0.0) ? pow(max(0.0, h), m) : 0.0,\n\t\t\t\t\t1.0\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tout vec4 finalColor;\n\n\t\t\tvoid main(void) {\n\n\t\t\t\tvec3 normal = normalize(v_normal);\n\n\t\t\t\tfloat light = dot(normal, u_reverseLightDirection);\n\n\t\t\t\tvec3 projectedTexcoord = v_projectedTexcoord.xyz / v_projectedTexcoord.w;\n\t\t\t\tfloat currentDepth = projectedTexcoord.z + u_bias;\n\n\t\t\t\tbool inRange =+\n\t\t\t\t\tprojectedTexcoord.x >= 0.0 &&+\n\t\t\t\t\tprojectedTexcoord.x <= 1.0 &&+\n\t\t\t\t\tprojectedTexcoord.y >= 0.0 &&+\n\t\t\t\t\tprojectedTexcoord.y <= 1.0;\n\n\t\t\t\tfloat projectedDepth = texture(u_projectedTexture, projectedTexcoord.xy).r;\n\t\t\t\tfloat shadowLight = (inRange && projectedDepth <= currentDepth) ? 0.0 : 1.0;\n\n\t\t\t\tvec3 surfaceToLightDirection = normalize(v_surfaceToLight);\n\t\t\t\tvec3 surfaceToCameraDirection = normalize(v_surfaceToCamera);\n\t\t\t\tvec3 halfVector = normalize(surfaceToLightDirection + surfaceToCameraDirection);\n\n\t\t\t\tvec4 diffuseColor = texture(u_diffuse, v_texCoord);\n\t\t\t\tvec4 litR = lit(dot(normal, surfaceToLightDirection), dot(normal, halfVector), u_shininess);\n\t\t\t\t\n\t\t\t\tvec4 mult1 = diffuseColor * litR.y;\n\t\t\t\tvec4 mult2 = diffuseColor * u_ambientLightColor;\n\t\t\t\tvec4 mult3 = u_specularColor * litR.z * u_specularFactor;\n\t\t\t\tvec4 mult4 = u_lightColor * ( mult1 + mult2 + mult3);\n\n\t\t\t\tvec4 outColor = mult4 * vec4(\n\t\t\t\t\tdiffuseColor.rgb * light * shadowLight,\n\t\t\t\t\tdiffuseColor.a);\n\n\n\t\t\t\tfinalColor = outColor;\n\t\t\t}");i.activateShader(),this.positionLoc=t.getAttribLocation(i.program,a.ATTR_POSITION_NAME),this.texCoordLoc=t.getAttribLocation(i.program,a.ATTR_UV_NAME),this.normalLoc=t.getAttribLocation(i.program,a.ATTR_NORMAL_NAME),this.modelViewMatrixLoc=t.getUniformLocation(i.program,a.UNI_MODEL_MAT),this.perspectiveMatrixLoc=t.getUniformLocation(i.program,a.UNI_PERSPECTIV_MAT),this.cameraMatrixLoc=t.getUniformLocation(i.program,a.UNI_CAMERA_MAT),this.projectedTextureLoc=t.getUniformLocation(i.program,a.UNI_PROJECTED_TEXTURE),this.textureMatrixLoc=t.getUniformLocation(i.program,a.UNI_TEXTURE_MAT),this.reverseLightDirectionLoc=t.getUniformLocation(i.program,a.UNI_REVERSE_LIGHT_DIRECTION_MAT),this.diffuseLoc=t.getUniformLocation(i.program,a.UNI_DIFFUSE),this.ambientLightColorLoc=t.getUniformLocation(i.program,a.UNI_LIGHT_AMBIENT),this.lightPositionLoc=t.getUniformLocation(i.program,a.UNI_LIGHT_POSITION),this.cameraPositionLoc=t.getUniformLocation(i.program,a.UNI_CAMERA_POSITION),this.shininessLoc=t.getUniformLocation(i.program,a.UNI_CAMERA_SHININESS),this.lightColorLoc=t.getUniformLocation(i.program,a.UNI_LIGHT_COLOR),this.specularColorLoc=t.getUniformLocation(i.program,a.UNI_SPECULAR_COLOR),this.specularFactorLoc=t.getUniformLocation(i.program,a.UNI_SPECULAR_FACTOR),i.deactivateShader(),this.perspectiveProjectionMatrix=r.perspectiveProjection,this.orthoProjectionMatrix=r.orthoProjection,this.viewModelMatrix=r.viewMatrix,this.lightViewCamera=e,this.sceneViewCamera=r,this.shaderProgram=i}return t.prototype.setUniforms=function(t,r){this.shaderProgram.activateShader();var e=this.getLightWorldMatrix(this.lightViewCamera,r);return t.uniformMatrix4fv(this.perspectiveMatrixLoc,!1,this.perspectiveProjectionMatrix),t.uniformMatrix4fv(this.cameraMatrixLoc,!1,this.viewModelMatrix),t.uniformMatrix4fv(this.textureMatrixLoc,!1,this.getTextureMatrix(e)),t.uniformMatrix4fv(this.modelViewMatrixLoc,!1,r.transform.getModelMatrix()),t.uniform3fv(this.cameraPositionLoc,this.sceneViewCamera.transform.position.getFloatArray()),t.uniform3fv(this.reverseLightDirectionLoc,e.slice(8,11)),this},t.prototype.getTextureMatrix=function(t){var r=_.identity();_.translate(r,.5,.5,.5),_.scale(r,.5,.5,.5),_.mult(r,r,this.orthoProjectionMatrix);var e=[];return _.invert(e,t),_.mult(r,r,e),r},t.prototype.getLightWorldMatrix=function(t,r){return _.lookAt([t.transform.position.x,t.transform.position.y,t.transform.position.z],[r.transform.position.x,r.transform.position.y,r.transform.position.z],[0,1,0])},t}(),F=function(){function t(){}return t.createGeometry=function(r,e,i,o){return new x(t.createMesh(r,e,i,o))},t.createMesh=function(t,r,e,i){var o,n,s,c=e.vertexCount(),u={positions:new R(t,e.positions(),c,a.BUFFER_TYPE_ARRAY),normals:new R(t,e.normals(),c,a.BUFFER_TYPE_ARRAY),uvs:new R(t,e.uvs(),c,a.BUFFER_TYPE_ARRAY),texture:i,drawMode:t.TRIANGLES,vertexCount:c};return null===(o=u.positions)||void 0===o||o.bindToAttribute(r.positionLoc,a.DEFAULT_STRIDE,a.DEFAULT_OFFSET),null===(n=u.normals)||void 0===n||n.bindToAttribute(r.normalLoc,a.DEFAULT_STRIDE,a.DEFAULT_OFFSET),null===(s=u.uvs)||void 0===s||s.bindToAttribute(r.texCoordLoc,a.DEFAULT_STRIDE,a.DEFAULT_OFFSET),u},t}();const U=function(){function t(t){this.surfaces=[],this.surfaces=t}return t.parseOBJ=function(i){return r(this,void 0,void 0,(function(){var r,o,n,a,f,m,p,_,v,d,E,g,T,M,x,R,A,L,w,y,P,F,U,I,C;return e(this,(function(e){for(r=s.V,o=s.VN,n=s.VT,a=s.F,f=i.split("\n"),m=[],p=[],_=[],v=[],d=0,E=f;d<E.length;d++)if(g=E[d],T=g.trim().split(c),M=T[0],r===M)m.push(l(parseFloat(T[1]),parseFloat(T[2]),parseFloat(T[3])));else if(o===M)_.push(l(parseFloat(T[1]),parseFloat(T[2]),parseFloat(T[3])));else if(n===M)p.push({x:parseFloat(T[1]),y:1-parseFloat(T[2])});else if(a===M){for(x=!1,R=!1,A=4,L=[],w=1;w<A;w++){if(T.length>A&&!R)A+=1;else if(4!==w||x){if(5===w&&x)w=1,x=!1,R=!0;else if(2===w&&R)break}else w=3,A+=1,x=!0;y=T[w].split("/"),P=m[parseInt(y[0])-1],F=p[parseInt(y[1])-1],U=_[parseInt(y[2])-1],L.push(h(P,U,F))}L.length>3?(I=L.slice(0,3),C=L.slice(3),v.push(u(I)),v.push(u(C))):v.push(u(L))}return[2,new t(v)]}))}))},t.loadOBJ=function(i){return r(this,void 0,void 0,(function(){var r;return e(this,(function(e){switch(e.label){case 0:return[4,fetch(i)];case 1:return[4,e.sent().text()];case 2:return r=e.sent(),[4,Promise.all([t.parseOBJ(r)])];case 3:return[2,e.sent()[0]]}}))}))},t.prototype.vertexCount=function(){return 3*this.surfaces.length},t.prototype.positions=function(){var t=[];return this.surfaces.forEach((function(r){r.vertices.forEach((function(r){var e=r.position;t.push(e.x,e.y,e.z)}))})),t},t.prototype.normals=function(){var t=[];return this.surfaces.forEach((function(r){r.vertices.forEach((function(r){var e=r.normal;t.push(e.x,e.y,e.z)}))})),t},t.prototype.uvs=function(){var t=[];return this.surfaces.forEach((function(r){r.vertices.forEach((function(r){var e=r.uv;t.push(e.x,e.y)}))})),t},t}(),I=function(){function t(t,r){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.generateMipmap(t.TEXTURE_2D),this.gl=t}return t.loadTexture=function(i,o){return r(this,void 0,Promise,(function(){var r;return e(this,(function(e){switch(e.label){case 0:return(r=new Image).src=o,[4,r.decode()];case 1:return e.sent(),[2,new t(i,r)]}}))}))},t}();r(void 0,void 0,void 0,(function(){var t,r,o,n,a,s,c,u,h,l,f,m,_,v,M,x,R,C;return e(this,(function(e){switch(e.label){case 0:return t=new g(i.WEBGL_CANVAS_ID),o=(r=[.95,.9])[0],n=r[1],t.fitScreen(o,n).setClearColor(13,17,23,1).clear(),a=t.getContext(),s=new p(0,2.5,3),c=new T(s),(u=new d(a)).transform.position.set(s.x,s.y,s.z),[4,U.loadOBJ(i.PATH_ASSETS_OBJ)];case 1:return h=e.sent(),[4,I.loadTexture(a,i.PATH_ASSETS_TEXTURE)];case 2:return l=e.sent(),f=new A(a,u),m=L.createGeometry(a,f,h),(_=new d(a)).transform.position.set(0,.5,1.5),new E(a,_),v=new w(a,_,u),M=y.createGeometry(a,v),x=new P(a,_,u),(R=F.createGeometry(a,x,h,l)).setScale(.0035,.0035,.0035).setRotation(0,30,0),(C=function(){u.updateViewMatrix(),f.setUniforms(a,m.preRender()).shaderProgram.renderModel(m.preRender()),t.clearFramebuffer().fitScreen(o,n).clear(),_.updateViewMatrix(),v.setUniforms(a,M.preRender()).shaderProgram.renderModel(M.preRender()),x.setUniforms(a,R.preRender()).shaderProgram.renderModel(R.preRender()),c.setUniforms(a,x),requestAnimationFrame(C)})(),[2]}}))}))})();
//# sourceMappingURL=bundle.js.map