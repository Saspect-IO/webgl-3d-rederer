(()=>{"use strict";var t={};function r(t,r,e,i){return new(e||(e=Promise))((function(n,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function s(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var r;t.done?n(t.value):(r=t.value,r instanceof e?r:new e((function(t){t(r)}))).then(a,s)}c((i=i.apply(t,r||[])).next())}))}function e(t,r){var e,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((n=(n=a.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=r.call(t,a)}catch(t){o=[6,t],i=0}finally{e=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var r;t.g.importScripts&&(r=t.g.location+"");var e=t.g.document;if(!r&&e&&(e.currentScript&&(r=e.currentScript.src),!r)){var i=e.getElementsByTagName("script");i.length&&(r=i[i.length-1].src)}if(!r)throw new Error("Automatic publicPath is not supported in this browser");r=r.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=r})();const i=function(){function t(){var t=document.getElementById("shadow-app-loader"),r=null==t?void 0:t.attachShadow({mode:"open"});r.innerHTML='\n        <style>\n            .lds-ellipsis {\n              display: inline-block;\n              position: relative;\n              width: 80px;\n              height: 80px;\n              opacity: 0.5;\n            }\n            .lds-ellipsis div {\n              position: absolute;\n              top: 33px;\n              width: 20px;\n              height: 20px;\n              border-radius: 50%;\n              background: #fff;\n              animation-timing-function: cubic-bezier(0, 1, 1, 0);\n            }\n            .lds-ellipsis div:nth-child(1) {\n              left: 16px;\n              animation: lds-ellipsis1 0.6s infinite;\n            }\n            .lds-ellipsis div:nth-child(2) {\n              left: 16px;\n              animation: lds-ellipsis2 0.6s infinite;\n            }\n            .lds-ellipsis div:nth-child(3) {\n              left: 40px;\n              animation: lds-ellipsis2 0.6s infinite;\n            }\n            .lds-ellipsis div:nth-child(4) {\n              left: 64px;\n              animation: lds-ellipsis3 0.6s infinite;\n            }\n            @keyframes lds-ellipsis1 {\n              0% {\n                transform: scale(0);\n              }\n              100% {\n                transform: scale(1);\n              }\n            }\n            @keyframes lds-ellipsis3 {\n              0% {\n                transform: scale(1);\n              }\n              100% {\n                transform: scale(0);\n              }\n            }\n            @keyframes lds-ellipsis2 {\n              0% {\n                transform: translate(0, 0);\n              }\n              100% {\n                transform: translate(24px, 0);\n              }\n            }\n\n        </style>\n        <div id="app-loader"\n            style="display: flex;\n            visibility: visible;\n            opacity: 1;\n            justify-content: center;\n            align-items: center;\n            position: fixed; \n            left: 0; \n            top: 0; right: \n            0; bottom: 0; \n            background: rgb(0, 0, 0, 0.4);">\n            <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>\n        </div>',this.appLoaderElem=r.children[1]}return t.prototype.setDisplayState=function(t){var r=this;t?this.appLoaderElem.style.display="flex":this.appLoaderElem.style.visibility="visible",this.appLoaderElem.style.transition="visibility 0s, opacity 0.5s linear",this.appLoaderElem.style.opacity="0",setTimeout((function(){r.appLoaderElem.style.display="none"}),1e3)},t}(),n=t.p+"assets/resources/formula_1/source/formula_1.obj",o=t.p+"assets/resources/formula_1/textures/formula_1.png";var a,s,c,u,h,l=n,f=o,p=/\s+/;!function(t){t.WEBGL_CANVAS_ID="qrius-glCanvas",t.WEBGL_CONTEXT="webgl2",t.WEBGL_CONTEXT_EXPERIMENTAL="experimental-webgl",t.WEBGL_CONTEXT_WEBKIT="webkit-3d",t.WEBGL_CONTEXT_MOZ="moz-webgl",t.WEBGL_DEPTH_TEXTURE="WEBGL_depth_texture",t.WEBGL_CONTEXT_ERROR_MESSAGE="Could not initialise WebGL",t.WEBGL_DEPTH_TEXTUR_ERROR_MESSAGE="need WEBGL_depth_texture",t.PATH_ASSETS_OBJ="/webgl-3d-renderer/assets/resources/formula_1/source/formula_1.obj",t.PATH_ASSETS_TEXTURE="/webgl-3d-renderer/assets/resources/formula_1/textures/formula_1.png",t[t.DEPTH_TEXTURE_SIZE=512]="DEPTH_TEXTURE_SIZE"}(a||(a={})),function(t){t[t.NEAR_PLANE=.1]="NEAR_PLANE",t[t.FAR_PLANE=100]="FAR_PLANE",t[t.FIELD_OF_VIEW=45]="FIELD_OF_VIEW",t[t.MODE_FREE=0]="MODE_FREE",t[t.MODE_ORBIT=1]="MODE_ORBIT"}(s||(s={})),function(t){t.KEY_DOWN_EVENT="keydown",t.KEY_UP_EVENT="keyup",t[t.KEY_DOWN=40]="KEY_DOWN",t[t.KEY_UP=38]="KEY_UP",t[t.KEY_LEFT=37]="KEY_LEFT",t[t.KEY_RIGHT=39]="KEY_RIGHT",t.MOUSE_UP="mouseup",t.MOUSE_DOWN="mousedown",t.MOUSE_WHEEL="mousewheel",t.MOUSE_MOVE="mousemove",t[t.ROTATION_RATE=-300]="ROTATION_RATE",t[t.PAN_RATE=5]="PAN_RATE",t[t.ZOOM_RATE=200]="ZOOM_RATE"}(c||(c={})),function(t){t[t.DEFAULT_OFFSET=0]="DEFAULT_OFFSET",t[t.DEFAULT_STRIDE=0]="DEFAULT_STRIDE",t[t.GRID_VECTOR_SIZE=3]="GRID_VECTOR_SIZE",t[t.GRID_VERTEX_LEN=4]="GRID_VERTEX_LEN",t.ATTR_POSITION_NAME="a_position",t.ATTR_NORMAL_NAME="a_norm",t.ATTR_UV_NAME="a_texCoord",t.UNI_COLOR="u_color",t.UNI_MODEL_MAT="u_mVMatrix",t.UNI_PERSPECTIV_MAT="u_pMatrix",t.UNI_ORTHO_MAT="u_oMatrix",t.UNI_CAMERA_MAT="u_cameraViewMatrix",t.UNI_LIGHT_VIEW_CAMERA_MAT="u_lightViewCameraMatrix",t.UNI_REVERSE_LIGHT_DIRECTION_MAT="u_reverseLightDirection",t.UNI_TEXTURE_MAT="u_textureMatrix",t.UNI_DIFFUSE="u_diffuse",t.UNI_PROJECTED_TEXTURE="u_projectedTexture",t.UNI_LIGHT_AMBIENT="u_ambientLightColor",t.UNI_LIGHT_DIRECTION="u_lightDirection",t.UNI_LIGHT_POSITION="u_lightPosition",t.UNI_CAMERA_POSITION="u_cameraPosition",t.UNI_CAMERA_SHININESS="u_shininess",t.UNI_LIGHT_COLOR="u_lightColor",t.UNI_SPECULAR_COLOR="u_specularColor",t.UNI_SPECULAR_FACTOR="u_specularFactor",t.BUFFER_TYPE_ELEMENT_ARRAY="array_elements",t.BUFFER_TYPE_ARRAY="arrays"}(u||(u={})),function(t){t.V="v",t.VN="vn",t.VT="vt",t.F="f"}(h||(h={}));var m=function(t){return{vertices:t}},v=function(t,r,e){return{position:t,normal:r,uv:e}},_=function(t,r,e){return{x:t,y:r,z:e}},d=function(t){return t*Math.PI/180},E=function(t){var r=[t.red/255,t.green/255,t.blue/255,1];return new Float32Array(r)},g=function(){function t(t,r,e){this.x=t||0,this.y=r||0,this.z=e||0}return t.prototype.magnitude=function(t){if(void 0===t&&(t={x:0,y:0,z:0}),void 0===t)return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);var r=t.x-this.x,e=t.y-this.y,i=t.y-this.z;return Math.sqrt(r*r+e*e+i*i)},t.prototype.normalize=function(){var t=this.magnitude();return this.x/=t,this.y/=t,this.z/=t,this},t.prototype.set=function(t,r,e){return this.x=t,this.y=r,this.z=e,this},t.prototype.multiScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.getArray=function(){return[this.x,this.y,this.z]},t.prototype.getFloatArray=function(){return new Float32Array([this.x,this.y,this.z])},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t}(),T=function(){function t(){this.matrix=t.identity()}return t.prototype.vtranslate=function(r){return t.translate(this.matrix,r.x,r.y,r.z),this},t.prototype.translate=function(r,e,i){return t.translate(this.matrix,r,e,i),this},t.prototype.rotateY=function(r){return t.rotateY(this.matrix,r),this},t.prototype.rotateX=function(r){return t.rotateX(this.matrix,r),this},t.prototype.rotateZ=function(r){return t.rotateZ(this.matrix,r),this},t.prototype.vscale=function(r){return t.scale(this.matrix,r.x,r.y,r.z),this},t.prototype.scale=function(r,e,i){return t.scale(this.matrix,r,e,i),this},t.prototype.invert=function(){return t.invert(this.matrix),this},t.prototype.resetRotation=function(){for(var t=0;t<this.matrix.length;t++)t>=12&&t<=14||(this.matrix[t]=t%5==0?1:0);return this},t.prototype.resetMat=function(){for(var t=0;t<this.matrix.length;t++)this.matrix[t]=t%5==0?1:0;return this},t.identity=function(){var t=new Float32Array(16);return t[0]=t[5]=t[10]=t[15]=1,t},t.perspective=function(t,r,e,i,n){var o=1/Math.tan(r/2),a=1/(i-n);t[0]=o/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*i*a,t[15]=0},t.ortho=function(t,r,e,i,n,o,a){var s=1/(r-e),c=1/(i-n),u=1/(o-a);t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(r+e)*s,t[13]=(n+i)*c,t[14]=(a+o)*u,t[15]=1},t.lookAt=function(r,e,i,n){void 0===n&&(n=null),n=n||new Float32Array(16);var o=t.normalize(t.subtractVectors(r,e)),a=t.normalize(t.cross(i,o)),s=t.normalize(t.cross(o,a));return n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=0,n[4]=s[0],n[5]=s[1],n[6]=s[2],n[7]=0,n[8]=o[0],n[9]=o[1],n[10]=o[2],n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n},t.subtractVectors=function(t,r,e){return void 0===e&&(e=null),(e=e||new Float32Array(3))[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},t.cross=function(t,r,e){return void 0===e&&(e=null),(e=e||new Float32Array(3))[0]=t[1]*r[2]-t[2]*r[1],e[1]=t[2]*r[0]-t[0]*r[2],e[2]=t[0]*r[1]-t[1]*r[0],e},t.normalize=function(t,r){void 0===r&&(r=null),r=r||new Float32Array(3);var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return e>1e-5&&(r[0]=t[0]/e,r[1]=t[1]/e,r[2]=t[2]/e),r},t.transpose=function(t,r){if(t===r){var e=r[1],i=r[2],n=r[3],o=r[6],a=r[7],s=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=e,t[6]=r[9],t[7]=r[13],t[8]=i,t[9]=o,t[11]=r[14],t[12]=n,t[13]=a,t[14]=s}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t},t.normalMat3=function(t,r){var e=r[0],i=r[1],n=r[2],o=r[3],a=r[4],s=r[5],c=r[6],u=r[7],h=r[8],l=r[9],f=r[10],p=r[11],m=r[12],v=r[13],_=r[14],d=r[15],E=e*s-i*a,g=e*c-n*a,T=e*u-o*a,R=i*c-n*s,x=i*u-o*s,M=n*u-o*c,A=h*v-l*m,y=h*_-f*m,L=h*d-p*m,w=l*_-f*v,F=l*d-p*v,P=f*d-p*_,I=E*P-g*F+T*w+R*L-x*y+M*A;return I?(I=1/I,t[0]=(s*P-c*F+u*w)*I,t[1]=(c*L-a*P-u*y)*I,t[2]=(a*F-s*L+u*A)*I,t[3]=(n*F-i*P-o*w)*I,t[4]=(e*P-n*L+o*y)*I,t[5]=(i*L-e*F-o*A)*I,t[6]=(v*M-_*x+d*R)*I,t[7]=(_*T-m*M-d*g)*I,t[8]=(m*x-v*T+d*E)*I,t):null},t.multiplyVector=function(t,r){var e=r[0],i=r[1],n=r[2],o=r[3],a=t[0],s=t[1],c=t[2],u=t[3],h=t[4],l=t[5],f=t[6],p=t[7],m=t[8],v=t[9],_=t[10],d=t[11];return[e*a+i*h+n*m+o*t[12],e*s+i*l+n*v+o*t[13],e*c+i*f+n*_+o*t[14],e*u+i*p+n*d+o*t[15]]},t.transformVec4=function(t,r,e){return t[0]=e[0]*r[0]+e[4]*r[1]+e[8]*r[2]+e[12]*r[3],t[1]=e[1]*r[0]+e[5]*r[1]+e[9]*r[2]+e[13]*r[3],t[2]=e[2]*r[0]+e[6]*r[1]+e[10]*r[2]+e[14]*r[3],t[3]=e[3]*r[0]+e[7]*r[1]+e[11]*r[2]+e[15]*r[3],t},t.mult=function(t,r,e){var i=r[0],n=r[1],o=r[2],a=r[3],s=r[4],c=r[5],u=r[6],h=r[7],l=r[8],f=r[9],p=r[10],m=r[11],v=r[12],_=r[13],d=r[14],E=r[15],g=e[0],T=e[1],R=e[2],x=e[3];return t[0]=g*i+T*s+R*l+x*v,t[1]=g*n+T*c+R*f+x*_,t[2]=g*o+T*u+R*p+x*d,t[3]=g*a+T*h+R*m+x*E,g=e[4],T=e[5],R=e[6],x=e[7],t[4]=g*i+T*s+R*l+x*v,t[5]=g*n+T*c+R*f+x*_,t[6]=g*o+T*u+R*p+x*d,t[7]=g*a+T*h+R*m+x*E,g=e[8],T=e[9],R=e[10],x=e[11],t[8]=g*i+T*s+R*l+x*v,t[9]=g*n+T*c+R*f+x*_,t[10]=g*o+T*u+R*p+x*d,t[11]=g*a+T*h+R*m+x*E,g=e[12],T=e[13],R=e[14],x=e[15],t[12]=g*i+T*s+R*l+x*v,t[13]=g*n+T*c+R*f+x*_,t[14]=g*o+T*u+R*p+x*d,t[15]=g*a+T*h+R*m+x*E,t},t.scale=function(t,r,e,i){return t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t[4]*=e,t[5]*=e,t[6]*=e,t[7]*=e,t[8]*=i,t[9]*=i,t[10]*=i,t[11]*=i,t},t.rotateY=function(t,r){var e=Math.sin(r),i=Math.cos(r),n=t[0],o=t[1],a=t[2],s=t[3],c=t[8],u=t[9],h=t[10],l=t[11];return t[0]=n*i-c*e,t[1]=o*i-u*e,t[2]=a*i-h*e,t[3]=s*i-l*e,t[8]=n*e+c*i,t[9]=o*e+u*i,t[10]=a*e+h*i,t[11]=s*e+l*i,t},t.rotateX=function(t,r){var e=Math.sin(r),i=Math.cos(r),n=t[4],o=t[5],a=t[6],s=t[7],c=t[8],u=t[9],h=t[10],l=t[11];return t[4]=n*i+c*e,t[5]=o*i+u*e,t[6]=a*i+h*e,t[7]=s*i+l*e,t[8]=c*i-n*e,t[9]=u*i-o*e,t[10]=h*i-a*e,t[11]=l*i-s*e,t},t.rotateZ=function(t,r){var e=Math.sin(r),i=Math.cos(r),n=t[0],o=t[1],a=t[2],s=t[3],c=t[4],u=t[5],h=t[6],l=t[7];return t[0]=n*i+c*e,t[1]=o*i+u*e,t[2]=a*i+h*e,t[3]=s*i+l*e,t[4]=c*i-n*e,t[5]=u*i-o*e,t[6]=h*i-a*e,t[7]=l*i-s*e,t},t.rotate=function(t,r,e){var i,n,o,a,s,c,u,h,l,f,p,m,v,_,d,E,g,T,R,x,M,A,y,L,w=e[0],F=e[1],P=e[2],I=Math.sqrt(w*w+F*F+P*P);if(Math.abs(I)<1e-6)return null;w*=I=1/I,F*=I,P*=I,i=Math.sin(r),o=1-(n=Math.cos(r)),a=t[0],s=t[1],c=t[2],u=t[3],h=t[4],l=t[5],f=t[6],p=t[7],m=t[8],v=t[9],_=t[10],d=t[11],E=w*w*o+n,g=F*w*o+P*i,T=P*w*o-F*i,R=w*F*o-P*i,x=F*F*o+n,M=P*F*o+w*i,A=w*P*o+F*i,y=F*P*o-w*i,L=P*P*o+n,t[0]=a*E+h*g+m*T,t[1]=s*E+l*g+v*T,t[2]=c*E+f*g+_*T,t[3]=u*E+p*g+d*T,t[4]=a*R+h*x+m*M,t[5]=s*R+l*x+v*M,t[6]=c*R+f*x+_*M,t[7]=u*R+p*x+d*M,t[8]=a*A+h*y+m*L,t[9]=s*A+l*y+v*L,t[10]=c*A+f*y+_*L,t[11]=u*A+p*y+d*L},t.invert=function(t,r){void 0===r&&(r=t);var e=r[0],i=r[1],n=r[2],o=r[3],a=r[4],s=r[5],c=r[6],u=r[7],h=r[8],l=r[9],f=r[10],p=r[11],m=r[12],v=r[13],_=r[14],d=r[15],E=e*s-i*a,g=e*c-n*a,T=e*u-o*a,R=i*c-n*s,x=i*u-o*s,M=n*u-o*c,A=h*v-l*m,y=h*_-f*m,L=h*d-p*m,w=l*_-f*v,F=l*d-p*v,P=f*d-p*_,I=E*P-g*F+T*w+R*L-x*y+M*A;return!!I&&(I=1/I,t[0]=(s*P-c*F+u*w)*I,t[1]=(n*F-i*P-o*w)*I,t[2]=(v*M-_*x+d*R)*I,t[3]=(f*x-l*M-p*R)*I,t[4]=(c*L-a*P-u*y)*I,t[5]=(e*P-n*L+o*y)*I,t[6]=(_*T-m*M-d*g)*I,t[7]=(h*M-f*T+p*g)*I,t[8]=(a*F-s*L+u*A)*I,t[9]=(i*L-e*F-o*A)*I,t[10]=(m*x-v*T+d*E)*I,t[11]=(l*T-h*x-p*E)*I,t[12]=(s*y-a*w-c*A)*I,t[13]=(e*w-i*y+n*A)*I,t[14]=(v*g-m*R-_*E)*I,t[15]=(h*R-l*g+f*E)*I,!0)},t.translate=function(t,r,e,i){t[12]=t[0]*r+t[4]*e+t[8]*i+t[12],t[13]=t[1]*r+t[5]*e+t[9]*i+t[13],t[14]=t[2]*r+t[6]*e+t[10]*i+t[14],t[15]=t[3]*r+t[7]*e+t[11]*i+t[15]},t}();const R=function(){function t(){this.position=new g(0,0,0),this.scale=new g(1,1,1),this.rotation=new g(0,0,0),this.matView=new T,this.matNormal=new Float32Array(9),this.forward=new Float32Array(4),this.up=new Float32Array(4),this.right=new Float32Array(4)}return t.prototype.updateMatrix=function(){return this.matView.resetMat().vtranslate(this.position).rotateX(d(this.rotation.x)).rotateY(d(this.rotation.y)).rotateZ(d(this.rotation.z)).vscale(this.scale),T.normalMat3(this.matNormal,this.matView.matrix),T.transformVec4(this.forward,[0,0,1,0],this.matView.matrix),T.transformVec4(this.up,[0,1,0,0],this.matView.matrix),T.transformVec4(this.right,[1,0,0,0],this.matView.matrix),this.matView.matrix},t.prototype.updateDirection=function(){return T.transformVec4(this.forward,[0,0,1,0],this.matView.matrix),T.transformVec4(this.up,[0,1,0,0],this.matView.matrix),T.transformVec4(this.right,[1,0,0,0],this.matView.matrix),this},t.prototype.getModelMatrix=function(){return this.matView.matrix},t.prototype.getNormalMatrix=function(){return this.matNormal},t.prototype.reset=function(){this.position.set(0,0,0),this.scale.set(1,1,1),this.rotation.set(0,0,0)},t}();var x=function(){function t(r,e,i,n){void 0===e&&(e=s.FIELD_OF_VIEW),void 0===i&&(i=s.NEAR_PLANE),void 0===n&&(n=s.FAR_PLANE),this.perspectiveProjection=new Float32Array(16),this.orthoProjection=new Float32Array(16);var o=r.canvas.width/r.canvas.height,a=-r.canvas.width/2,c=r.canvas.width/2,u=r.canvas.height/2,h=-r.canvas.height/2;T.perspective(this.perspectiveProjection,e,o,i,n),T.ortho(this.orthoProjection,a,c,h,u,1,10),this.transform=new R,this.viewMatrix=new Float32Array(16),this.mode=t.MODE_ORBIT}return t.prototype.panX=function(r){this.mode!=t.MODE_ORBIT&&(this.updateViewMatrix(),this.transform.position.x+=this.transform.right[0]*r,this.transform.position.y+=this.transform.right[1]*r,this.transform.position.z+=this.transform.right[2]*r)},t.prototype.panY=function(r){this.updateViewMatrix(),this.transform.position.y+=this.transform.up[1]*r,this.mode!=t.MODE_ORBIT&&(this.transform.position.x+=this.transform.up[0]*r,this.transform.position.z+=this.transform.up[2]*r)},t.prototype.panZ=function(r){this.updateViewMatrix(),this.mode==t.MODE_ORBIT?this.transform.position.z+=r:(this.transform.position.x+=this.transform.forward[0]*r,this.transform.position.y+=this.transform.forward[1]*r,this.transform.position.z+=this.transform.forward[2]*r)},t.prototype.updateViewMatrix=function(){return this.mode==t.MODE_FREE?this.transform.matView.resetMat().vtranslate(this.transform.position).rotateX(d(this.transform.rotation.x)).rotateY(d(this.transform.rotation.y)):this.transform.matView.resetMat().rotateX(d(this.transform.rotation.x)).rotateY(d(this.transform.rotation.y)).vtranslate(this.transform.position),this.transform.updateDirection(),T.invert(this.viewMatrix,this.transform.matView.matrix),this.viewMatrix},t.MODE_FREE=s.MODE_FREE,t.MODE_ORBIT=s.MODE_ORBIT,t}(),M=function(){function t(t,r){var e=this,i=t.canvas.getBoundingClientRect();this.canvas=t.canvas,this.camera=r,this.rotateRate=c.ROTATION_RATE,this.panRate=c.PAN_RATE,this.zoomRate=c.ZOOM_RATE,this.offsetX=i.left,this.offsetY=i.top,this.initX=0,this.initY=0,this.prevX=0,this.prevY=0,this.onUpHandler=function(t){return e.onMouseUp(t)},this.onMoveHandler=function(t){return e.onMouseMove(t)},this.canvas.addEventListener(c.MOUSE_DOWN,(function(t){return e.onMouseDown(t)})),this.canvas.addEventListener(c.MOUSE_WHEEL,(function(t){return e.onMouseWheel(t)}))}return t.prototype.getMouseVec2=function(t){return{x:t.pageX-this.offsetX,y:t.pageY-this.offsetY}},t.prototype.onMouseDown=function(t){this.initX=this.prevX=t.pageX-this.offsetX,this.initY=this.prevY=t.pageY-this.offsetY,this.canvas.addEventListener(c.MOUSE_UP,this.onUpHandler),this.canvas.addEventListener(c.MOUSE_MOVE,this.onMoveHandler)},t.prototype.onMouseUp=function(t){this.canvas.removeEventListener(c.MOUSE_UP,this.onUpHandler),this.canvas.removeEventListener(c.MOUSE_MOVE,this.onMoveHandler)},t.prototype.onMouseWheel=function(t){var r=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));this.camera.panZ(-r*(this.zoomRate/this.canvas.height))},t.prototype.onMouseMove=function(t){var r=t.pageX-this.offsetX,e=t.pageY-this.offsetY,i=r-this.prevX,n=e-this.prevY;t.shiftKey?(this.camera.panX(-i*(this.panRate/this.canvas.width)),this.camera.panY(n*(this.panRate/this.canvas.height))):(this.camera.transform.rotation.y+=i*(this.rotateRate/this.canvas.width),this.camera.transform.rotation.x+=n*(this.rotateRate/this.canvas.height)),this.prevX=r,this.prevY=e},t}();const A=function(){function t(t){var r,e,i,n,o,s,c;this.gl=null,this.rgb_32_bit=255,this.alpha=1;var u=document.getElementById(t);this.gl=u.getContext(a.WEBGL_CONTEXT),null!==(r=this.gl)&&void 0!==r||alert(a.WEBGL_CONTEXT_ERROR_MESSAGE),null===(e=this.gl)||void 0===e||e.cullFace(this.gl.BACK),null===(i=this.gl)||void 0===i||i.frontFace(this.gl.CCW),null===(n=this.gl)||void 0===n||n.enable(this.gl.DEPTH_TEST),null===(o=this.gl)||void 0===o||o.enable(this.gl.CULL_FACE),null===(s=this.gl)||void 0===s||s.depthFunc(this.gl.LEQUAL),null===(c=this.gl)||void 0===c||c.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.canvas=u}return t.prototype.setSize=function(t,r){var e;return this.canvas.style.width=t+"px",this.canvas.style.height=r+"px",this.canvas.width=t,this.canvas.height=r,null===(e=this.gl)||void 0===e||e.viewport(0,0,t,r),this},t.prototype.depthRender=function(t){var r,e,i,n,o,a;return null===(r=this.gl)||void 0===r||r.bindFramebuffer(null===(e=this.gl)||void 0===e?void 0:e.FRAMEBUFFER,t.depthFramebuffer),null===(i=this.gl)||void 0===i||i.viewport(0,0,t.depthTextureSize,t.depthTextureSize),null===(n=this.gl)||void 0===n||n.clear((null===(o=this.gl)||void 0===o?void 0:o.COLOR_BUFFER_BIT)|(null===(a=this.gl)||void 0===a?void 0:a.DEPTH_BUFFER_BIT)),this},t.prototype.fitScreen=function(t,r){return this.setSize(window.innerWidth*(t||1),window.innerHeight*(r||1))},t.prototype.setClearColor=function(t,r,e,i){var n;return void 0===i&&(i=1),null===(n=this.gl)||void 0===n||n.clearColor(t/this.rgb_32_bit,r/this.rgb_32_bit,e/this.rgb_32_bit,i),this},t.prototype.clearFramebuffer=function(){var t,r;return null===(t=this.gl)||void 0===t||t.bindFramebuffer(null===(r=this.gl)||void 0===r?void 0:r.FRAMEBUFFER,null),this},t.prototype.clear=function(){var t,r,e;return null===(t=this.gl)||void 0===t||t.clear((null===(r=this.gl)||void 0===r?void 0:r.COLOR_BUFFER_BIT)|(null===(e=this.gl)||void 0===e?void 0:e.DEPTH_BUFFER_BIT)),this},t.prototype.getContext=function(){return this.gl},t}(),y=function(){function t(t,r,e,i,n,o){void 0===r&&(r=E({red:201,green:226,blue:255})),void 0===e&&(e=E({red:50,green:50,blue:50})),void 0===i&&(i=E({red:255,green:255,blue:255})),void 0===n&&(n=1),void 0===o&&(o=1e3),this.lightPosition=t,this.lightColor=r,this.ambientLightColor=e,this.specularColor=i,this.specularFactor=n,this.shininess=o}return t.prototype.setUniforms=function(t,r){t.uniform3fv(r.lightPositionLoc,[this.lightPosition.x,this.lightPosition.y,this.lightPosition.z]),t.uniform4fv(r.lightColorLoc,this.lightColor),t.uniform4fv(r.ambientLightColorLoc,this.ambientLightColor),t.uniform4fv(r.specularColorLoc,this.specularColor),t.uniform1f(r.specularFactorLoc,this.specularFactor),t.uniform1f(r.shininessLoc,this.shininess)},t}(),L=function(){function t(t){this.mesh=t,this.transform=new R}return t.prototype.setScale=function(t,r,e){return this.transform.scale.set(t,r,e),this},t.prototype.setPosition=function(t,r,e){return this.transform.position.set(t,r,e),this},t.prototype.setRotation=function(t,r,e){return this.transform.rotation.set(t,r,e),this},t.prototype.addScale=function(t,r,e){return this.transform.scale.x+=t,this.transform.scale.y+=r,this.transform.scale.y+=r,this},t.prototype.addPosition=function(t,r,e){return this.transform.position.x+=t,this.transform.position.y+=r,this.transform.position.z+=e,this},t.prototype.addRotation=function(t,r,e){return this.transform.rotation.x+=t,this.transform.rotation.y+=r,this.transform.rotation.z+=e,this},t.prototype.preRender=function(){return this.transform.updateMatrix(),this},t}(),w=function(){function t(t,r,e,i){switch(this.buffer=t.createBuffer(),i){case u.BUFFER_TYPE_ARRAY:t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW);break;case u.BUFFER_TYPE_ELEMENT_ARRAY:t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),t.STATIC_DRAW);break;default:t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW)}this.gl=t,this.size=r.length/e}return t.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)},t.prototype.bindToAttribute=function(t,r,e,i,n){void 0===i&&(i=this.size),void 0===n&&(n=u.BUFFER_TYPE_VERTICES);var o=this.gl;switch(n){case u.BUFFER_TYPE_ARRAY:o.enableVertexAttribArray(t),o.bindBuffer(o.ARRAY_BUFFER,this.buffer),o.vertexAttribPointer(t,i,o.FLOAT,!1,r,e),o.bindBuffer(o.ARRAY_BUFFER,null);break;case u.BUFFER_TYPE_ELEMENT_ARRAY:o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.buffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),o.STATIC_DRAW),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,null);break;default:o.enableVertexAttribArray(t),o.bindBuffer(o.ARRAY_BUFFER,this.buffer),o.vertexAttribPointer(t,i,o.FLOAT,!1,r,e),o.bindBuffer(o.ARRAY_BUFFER,null)}},t}(),F=function(){function t(t,r,e){this.gl=null,this.vertexShader=null,this.fragmentShader=null;var i=this.createShader(t,t.VERTEX_SHADER,r),n=this.createShader(t,t.FRAGMENT_SHADER,e),o=this.createShaderProgram(t,n,i);this.program=o,this.gl=t}return t.prototype.createShader=function(t,r,e){var i=t.createShader(r);return t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(console.error("An error occurred compiling the shaders: "+t.getShaderInfoLog(i)),t.deleteShader(i),null)},t.prototype.createShaderProgram=function(t,r,e){var i=t.createProgram();if(t.attachShader(i,r),t.attachShader(i,e),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw console.error("Error creating shader program.",t.getProgramInfoLog(i)),t.deleteProgram(i),new Error("Failed to link shaderProgram");return this.vertexShader=r,this.fragmentShader=e,t.detachShader(i,r),t.detachShader(i,e),t.deleteShader(e),t.deleteShader(r),i},t.prototype.activateShader=function(){return this.gl.useProgram(this.program),this},t.prototype.deactivateShader=function(){return this.gl.useProgram(null),this},t.prototype.dispose=function(){this.gl.getParameter(this.gl.CURRENT_PROGRAM)===this.program&&this.deactivateShader(),this.gl.deleteProgram(this.program)},t.prototype.renderModel=function(t){var r=this.gl;return t.mesh.noCulling&&r.disable(r.CULL_FACE),t.mesh.doBlending&&r.enable(r.BLEND),r.drawArrays(t.mesh.drawMode,0,t.mesh.vertexCount),t.mesh.noCulling&&r.enable(r.CULL_FACE),t.mesh.doBlending&&r.disable(r.BLEND),this},t}();var P=function(){function t(t,r,e){this.lightViewMatrix=null;var i=new F(t,"#version 300 es\n\t\t\tin vec3 a_position;\n\t\t\tin vec3 a_norm;\n\t\t\tin vec2 a_texCoord;\n\n\t\t\tuniform vec3 u_lightPosition;\n\t\t\tuniform vec3 u_cameraPosition;\n\n\t\t\tuniform mat4 u_mVMatrix;\n\t\t\tuniform mat4 u_cameraViewMatrix;\n\t\t\tuniform mat4 u_pMatrix;\n\t\t\tuniform mat4 u_textureMatrix;\n\n\t\t\tmat4 m_worldMatrix;\n\t\t\tmat4 m_viewProjectionMatrix;\n\t\t\tmat4 m_worldViewProjectionMatrix;\n\t\t\t\n\t\t\tout vec3 v_normal;\n\t\t\tout vec3 v_surfaceToLight;\n\t\t\tout vec3 v_surfaceToCamera;\n\n\t\t\tout vec2 v_texCoord;\n\n\t\t\tvoid main(void){\n\n\t\t\t\tm_worldMatrix = u_mVMatrix;\n\t\t\t\tm_viewProjectionMatrix = u_pMatrix * u_cameraViewMatrix;\n\t\t\t\tm_worldViewProjectionMatrix = m_viewProjectionMatrix * m_worldMatrix;\n\n\t\t\t\tgl_Position = m_worldViewProjectionMatrix * vec4(a_position, 1.0);\n\t\t\t\t\n\t\t\t\tv_normal = (u_cameraViewMatrix * vec4(a_norm, 0.0)).xyz;\n\n\t\t\t\tvec3 v_surfaceWorldPosition = (m_worldMatrix * vec4(a_position, 1.0)).xyz;\n\t\t\t\tv_surfaceToLight = u_lightPosition - v_surfaceWorldPosition;\n\t\t\t\tv_surfaceToCamera = u_cameraPosition - v_surfaceWorldPosition;\n\n\t\t\t\tv_texCoord = a_texCoord;\n\n\t\t\t}","#version 300 es\n\t\t\tprecision highp float;\n\n\t\t\tin vec2 v_texCoord;\n\t\t\tin vec3 v_normal;\n\t\t\tin vec3 v_surfaceToLight;\n\t\t\tin vec3 v_surfaceToCamera;\n\n\t\t\tuniform sampler2D sampler;\n\t\t\tuniform vec4 u_lightColor;\n\t\t\tuniform vec4 u_ambientLightColor;\n\t\t\tuniform vec4 u_specularColor;\n\t\t\tuniform float u_shininess;\n\t\t\tuniform float u_specularFactor;\n\t\t\tuniform vec3 u_reverseLightDirection;\n\n\t\t\tvec4 lit(float l ,float h, float m) {\n\t\t\t\treturn vec4(\n\t\t\t\t\t1.0,\n\t\t\t\t\tabs(l),\n\t\t\t\t\t(l > 0.0) ? pow(max(0.0, h), m) : 0.0,\n\t\t\t\t\t1.0\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tout vec4 finalColor;\n\n\t\t\tvoid main(void) {\n\n\t\t\t\tvec4 texel = texture(sampler, v_texCoord);\n\t\t\t\tvec3 normal = normalize(v_normal);\n\n\t\t\t\tfloat lightIntensity = dot(normal, u_reverseLightDirection);\n\t\t\t\tvec4 diffuse = u_ambientLightColor + u_lightColor * lightIntensity;\n\n\t\t\t\tvec3 surfaceToLightDirection = normalize(v_surfaceToLight);\n\t\t\t\tvec3 surfaceToCameraDirection = normalize(v_surfaceToCamera);\n\t\t\t\tvec3 halfVector = normalize(surfaceToLightDirection + surfaceToCameraDirection);\n\n\t\t\t\tvec4 specularIntensity = lit(dot(normal, surfaceToLightDirection), dot(normal, halfVector), u_shininess);\n\t\t\t\tvec4 specular = u_specularColor * specularIntensity.z * u_specularFactor;\n\t\t\t\tvec4 light = diffuse + specular;\n\n\t\t\t\tvec4 outColor = vec4(texel.rgb * light.xyz, texel.a);\n\n\t\t\t\tfinalColor = outColor;\n\t\t\t}");i.activateShader(),this.positionLoc=t.getAttribLocation(i.program,u.ATTR_POSITION_NAME),this.texCoordLoc=t.getAttribLocation(i.program,u.ATTR_UV_NAME),this.normalLoc=t.getAttribLocation(i.program,u.ATTR_NORMAL_NAME),this.modelViewMatrixLoc=t.getUniformLocation(i.program,u.UNI_MODEL_MAT),this.perspectiveMatrixLoc=t.getUniformLocation(i.program,u.UNI_PERSPECTIV_MAT),this.cameraMatrixLoc=t.getUniformLocation(i.program,u.UNI_CAMERA_MAT),this.projectedTextureLoc=t.getUniformLocation(i.program,u.UNI_PROJECTED_TEXTURE),this.textureMatrixLoc=t.getUniformLocation(i.program,u.UNI_TEXTURE_MAT),this.reverseLightDirectionLoc=t.getUniformLocation(i.program,u.UNI_REVERSE_LIGHT_DIRECTION_MAT),this.diffuseLoc=t.getUniformLocation(i.program,u.UNI_DIFFUSE),this.ambientLightColorLoc=t.getUniformLocation(i.program,u.UNI_LIGHT_AMBIENT),this.lightPositionLoc=t.getUniformLocation(i.program,u.UNI_LIGHT_POSITION),this.cameraPositionLoc=t.getUniformLocation(i.program,u.UNI_CAMERA_POSITION),this.shininessLoc=t.getUniformLocation(i.program,u.UNI_CAMERA_SHININESS),this.lightColorLoc=t.getUniformLocation(i.program,u.UNI_LIGHT_COLOR),this.specularColorLoc=t.getUniformLocation(i.program,u.UNI_SPECULAR_COLOR),this.specularFactorLoc=t.getUniformLocation(i.program,u.UNI_SPECULAR_FACTOR),i.deactivateShader(),this.perspectiveProjectionMatrix=r.perspectiveProjection,this.orthoProjectionMatrix=r.orthoProjection,this.viewModelMatrix=r.viewMatrix,this.lightViewCamera=e,this.sceneViewCamera=r,this.shaderProgram=i}return t.prototype.setUniforms=function(t,r){this.shaderProgram.activateShader();var e=this.getLightWorldMatrix(this.lightViewCamera,r);return t.uniformMatrix4fv(this.perspectiveMatrixLoc,!1,this.perspectiveProjectionMatrix),t.uniformMatrix4fv(this.cameraMatrixLoc,!1,this.viewModelMatrix),t.uniformMatrix4fv(this.textureMatrixLoc,!1,this.getTextureMatrix(e)),t.uniformMatrix4fv(this.modelViewMatrixLoc,!1,r.transform.getModelMatrix()),t.uniform3fv(this.cameraPositionLoc,this.sceneViewCamera.transform.position.getFloatArray()),t.uniform3fv(this.reverseLightDirectionLoc,e.slice(8,11)),this},t.prototype.getTextureMatrix=function(t){var r=T.identity();T.translate(r,.5,.5,.5),T.scale(r,.5,.5,.5),T.mult(r,r,this.orthoProjectionMatrix);var e=[];return T.invert(e,t),T.mult(r,r,e),r},t.prototype.getLightWorldMatrix=function(t,r){return T.lookAt([t.transform.position.x,t.transform.position.y,t.transform.position.z],[r.transform.position.x,r.transform.position.y,r.transform.position.z],[0,1,0])},t}(),I=function(){function t(){}return t.createGeometry=function(r,e,i,n){return new L(t.createMesh(r,e,i,n))},t.createMesh=function(t,r,e,i){var n,o,a,s=e.vertexCount(),c={positions:new w(t,e.positions(),s,u.BUFFER_TYPE_ARRAY),normals:new w(t,e.normals(),s,u.BUFFER_TYPE_ARRAY),uvs:new w(t,e.uvs(),s,u.BUFFER_TYPE_ARRAY),texture:i,drawMode:t.TRIANGLES,vertexCount:s};return null===(n=c.positions)||void 0===n||n.bindToAttribute(r.positionLoc,u.DEFAULT_STRIDE,u.DEFAULT_OFFSET),null===(o=c.normals)||void 0===o||o.bindToAttribute(r.normalLoc,u.DEFAULT_STRIDE,u.DEFAULT_OFFSET),null===(a=c.uvs)||void 0===a||a.bindToAttribute(r.texCoordLoc,u.DEFAULT_STRIDE,u.DEFAULT_OFFSET),c},t}();const U=function(){function t(t){this.surfaces=[],this.surfaces=t}return t.parseOBJ=function(r){for(var e=h.V,i=h.VN,n=h.VT,o=h.F,a=[],s=[],c=[],u=[],l=0,f=r.split("\n");l<f.length;l++){var d=f[l].trim().split(p),E=d[0];if(e===E)a.push(_(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])));else if(i===E)c.push(_(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])));else if(n===E)s.push({x:parseFloat(d[1]),y:1-parseFloat(d[2])});else if(o===E){for(var g=!1,T=!1,R=4,x=[],M=1;M<R;M++){if(d.length>R&&!T)R+=1;else if(4!==M||g){if(5===M&&g)M=1,g=!1,T=!0;else if(2===M&&T)break}else M=3,R+=1,g=!0;var A=d[M].split("/"),y=a[parseInt(A[0])-1],L=s[parseInt(A[1])-1],w=c[parseInt(A[2])-1];x.push(v(y,w,L))}if(x.length>3){var F=x.slice(0,3),P=x.slice(3);u.push(m(F)),u.push(m(P))}else u.push(m(x))}}return new t(u)},t.loadOBJ=function(i){return r(this,void 0,void 0,(function(){var r;return e(this,(function(e){switch(e.label){case 0:return[4,fetch(i)];case 1:return[4,e.sent().text()];case 2:return r=e.sent(),[2,t.parseOBJ(r)]}}))}))},t.prototype.vertexCount=function(){return 3*this.surfaces.length},t.prototype.positions=function(){var t=[];return this.surfaces.forEach((function(r){r.vertices.forEach((function(r){var e=r.position;t.push(e.x,e.y,e.z)}))})),t},t.prototype.normals=function(){var t=[];return this.surfaces.forEach((function(r){r.vertices.forEach((function(r){var e=r.normal;t.push(e.x,e.y,e.z)}))})),t},t.prototype.uvs=function(){var t=[];return this.surfaces.forEach((function(r){r.vertices.forEach((function(r){var e=r.uv;t.push(e.x,e.y)}))})),t},t}();var b=function(){function t(t,r,e){var i=new F(t,"#version 300 es\n            layout(location=5) in vec3 a_position;\n\n\t\t\tuniform mat4 u_mVMatrix;\n\t\t\tuniform mat4 u_cameraViewMatrix;\n\t\t\tuniform mat4 u_pMatrix;\n\n\t\t\tvec3 unprojectPoint(float x, float y, float z, mat4 view, mat4 projection) {\n                mat4 viewInv = inverse(view);\n                mat4 projInv = inverse(projection);\n                vec4 unprojectedPoint =  viewInv * projInv * vec4(x, y, z, 1.0);\n                return unprojectedPoint.xyz / unprojectedPoint.w;\n            }\n\n\t\t\tout vec3 nearPoint;\n\t\t\tout vec3 farPoint;\n\t\t\tout mat4 fragView;\n            out mat4 fragProj;\n\n\t\t\tout vec3 vertexPosition;\n\n\t\t\tvoid main(void){\n\t\t\t\tvec3 p = a_position;\n\n\t\t\t\tfragView = u_cameraViewMatrix;\n                fragProj = u_pMatrix;\n\t\t\t\tnearPoint = unprojectPoint(p.x, p.y, 0.0, u_cameraViewMatrix, u_pMatrix).xyz;\n\t\t\t\tfarPoint = unprojectPoint(p.x, p.y, 1.0, u_cameraViewMatrix, u_pMatrix).xyz;\n\n\t\t\t\tvertexPosition = p.xyz;\n\t\t\t\tgl_Position = vec4(p, 1.0);\n\n\t\t\t}","#version 300 es\n\t\t\tprecision highp float;\n\n\t\t\tin vec3 vertexPosition;\n\t\t\tin vec3 nearPoint;\n            in vec3 farPoint;\n            in mat4 fragView;\n            in mat4 fragProj;\n\n\t\t\t// computes Z-buffer depth value, and converts the range.\n\t\t\tfloat computeDepth(vec3 pos) {\n\t\t\t\t// get the clip-space coordinates\n\t\t\t\tvec4 clip_space_pos = fragProj * fragView * vec4(pos.xyz, 1.0);\n\n\t\t\t\t// get the depth value in normalized device coordinates\n\t\t\t\tfloat clip_space_depth = clip_space_pos.z / clip_space_pos.w;\n\n\t\t\t\t// and compute the range based on gl_DepthRange settings (not necessary with default settings, but left for completeness)\n\t\t\t\tfloat far = gl_DepthRange.far;\n\t\t\t\tfloat near = gl_DepthRange.near;\n\n\t\t\t\tfloat depth = (((far-near) * clip_space_depth) + near + far) / 2.0;\n\n\t\t\t\t// and return the result\n\t\t\t\treturn depth;\n\t\t\t}\n\n\t\t\t\n\t\t\tvec4 grid(vec3 fragPos3D, float scale) {\n                vec2 coord = fragPos3D.xz * scale;\n                vec2 derivative = fwidth(coord);\n                vec2 grid = abs(fract(coord - 0.5) - 0.5) / derivative;\n                float line = min(grid.x, grid.y);\n                float minimumz = min(derivative.y, 1.0);\n                float minimumx = min(derivative.x, 1.0);\n\t\t\t\tvec3 gridColor = vec3(1.0 - min(line, 1.0));\n                vec4 color = vec4(gridColor, 1.0);\n                return color;\n            }\n\n            out vec4 finalColor;\n\n\t\t\tvoid main(void){\n\n                float t = -nearPoint.y / (farPoint.y - nearPoint.y);\n                vec3 fragPos3D = nearPoint + t * (farPoint - nearPoint);\n\t\n\t\t\t\tfloat isIntersect = (t > 0.0) ? 1.0 : 0.0;\n\t\t\t\tfloat linearFieldSection = 0.09 * length(fragPos3D.xz);\n\t\t\t\tfloat fading = min(1.0, 1.5 - linearFieldSection);\n\n\t\t\t\tvec4 gridPattern = grid(fragPos3D, 0.5);\n\t\t\t\t\n\t\t\t\tvec4 outColor = gridPattern;\n\n\t\t\t\tfinalColor = outColor * isIntersect;\n\t\t\t\tfinalColor *= fading;\n\n\t\t\t\tgl_FragDepth = computeDepth(fragPos3D);\n            }");i.activateShader(),this.positionLoc=t.getAttribLocation(i.program,u.ATTR_POSITION_NAME),this.modelViewMatrixLoc=t.getUniformLocation(i.program,u.UNI_MODEL_MAT),this.perspectiveMatrixLoc=t.getUniformLocation(i.program,u.UNI_PERSPECTIV_MAT),this.cameraMatrixLoc=t.getUniformLocation(i.program,u.UNI_CAMERA_MAT),this.uColorLoc=t.getUniformLocation(i.program,u.UNI_COLOR),i.deactivateShader(),this.perspectiveProjectionMatrix=r.perspectiveProjection,this.orthoProjectionMatrix=r.orthoProjection,this.viewModelMatrix=r.viewMatrix,this.lightViewModelMatrix=e,this.shaderProgram=i}return t.prototype.setUniforms=function(t,r){return this.shaderProgram.activateShader(),t.uniformMatrix4fv(this.perspectiveMatrixLoc,!1,this.perspectiveProjectionMatrix),t.uniformMatrix4fv(this.cameraMatrixLoc,!1,this.viewModelMatrix),t.uniformMatrix4fv(this.modelViewMatrixLoc,!1,r.transform.getModelMatrix()),this},t}(),S=function(){function t(){}return t.createGeometry=function(r,e){return new L(t.createMesh(r,e))},t.createMesh=function(t,r){var e,i=[1,-1,0,1,1,0,-1,-1,0,-1,1,0,-1,-1,0,1,1,0],n=i.length/3,o=3*Float32Array.BYTES_PER_ELEMENT,a={positions:new w(t,i,n,u.BUFFER_TYPE_ARRAY),drawMode:t.TRIANGLES,vertexCount:n};return null===(e=a.positions)||void 0===e||e.bindToAttribute(r.positionLoc,o,u.DEFAULT_OFFSET,u.GRID_VECTOR_SIZE),a},t}();const C=function(){function t(t,r){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.generateMipmap(t.TEXTURE_2D),this.gl=t}return t.loadTexture=function(i,n){return r(this,void 0,Promise,(function(){var r;return e(this,(function(e){switch(e.label){case 0:return(r=new Image).src=n,[4,r.decode()];case 1:return e.sent(),[2,new t(i,r)]}}))}))},t}(),O=function(){r(this,void 0,void 0,(function(){var t,r,n,o,s,c,u,h,p,m,v,_,d,E,T,R,L;return e(this,(function(e){switch(e.label){case 0:return t=new i,r=new A(a.WEBGL_CANVAS_ID),o=(n=[.95,.9])[0],s=n[1],r.fitScreen(o,s).setClearColor(13,17,23,1).clear(),c=r.getContext(),u=new g(0,2.5,3),h=new y(u),(p=new x(c)).transform.position.set(u.x,u.y,u.z),[4,U.loadOBJ(l)];case 1:return m=e.sent(),[4,C.loadTexture(c,f)];case 2:return v=e.sent(),(_=new x(c)).transform.position.set(0,.5,1.5),new M(c,_),d=new b(c,_,p),E=S.createGeometry(c,d),T=new P(c,_,p),(R=I.createGeometry(c,T,m,v)).setScale(.0035,.0035,.0035).setRotation(0,30,0),t.setDisplayState(!1),(L=function(){_.updateViewMatrix(),d.setUniforms(c,E.preRender()).shaderProgram.renderModel(E.preRender()),T.setUniforms(c,R.preRender()).shaderProgram.renderModel(R.preRender()),h.setUniforms(c,T),requestAnimationFrame(L)})(),[2]}}))}))};new function(){new O}})();
//# sourceMappingURL=bundle.js.map