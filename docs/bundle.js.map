{"version":3,"sources":["webpack://qrius-engine-webgl/./node_modules/tslib/tslib.es6.js","webpack://qrius-engine-webgl/./src/modules/global_constants.ts","webpack://qrius-engine-webgl/./src/modules/utils.ts","webpack://qrius-engine-webgl/./src/core/glContext.ts","webpack://qrius-engine-webgl/./src/core/math.ts","webpack://qrius-engine-webgl/./src/core/transformation.ts","webpack://qrius-engine-webgl/./src/core/camera.ts","webpack://qrius-engine-webgl/./src/core/geometry.ts","webpack://qrius-engine-webgl/./src/core/Textures/texture.ts","webpack://qrius-engine-webgl/./src/core/vbuffer.ts","webpack://qrius-engine-webgl/./src/core/shaderProgram.ts","webpack://qrius-engine-webgl/./src/core/objLoader.ts","webpack://qrius-engine-webgl/./src/core/model.ts","webpack://qrius-engine-webgl/./src/core/Textures/depthTexture.ts","webpack://qrius-engine-webgl/./src/core/shadows/directional.ts","webpack://qrius-engine-webgl/./src/core/light.ts","webpack://qrius-engine-webgl/./src/core/primitives/grid/infinite.ts","webpack://qrius-engine-webgl/./src/main.ts"],"names":["thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","this","n","v","op","TypeError","call","pop","length","push","ProgramEntrySettings","CameraSettings","CameraControlsSettings","GLSetttings","ShaderProgramMatrixFields","ObjTypes","VertexStruct","position","normal","uv","Vec3Struct","x","z","degToRad","d","Math","PI","normalizeColor","rgb","red","green","blue","Float32Array","WEBGL_CANVAS_ID","gl","rgb_32_bit","alpha","canvas","document","getElementById","getContext","WEBGL_CONTEXT","alert","WEBGL_CONTEXT_ERROR_MESSAGE","cullFace","BACK","frontFace","CCW","enable","DEPTH_TEST","CULL_FACE","depthFunc","LEQUAL","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","setSize","w","h","style","width","height","viewport","depthRender","depthTexture","bindFramebuffer","FRAMEBUFFER","depthFramebuffer","depthTextureSize","fitScreen","wp","hp","window","innerWidth","innerHeight","setClearColor","clearColor","clearFramebuffer","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","magnitude","undefined","sqrt","normalize","mag","set","multiScalar","getArray","getFloatArray","clone","Vector3","matrix","Matrix4","identity","vtranslate","translate","rotateY","rad","rotateX","rotateZ","vscale","vec3","scale","invert","resetRotation","i","resetMat","a","perspective","out","fovy","aspect","near","far","tan","nf","ortho","left","right","bottom","top","lr","bt","lookAt","cameraPosition","target","up","dst","zAxis","subtractVectors","xAxis","cross","yAxis","b","transpose","a01","a02","a03","a12","a13","a23","normalMat3","a00","a10","a11","a20","a21","a22","a30","a31","a32","a33","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","b11","det","multiplyVector","mat4","c1r1","c2r1","c3r1","c4r1","c1r2","c2r2","c3r2","c4r2","c1r3","c2r3","c3r3","c4r3","transformVec4","m","mult","b0","b1","b2","b3","s","sin","c","cos","rotate","axis","b12","b20","b21","b22","len","abs","mat","rotation","matView","matNormal","forward","updateMatrix","updateDirection","getModelMatrix","getNormalMatrix","reset","fov","FIELD_OF_VIEW","NEAR_PLANE","FAR_PLANE","perspectiveProjection","orthoProjection","ratio","transform","viewMatrix","mode","Camera","MODE_ORBIT","panX","updateViewMatrix","panY","panZ","MODE_FREE","camera","box","getBoundingClientRect","rotateRate","ROTATION_RATE","panRate","PAN_RATE","zoomRate","ZOOM_RATE","offsetX","offsetY","initX","initY","prevX","prevY","onUpHandler","onMouseUp","onMoveHandler","onMouseMove","addEventListener","MOUSE_DOWN","onMouseDown","MOUSE_WHEEL","onMouseWheel","getMouseVec2","pageX","pageY","MOUSE_UP","MOUSE_MOVE","removeEventListener","delta","max","min","wheelDelta","detail","dx","dy","shiftKey","mesh","setScale","setPosition","setRotation","addScale","addPosition","addRotation","preRender","image","texture","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_MIN_FILTER","LINEAR_MIPMAP_LINEAR","TEXTURE_MAG_FILTER","LINEAR","generateMipmap","loadTexture","url","Image","onload","Texture","src","data","count","type","buffer","createBuffer","BUFFER_TYPE_VERTICES","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","BUFFER_TYPE_INDICES","ELEMENT_ARRAY_BUFFER","Uint16Array","size","destroy","deleteBuffer","bindToAttribute","stride","offset","enableVertexAttribArray","vertexAttribPointer","FLOAT","vsSource","fsSource","vertexShader","fragmentShader","createShader","VERTEX_SHADER","FRAGMENT_SHADER","shaderProgram","createShaderProgram","program","source","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","console","error","getShaderInfoLog","deleteShader","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","Error","detachShader","activateShader","useProgram","deactivateShader","dispose","getParameter","CURRENT_PROGRAM","renderModel","model","noCulling","disable","doBlending","BLEND","drawArrays","drawMode","vertexCount","surfaces","parseOBJ","POSITION","NORMAL","UV","SURFACE","lines","split","positions","uvs","normals","forEach","line","exec","parseFloat","vertices","part","slice","parseInt","SurfaceStruct","ObjLoader","loadOBJ","fetch","response","text","surface","vertex","lightViewCamera","positionLoc","getAttribLocation","ATTR_POSITION_NAME","texCoordLoc","ATTR_UV_NAME","normalLoc","ATTR_NORMAL_NAME","modelViewMatrixLoc","getUniformLocation","UNI_MODEL_MAT","perspectiveMatrixLoc","UNI_PERSPECTIV_MAT","cameraMatrixLoc","UNI_CAMERA_MAT","projectedTextureLoc","UNI_PROJECTED_TEXTURE","textureMatrixLoc","UNI_TEXTURE_MAT","reverseLightDirectionLoc","UNI_REVERSE_LIGHT_DIRECTION_MAT","diffuseLoc","UNI_DIFFUSE","ambientLightColorLoc","UNI_LIGHT_AMBIENT","lightPositionLoc","UNI_LIGHT_POSITION","cameraPositionLoc","UNI_CAMERA_POSITION","shininessLoc","UNI_CAMERA_SHININESS","lightColorLoc","UNI_LIGHT_COLOR","specularColorLoc","UNI_SPECULAR_COLOR","specularFactorLoc","UNI_SPECULAR_FACTOR","perspectiveProjectionMatrix","orthoProjectionMatrix","viewModelMatrix","lightViewModelMatrix","setUniforms","lightWorldMatrix","getLightWorldMatrix","uniformMatrix4fv","uniform3fv","getTextureMatrix","textureMatrix","inverted","createGeometry","objSrc","textureSrc","Model","createMesh","loadModel","TRIANGLES","DEFAULT_STRIDE","DEFAULT_OFFSET","objVertices","objTexture","all","DEPTH_COMPONENT16","DEPTH_COMPONENT","UNSIGNED_INT","NEAREST","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","createFramebuffer","framebufferTexture2D","DEPTH_ATTACHMENT","unusedTexture","COLOR_ATTACHMENT0","orthoMatrixLoc","UNI_ORTHO_MAT","uColorLoc","UNI_COLOR","uniform4fv","DirectionalShadow","depth","DEPTH_TEXTURE_SIZE","p","lightPosition","specularFactor","lightColor","ambientLightColor","specularColor","shininess","uniform1f","InfiniteGrid","verts","strideLen","BYTES_PER_ELEMENT","GRID_VECTOR_SIZE","glContext","light","lightView","directionalShadowShader","DirectionalShadowShader","PATH_ASSETS_OBJ","directionalShadow","CameraController","infiniteGridShader","InfiniteGridShader","infiniteGrid","modelShader","ModelShader","PATH_ASSETS_TEXTURE","loop","requestAnimationFrame"],"mappings":"mBAmEO,SAAS,EAAUA,EAASC,EAAYC,EAAGC,GAE9C,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUC,GAAS,IAAMC,EAAKN,EAAUO,KAAKF,IAAW,MAAOG,GAAKL,EAAOK,IACpF,SAASC,EAASJ,GAAS,IAAMC,EAAKN,EAAiB,MAAEK,IAAW,MAAOG,GAAKL,EAAOK,IACvF,SAASF,EAAKI,GAJlB,IAAeL,EAIaK,EAAOC,KAAOT,EAAQQ,EAAOL,QAJ1CA,EAIyDK,EAAOL,MAJhDA,aAAiBN,EAAIM,EAAQ,IAAIN,GAAE,SAAUG,GAAWA,EAAQG,OAITO,KAAKR,EAAWK,GAClGH,GAAMN,EAAYA,EAAUa,MAAMhB,EAASC,GAAc,KAAKS,WAI/D,SAAS,EAAYV,EAASiB,GACjC,IAAsGC,EAAGC,EAAGC,EAAGC,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAPJ,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAOK,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEX,KAAMiB,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,mBAAXC,SAA0BP,EAAEO,OAAOC,UAAY,WAAa,OAAOC,OAAUT,EACvJ,SAASM,EAAKI,GAAK,OAAO,SAAUC,GAAK,OACzC,SAAcC,GACV,GAAIf,EAAG,MAAM,IAAIgB,UAAU,mCAC3B,KAAOZ,OACH,GAAIJ,EAAI,EAAGC,IAAMC,EAAY,EAARa,EAAG,GAASd,EAAU,OAAIc,EAAG,GAAKd,EAAS,SAAOC,EAAID,EAAU,SAAMC,EAAEe,KAAKhB,GAAI,GAAKA,EAAET,SAAWU,EAAIA,EAAEe,KAAKhB,EAAGc,EAAG,KAAKnB,KAAM,OAAOM,EAE3J,OADID,EAAI,EAAGC,IAAGa,EAAK,CAAS,EAARA,EAAG,GAAQb,EAAEZ,QACzByB,EAAG,IACP,KAAK,EAAG,KAAK,EAAGb,EAAIa,EAAI,MACxB,KAAK,EAAc,OAAXX,EAAEC,QAAgB,CAAEf,MAAOyB,EAAG,GAAInB,MAAM,GAChD,KAAK,EAAGQ,EAAEC,QAASJ,EAAIc,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKX,EAAEI,IAAIU,MAAOd,EAAEG,KAAKW,MAAO,SACxC,QACI,MAAkBhB,GAAZA,EAAIE,EAAEG,MAAYY,OAAS,GAAKjB,EAAEA,EAAEiB,OAAS,KAAkB,IAAVJ,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEX,EAAI,EAAG,SACjG,GAAc,IAAVW,EAAG,MAAcb,GAAMa,EAAG,GAAKb,EAAE,IAAMa,EAAG,GAAKb,EAAE,IAAM,CAAEE,EAAEC,MAAQU,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYX,EAAEC,MAAQH,EAAE,GAAI,CAAEE,EAAEC,MAAQH,EAAE,GAAIA,EAAIa,EAAI,MAC7D,GAAIb,GAAKE,EAAEC,MAAQH,EAAE,GAAI,CAAEE,EAAEC,MAAQH,EAAE,GAAIE,EAAEI,IAAIY,KAAKL,GAAK,MACvDb,EAAE,IAAIE,EAAEI,IAAIU,MAChBd,EAAEG,KAAKW,MAAO,SAEtBH,EAAKhB,EAAKkB,KAAKnC,EAASsB,GAC1B,MAAOX,GAAKsB,EAAK,CAAC,EAAGtB,GAAIQ,EAAI,EAAK,QAAUD,EAAIE,EAAI,EACtD,GAAY,EAARa,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAEzB,MAAOyB,EAAG,GAAKA,EAAG,QAAK,EAAQnB,MAAM,GArB9BL,CAAK,CAACsB,EAAGC,MChFtD,IAEKO,EAcAC,EAQAC,EAiBAC,EAiCAC,EAOAC,GA/EZ,SAAYL,GACR,mCACA,yBACA,kDACA,mCACA,gCACA,4CACA,2DACA,8DACA,+EACA,qFACA,iDAXJ,CAAYA,MAAoB,KAchC,SAAYC,GACR,gCACA,+BACA,sCACA,6BACA,+BALJ,CAAYA,MAAc,KAQ1B,SAAYC,GACR,2BACA,uBACA,4BACA,wBACA,4BACA,8BACA,qBACA,yBACA,2BACA,yBACA,wCACA,2BACA,+BAbJ,CAAYA,MAAsB,KAiBlC,SAAYC,GACR,uCACA,uCACA,kCACA,4BACA,4BACA,sBACA,iCACA,2CACA,yCACA,yCACA,6BACA,iCACA,4BACA,sCACA,sDACA,4DACA,oCACA,0BACA,6CACA,0CACA,yCACA,uCACA,yCACA,qCACA,iCACA,uCACA,yCACA,gCACA,kCA7BJ,CAAYA,MAAW,KAiCvB,SAAYC,GACR,+BACA,iCACA,yCACA,6BAJJ,CAAYA,MAAyB,KAOrC,SAAYC,GACR,QACA,UACA,UACA,QAJJ,CAAYA,MAAQ,KAOb,ICrFMC,EAAe,SAACC,EAAkBC,EAAgBC,GAAW,OAAGF,SAAQ,EAAEC,OAAM,EAAEC,GAAE,IACpFC,EAAa,SAACC,EAAW/B,EAAWgC,GAAc,OAAGD,EAAC,EAAE/B,EAAC,EAAEgC,EAAC,IAG5DC,EAAW,SAACC,GAAc,OAAAA,EAAIC,KAAKC,GAAK,KAmBxCC,EAAiB,SAACC,GAC3B,IAGM5C,EAAO,CAAE4C,EAAIC,IAFA,IAEkBD,EAAIE,MAFtB,IAE0CF,EAAIG,KAF9C,IADL,GAId,OAAO,IAAIC,aAAahD,I,QC3B5B,WACI,WAAYiD,G,kBAaZ,KAAAC,GAAmC,KACnC,KAAAC,WAAa,IACb,KAAAC,MAAQ,EAdJ,IAAMC,EAASC,SAASC,eAAeN,GACvChC,KAAKiC,GAAKG,EAAOG,WAAW9B,EAAqB+B,eAC1C,QAAP,EAAAxC,KAAKiC,UAAE,OAAIQ,MAAMhC,EAAqBiC,6BAC/B,QAAP,EAAA1C,KAAKiC,UAAE,SAAEU,SAAS3C,KAAKiC,GAAGW,MACnB,QAAP,EAAA5C,KAAKiC,UAAE,SAAEY,UAAU7C,KAAKiC,GAAGa,KACpB,QAAP,EAAA9C,KAAKiC,UAAE,SAAEc,OAAO/C,KAAKiC,GAAGe,YACjB,QAAP,EAAAhD,KAAKiC,UAAE,SAAEc,OAAO/C,KAAKiC,GAAGgB,WACjB,QAAP,EAAAjD,KAAKiC,UAAE,SAAEiB,UAAUlD,KAAKiC,GAAGkB,QACpB,QAAP,EAAAnD,KAAKiC,UAAE,SAAEmB,UAAUpD,KAAKiC,GAAGoB,UAAWrD,KAAKiC,GAAGqB,qBAC9CtD,KAAKoC,OAASA,EAmDtB,OA3CI,YAAAmB,QAAA,SAAQC,EAAWC,G,MAWf,OATAzD,KAAKoC,OAAOsB,MAAMC,MAAQH,EAAI,KAC9BxD,KAAKoC,OAAOsB,MAAME,OAASH,EAAI,KAC/BzD,KAAKoC,OAAOuB,MAAQH,EACpBxD,KAAKoC,OAAOwB,OAASH,EAId,QAAP,EAAAzD,KAAKiC,UAAE,SAAE4B,SAAS,EAAG,EAAGL,EAAGC,GAEpBzD,MAGX,YAAA8D,YAAA,SAAYC,G,UAGR,OAFO,QAAP,EAAA/D,KAAKiC,UAAE,SAAE+B,gBAAuB,QAAP,EAAAhE,KAAKiC,UAAE,eAAEgC,YAAaF,EAAaG,kBACrD,QAAP,EAAAlE,KAAKiC,UAAE,SAAE4B,SAAS,EAAG,EAAGE,EAAaI,iBAAkBJ,EAAaI,kBAC7DnE,MAIX,YAAAoE,UAAA,SAAUC,EAAYC,GAClB,OAAOtE,KAAKuD,QAAQgB,OAAOC,YAAcH,GAAM,GAAIE,OAAOE,aAAeH,GAAM,KAGnF,YAAAI,cAAA,SAAc9C,EAAaC,EAAeC,EAAcK,G,MAEpD,YAFoD,IAAAA,MAAA,GAC7C,QAAP,EAAAnC,KAAKiC,UAAE,SAAE0C,WAAW/C,EAAM5B,KAAKkC,WAAYL,EAAQ7B,KAAKkC,WAAYJ,EAAO9B,KAAKkC,WAAYC,GACrFnC,MAGX,YAAA4E,iBAAA,W,QAEI,OADO,QAAP,EAAA5E,KAAKiC,UAAE,SAAE+B,gBAAuB,QAAP,EAAAhE,KAAKiC,UAAE,eAAEgC,YAAa,MACxCjE,MAGX,YAAA6E,MAAA,W,UAEI,OADO,QAAP,EAAA7E,KAAKiC,UAAE,SAAE4C,OAAa,QAAP,EAAA7E,KAAKiC,UAAE,eAAE6C,mBAA0B,QAAP,EAAA9E,KAAKiC,UAAE,eAAE8C,mBAC7C/E,MAGX,YAAAuC,WAAA,WACI,OAAOvC,KAAKiC,IAEpB,EA9DA,GCCA,iBACI,WAAYb,EAAW/B,EAAWgC,GAC9BrB,KAAKoB,EAAIA,GAAK,EACdpB,KAAKX,EAAIA,GAAK,EACdW,KAAKqB,EAAIA,GAAK,EAwDtB,OAjDI,YAAA2D,UAAA,SAAU9E,GAMN,QANM,IAAAA,MAAA,CACNkB,EAAG,EACH/B,EAAG,EACHgC,EAAG,SAGO4D,IAAN/E,EAAiB,OAAOsB,KAAK0D,KAAKlF,KAAKoB,EAAIpB,KAAKoB,EAAIpB,KAAKX,EAAIW,KAAKX,EAAIW,KAAKqB,EAAIrB,KAAKqB,GAGxF,IAAID,EAAIlB,EAAEkB,EAAIpB,KAAKoB,EACf/B,EAAIa,EAAEb,EAAIW,KAAKX,EACfgC,EAAInB,EAAEb,EAAIW,KAAKqB,EAEnB,OAAOG,KAAK0D,KAAK9D,EAAIA,EAAI/B,EAAIA,EAAIgC,EAAIA,IAGzC,YAAA8D,UAAA,WACI,IAAIC,EAAMpF,KAAKgF,YAIf,OAHAhF,KAAKoB,GAAKgE,EACVpF,KAAKX,GAAK+F,EACVpF,KAAKqB,GAAK+D,EACHpF,MAGX,YAAAqF,IAAA,SAAIjE,EAAW/B,EAAWgC,GAItB,OAHArB,KAAKoB,EAAIA,EACTpB,KAAKX,EAAIA,EACTW,KAAKqB,EAAIA,EACFrB,MAGX,YAAAsF,YAAA,SAAYpF,GAIR,OAHAF,KAAKoB,GAAKlB,EACVF,KAAKX,GAAKa,EACVF,KAAKqB,GAAKnB,EACHF,MAGX,YAAAuF,SAAA,WACI,MAAO,CAACvF,KAAKoB,EAAGpB,KAAKX,EAAGW,KAAKqB,IAGjC,YAAAmE,cAAA,WACI,OAAO,IAAIzD,aAAa,CAAC/B,KAAKoB,EAAGpB,KAAKX,EAAGW,KAAKqB,KAGlD,YAAAoE,MAAA,WACI,OAAO,IAAIC,EAAQ1F,KAAKoB,EAAGpB,KAAKX,EAAGW,KAAKqB,IAEhD,EA5DA,GAgEA,aACI,aACIrB,KAAK2F,OAASC,EAAQC,WA4lB9B,OArlBI,YAAAC,WAAA,SAAW5F,GAEP,OADA0F,EAAQG,UAAU/F,KAAK2F,OAAQzF,EAAEkB,EAAGlB,EAAEb,EAAGa,EAAEmB,GACpCrB,MAEX,YAAA+F,UAAA,SAAU3E,EAAW/B,EAAWgC,GAE5B,OADAuE,EAAQG,UAAU/F,KAAK2F,OAAQvE,EAAG/B,EAAGgC,GAC9BrB,MAGX,YAAAgG,QAAA,SAAQC,GAEJ,OADAL,EAAQI,QAAQhG,KAAK2F,OAAQM,GACtBjG,MAEX,YAAAkG,QAAA,SAAQD,GAEJ,OADAL,EAAQM,QAAQlG,KAAK2F,OAAQM,GACtBjG,MAEX,YAAAmG,QAAA,SAAQF,GAEJ,OADAL,EAAQO,QAAQnG,KAAK2F,OAAQM,GACtBjG,MAGX,YAAAoG,OAAA,SAAOC,GAEH,OADAT,EAAQU,MAAMtG,KAAK2F,OAAQU,EAAKjF,EAAGiF,EAAKhH,EAAGgH,EAAKhF,GACzCrB,MAEX,YAAAsG,MAAA,SAAMlF,EAAW/B,EAAWgC,GAExB,OADAuE,EAAQU,MAAMtG,KAAK2F,OAAQvE,EAAG/B,EAAGgC,GAC1BrB,MAGX,YAAAuG,OAAA,WAEI,OADAX,EAAQW,OAAOvG,KAAK2F,QACb3F,MAMX,YAAAwG,cAAA,WACI,IAAK,IAAIC,EAAI,EAAGA,EAAIzG,KAAK2F,OAAOpF,OAAQkG,IAChCA,GAAK,IAAMA,GAAK,KACpBzG,KAAK2F,OAAOc,GAAMA,EAAI,GAAK,EAAK,EAAI,GAGxC,OAAOzG,MAIX,YAAA0G,SAAA,WACI,IAAK,IAAID,EAAI,EAAGA,EAAIzG,KAAK2F,OAAOpF,OAAQkG,IAAKzG,KAAK2F,OAAOc,GAAMA,EAAI,GAAK,EAAK,EAAI,EACjF,OAAOzG,MAKJ,EAAA6F,SAAP,WACI,IAAIc,EAAI,IAAI5E,aAAa,IAEzB,OADA4E,EAAE,GAAKA,EAAE,GAAKA,EAAE,IAAMA,EAAE,IAAM,EACvBA,GAIJ,EAAAC,YAAP,SAAmBC,EAAmBC,EAAcC,EAAgBC,EAAcC,GAC9E,IAAI7H,EAAI,EAAMoC,KAAK0F,IAAIJ,EAAO,GAC1BK,EAAK,GAAKH,EAAOC,GACrBJ,EAAI,GAAKzH,EAAI2H,EACbF,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAKzH,EACTyH,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,KAAOI,EAAMD,GAAQG,EACzBN,EAAI,KAAO,EACXA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAO,EAAII,EAAMD,EAAQG,EAC7BN,EAAI,IAAM,GAIP,EAAAO,MAAP,SAAaP,EAAmBQ,EAAcC,EAAeC,EAAgBC,EAAaR,EAAcC,GACpG,IAAIQ,EAAK,GAAKJ,EAAOC,GACjBI,EAAK,GAAKH,EAASC,GACnBL,EAAK,GAAKH,EAAOC,GACrBJ,EAAI,IAAM,EAAIY,EACdZ,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM,EAAIa,EACdb,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM,EAAIM,EACdN,EAAI,IAAM,EACVA,EAAI,KAAOQ,EAAOC,GAASG,EAC3BZ,EAAI,KAAOW,EAAMD,GAAUG,EAC3Bb,EAAI,KAAOI,EAAMD,GAAQG,EACzBN,EAAI,IAAM,GAgBP,EAAAc,OAAP,SAAcC,EAAqBC,EAAYC,EAAQC,QAAA,IAAAA,MAAA,MACnDA,EAAMA,GAAO,IAAIhG,aAAa,IAC9B,IAAIiG,EAAQpC,EAAQT,UAAUS,EAAQqC,gBAAgBL,EAAgBC,IAClEK,EAAQtC,EAAQT,UAAUS,EAAQuC,MAAML,EAAIE,IAC5CI,EAAQxC,EAAQT,UAAUS,EAAQuC,MAAMH,EAAOE,IAmBnD,OAjBAH,EAAK,GAAKG,EAAM,GAChBH,EAAK,GAAKG,EAAM,GAChBH,EAAK,GAAKG,EAAM,GAChBH,EAAK,GAAK,EACVA,EAAK,GAAKK,EAAM,GAChBL,EAAK,GAAKK,EAAM,GAChBL,EAAK,GAAKK,EAAM,GAChBL,EAAK,GAAK,EACVA,EAAK,GAAKC,EAAM,GAChBD,EAAK,GAAKC,EAAM,GAChBD,EAAI,IAAMC,EAAM,GAChBD,EAAI,IAAM,EACVA,EAAI,IAAMH,EAAe,GACzBG,EAAI,IAAMH,EAAe,GACzBG,EAAI,IAAMH,EAAe,GACzBG,EAAI,IAAM,EAEHA,GAGJ,EAAAE,gBAAP,SAAuBtB,EAAO0B,EAAON,GAKjC,YALiC,IAAAA,MAAA,OACjCA,EAAMA,GAAO,IAAIhG,aAAa,IAC1B,GAAK4E,EAAE,GAAK0B,EAAE,GAClBN,EAAI,GAAKpB,EAAE,GAAK0B,EAAE,GAClBN,EAAI,GAAKpB,EAAE,GAAK0B,EAAE,GACXN,GAGJ,EAAAI,MAAP,SAAaxB,EAAO0B,EAAON,GAKvB,YALuB,IAAAA,MAAA,OACvBA,EAAMA,GAAO,IAAIhG,aAAa,IAC1B,GAAK4E,EAAE,GAAK0B,EAAE,GAAK1B,EAAE,GAAK0B,EAAE,GAChCN,EAAI,GAAKpB,EAAE,GAAK0B,EAAE,GAAK1B,EAAE,GAAK0B,EAAE,GAChCN,EAAI,GAAKpB,EAAE,GAAK0B,EAAE,GAAK1B,EAAE,GAAK0B,EAAE,GACzBN,GAGJ,EAAA5C,UAAP,SAAiBjF,EAAO6H,QAAA,IAAAA,MAAA,MACpBA,EAAMA,GAAO,IAAIhG,aAAa,GAC9B,IAAIxB,EAASiB,KAAK0D,KAAKhF,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAKA,EAAE,IAO5D,OALIK,EAAS,OACTwH,EAAI,GAAK7H,EAAE,GAAKK,EAChBwH,EAAI,GAAK7H,EAAE,GAAKK,EAChBwH,EAAI,GAAK7H,EAAE,GAAKK,GAEbwH,GAMJ,EAAAO,UAAP,SAAiBzB,EAAmBF,GAEhC,GAAIE,IAAQF,EAAG,CACX,IAAI4B,EAAM5B,EAAE,GACR6B,EAAM7B,EAAE,GACR8B,EAAM9B,EAAE,GACR+B,EAAM/B,EAAE,GACRgC,EAAMhC,EAAE,GACRiC,EAAMjC,EAAE,IACZE,EAAI,GAAKF,EAAE,GACXE,EAAI,GAAKF,EAAE,GACXE,EAAI,GAAKF,EAAE,IACXE,EAAI,GAAK0B,EACT1B,EAAI,GAAKF,EAAE,GACXE,EAAI,GAAKF,EAAE,IACXE,EAAI,GAAK2B,EACT3B,EAAI,GAAK6B,EACT7B,EAAI,IAAMF,EAAE,IACZE,EAAI,IAAM4B,EACV5B,EAAI,IAAM8B,EACV9B,EAAI,IAAM+B,OAEV/B,EAAI,GAAKF,EAAE,GACXE,EAAI,GAAKF,EAAE,GACXE,EAAI,GAAKF,EAAE,GACXE,EAAI,GAAKF,EAAE,IACXE,EAAI,GAAKF,EAAE,GACXE,EAAI,GAAKF,EAAE,GACXE,EAAI,GAAKF,EAAE,GACXE,EAAI,GAAKF,EAAE,IACXE,EAAI,GAAKF,EAAE,GACXE,EAAI,GAAKF,EAAE,GACXE,EAAI,IAAMF,EAAE,IACZE,EAAI,IAAMF,EAAE,IACZE,EAAI,IAAMF,EAAE,GACZE,EAAI,IAAMF,EAAE,GACZE,EAAI,IAAMF,EAAE,IACZE,EAAI,IAAMF,EAAE,IAGhB,OAAOE,GAIJ,EAAAgC,WAAP,SAAkBhC,EAAmBF,GACjC,IAAImC,EAAMnC,EAAE,GACR4B,EAAM5B,EAAE,GACR6B,EAAM7B,EAAE,GACR8B,EAAM9B,EAAE,GACRoC,EAAMpC,EAAE,GACRqC,EAAMrC,EAAE,GACR+B,EAAM/B,EAAE,GACRgC,EAAMhC,EAAE,GACRsC,EAAMtC,EAAE,GACRuC,EAAMvC,EAAE,GACRwC,EAAMxC,EAAE,IACRiC,EAAMjC,EAAE,IACRyC,EAAMzC,EAAE,IACR0C,EAAM1C,EAAE,IACR2C,EAAM3C,EAAE,IACR4C,EAAM5C,EAAE,IAER6C,EAAMV,EAAME,EAAMT,EAAMQ,EACxBU,EAAMX,EAAMJ,EAAMF,EAAMO,EACxBW,EAAMZ,EAAMH,EAAMF,EAAMM,EACxBY,EAAMpB,EAAMG,EAAMF,EAAMQ,EACxBY,EAAMrB,EAAMI,EAAMF,EAAMO,EACxBa,EAAMrB,EAAMG,EAAMF,EAAMC,EACxBoB,EAAMb,EAAMI,EAAMH,EAAME,EACxBW,EAAMd,EAAMK,EAAMH,EAAMC,EACxBY,EAAMf,EAAMM,EAAMX,EAAMQ,EACxBa,EAAMf,EAAMI,EAAMH,EAAME,EACxBa,EAAMhB,EAAMK,EAAMX,EAAMS,EACxBc,EAAMhB,EAAMI,EAAMX,EAAMU,EAGxBc,EAAMZ,EAAMW,EAAMV,EAAMS,EAAMR,EAAMO,EAAMN,EAAMK,EAAMJ,EAAMG,EAAMF,EAAMC,EAE5E,OAAKM,GAELA,EAAM,EAAMA,EAEZvD,EAAI,IAAMmC,EAAMmB,EAAMzB,EAAMwB,EAAMvB,EAAMsB,GAAOG,EAC/CvD,EAAI,IAAM6B,EAAMsB,EAAMjB,EAAMoB,EAAMxB,EAAMoB,GAAOK,EAC/CvD,EAAI,IAAMkC,EAAMmB,EAAMlB,EAAMgB,EAAMrB,EAAMmB,GAAOM,EAE/CvD,EAAI,IAAM2B,EAAM0B,EAAM3B,EAAM4B,EAAM1B,EAAMwB,GAAOG,EAC/CvD,EAAI,IAAMiC,EAAMqB,EAAM3B,EAAMwB,EAAMvB,EAAMsB,GAAOK,EAC/CvD,EAAI,IAAM0B,EAAMyB,EAAMlB,EAAMoB,EAAMzB,EAAMqB,GAAOM,EAE/CvD,EAAI,IAAMwC,EAAMQ,EAAMP,EAAMM,EAAML,EAAMI,GAAOS,EAC/CvD,EAAI,IAAMyC,EAAMI,EAAMN,EAAMS,EAAMN,EAAME,GAAOW,EAC/CvD,EAAI,IAAMuC,EAAMQ,EAAMP,EAAMK,EAAMH,EAAMC,GAAOY,EACxCvD,GAfU,MAsBd,EAAAwD,eAAP,SAAsBC,EAAoBpK,GACtC,IAAIkB,EAAIlB,EAAE,GACNb,EAAIa,EAAE,GACNmB,EAAInB,EAAE,GACNsD,EAAItD,EAAE,GACNqK,EAAOD,EAAK,GACZE,EAAOF,EAAK,GACZG,EAAOH,EAAK,GACZI,EAAOJ,EAAK,GACZK,EAAOL,EAAK,GACZM,EAAON,EAAK,GACZO,EAAOP,EAAK,GACZQ,EAAOR,EAAK,GACZS,EAAOT,EAAK,GACZU,EAAOV,EAAK,GACZW,EAAOX,EAAK,IACZY,EAAOZ,EAAK,IAMhB,MAAO,CACHlJ,EAAImJ,EAAOlL,EAAIsL,EAAOtJ,EAAI0J,EAAOvH,EAN1B8G,EAAK,IAOZlJ,EAAIoJ,EAAOnL,EAAIuL,EAAOvJ,EAAI2J,EAAOxH,EAN1B8G,EAAK,IAOZlJ,EAAIqJ,EAAOpL,EAAIwL,EAAOxJ,EAAI4J,EAAOzH,EAN1B8G,EAAK,IAOZlJ,EAAIsJ,EAAOrL,EAAIyL,EAAOzJ,EAAI6J,EAAO1H,EAN1B8G,EAAK,MAWb,EAAAa,cAAP,SAAqBtE,EAAmB3G,EAAakL,GAKjD,OAJAvE,EAAI,GAAKuE,EAAE,GAAKlL,EAAE,GAAKkL,EAAE,GAAKlL,EAAE,GAAKkL,EAAE,GAAKlL,EAAE,GAAKkL,EAAE,IAAMlL,EAAE,GAC7D2G,EAAI,GAAKuE,EAAE,GAAKlL,EAAE,GAAKkL,EAAE,GAAKlL,EAAE,GAAKkL,EAAE,GAAKlL,EAAE,GAAKkL,EAAE,IAAMlL,EAAE,GAC7D2G,EAAI,GAAKuE,EAAE,GAAKlL,EAAE,GAAKkL,EAAE,GAAKlL,EAAE,GAAKkL,EAAE,IAAMlL,EAAE,GAAKkL,EAAE,IAAMlL,EAAE,GAC9D2G,EAAI,GAAKuE,EAAE,GAAKlL,EAAE,GAAKkL,EAAE,GAAKlL,EAAE,GAAKkL,EAAE,IAAMlL,EAAE,GAAKkL,EAAE,IAAMlL,EAAE,GACvD2G,GAKJ,EAAAwE,KAAP,SAAYxE,EAAmBF,EAAiB0B,GAC5C,IAAIS,EAAMnC,EAAE,GACR4B,EAAM5B,EAAE,GACR6B,EAAM7B,EAAE,GACR8B,EAAM9B,EAAE,GACRoC,EAAMpC,EAAE,GACRqC,EAAMrC,EAAE,GACR+B,EAAM/B,EAAE,GACRgC,EAAMhC,EAAE,GACRsC,EAAMtC,EAAE,GACRuC,EAAMvC,EAAE,GACRwC,EAAMxC,EAAE,IACRiC,EAAMjC,EAAE,IACRyC,EAAMzC,EAAE,IACR0C,EAAM1C,EAAE,IACR2C,EAAM3C,EAAE,IACR4C,EAAM5C,EAAE,IAGR2E,EAAKjD,EAAE,GACPkD,EAAKlD,EAAE,GACPmD,EAAKnD,EAAE,GACPoD,EAAKpD,EAAE,GAgCX,OA/BAxB,EAAI,GAAKyE,EAAKxC,EAAMyC,EAAKxC,EAAMyC,EAAKvC,EAAMwC,EAAKrC,EAC/CvC,EAAI,GAAKyE,EAAK/C,EAAMgD,EAAKvC,EAAMwC,EAAKtC,EAAMuC,EAAKpC,EAC/CxC,EAAI,GAAKyE,EAAK9C,EAAM+C,EAAK7C,EAAM8C,EAAKrC,EAAMsC,EAAKnC,EAC/CzC,EAAI,GAAKyE,EAAK7C,EAAM8C,EAAK5C,EAAM6C,EAAK5C,EAAM6C,EAAKlC,EAE/C+B,EAAKjD,EAAE,GACPkD,EAAKlD,EAAE,GACPmD,EAAKnD,EAAE,GACPoD,EAAKpD,EAAE,GACPxB,EAAI,GAAKyE,EAAKxC,EAAMyC,EAAKxC,EAAMyC,EAAKvC,EAAMwC,EAAKrC,EAC/CvC,EAAI,GAAKyE,EAAK/C,EAAMgD,EAAKvC,EAAMwC,EAAKtC,EAAMuC,EAAKpC,EAC/CxC,EAAI,GAAKyE,EAAK9C,EAAM+C,EAAK7C,EAAM8C,EAAKrC,EAAMsC,EAAKnC,EAC/CzC,EAAI,GAAKyE,EAAK7C,EAAM8C,EAAK5C,EAAM6C,EAAK5C,EAAM6C,EAAKlC,EAE/C+B,EAAKjD,EAAE,GACPkD,EAAKlD,EAAE,GACPmD,EAAKnD,EAAE,IACPoD,EAAKpD,EAAE,IACPxB,EAAI,GAAKyE,EAAKxC,EAAMyC,EAAKxC,EAAMyC,EAAKvC,EAAMwC,EAAKrC,EAC/CvC,EAAI,GAAKyE,EAAK/C,EAAMgD,EAAKvC,EAAMwC,EAAKtC,EAAMuC,EAAKpC,EAC/CxC,EAAI,IAAMyE,EAAK9C,EAAM+C,EAAK7C,EAAM8C,EAAKrC,EAAMsC,EAAKnC,EAChDzC,EAAI,IAAMyE,EAAK7C,EAAM8C,EAAK5C,EAAM6C,EAAK5C,EAAM6C,EAAKlC,EAEhD+B,EAAKjD,EAAE,IACPkD,EAAKlD,EAAE,IACPmD,EAAKnD,EAAE,IACPoD,EAAKpD,EAAE,IACPxB,EAAI,IAAMyE,EAAKxC,EAAMyC,EAAKxC,EAAMyC,EAAKvC,EAAMwC,EAAKrC,EAChDvC,EAAI,IAAMyE,EAAK/C,EAAMgD,EAAKvC,EAAMwC,EAAKtC,EAAMuC,EAAKpC,EAChDxC,EAAI,IAAMyE,EAAK9C,EAAM+C,EAAK7C,EAAM8C,EAAKrC,EAAMsC,EAAKnC,EAChDzC,EAAI,IAAMyE,EAAK7C,EAAM8C,EAAK5C,EAAM6C,EAAK5C,EAAM6C,EAAKlC,EACzC1C,GAMJ,EAAAP,MAAP,SAAaO,EAAmBzF,EAAW/B,EAAWgC,GAalD,OAZAwF,EAAI,IAAMzF,EACVyF,EAAI,IAAMzF,EACVyF,EAAI,IAAMzF,EACVyF,EAAI,IAAMzF,EACVyF,EAAI,IAAMxH,EACVwH,EAAI,IAAMxH,EACVwH,EAAI,IAAMxH,EACVwH,EAAI,IAAMxH,EACVwH,EAAI,IAAMxF,EACVwF,EAAI,IAAMxF,EACVwF,EAAI,KAAOxF,EACXwF,EAAI,KAAOxF,EACJwF,GAGJ,EAAAb,QAAP,SAAea,EAAmBZ,GAC9B,IAAIyF,EAAIlK,KAAKmK,IAAI1F,GACb2F,EAAIpK,KAAKqK,IAAI5F,GACb6C,EAAMjC,EAAI,GACV0B,EAAM1B,EAAI,GACV2B,EAAM3B,EAAI,GACV4B,EAAM5B,EAAI,GACVoC,EAAMpC,EAAI,GACVqC,EAAMrC,EAAI,GACVsC,EAAMtC,EAAI,IACV+B,EAAM/B,EAAI,IAWd,OARAA,EAAI,GAAKiC,EAAM8C,EAAI3C,EAAMyC,EACzB7E,EAAI,GAAK0B,EAAMqD,EAAI1C,EAAMwC,EACzB7E,EAAI,GAAK2B,EAAMoD,EAAIzC,EAAMuC,EACzB7E,EAAI,GAAK4B,EAAMmD,EAAIhD,EAAM8C,EACzB7E,EAAI,GAAKiC,EAAM4C,EAAIzC,EAAM2C,EACzB/E,EAAI,GAAK0B,EAAMmD,EAAIxC,EAAM0C,EACzB/E,EAAI,IAAM2B,EAAMkD,EAAIvC,EAAMyC,EAC1B/E,EAAI,IAAM4B,EAAMiD,EAAI9C,EAAMgD,EACnB/E,GAGJ,EAAAX,QAAP,SAAeW,EAAmBZ,GAC9B,IAAIyF,EAAIlK,KAAKmK,IAAI1F,GACb2F,EAAIpK,KAAKqK,IAAI5F,GACb8C,EAAMlC,EAAI,GACVmC,EAAMnC,EAAI,GACV6B,EAAM7B,EAAI,GACV8B,EAAM9B,EAAI,GACVoC,EAAMpC,EAAI,GACVqC,EAAMrC,EAAI,GACVsC,EAAMtC,EAAI,IACV+B,EAAM/B,EAAI,IAWd,OARAA,EAAI,GAAKkC,EAAM6C,EAAI3C,EAAMyC,EACzB7E,EAAI,GAAKmC,EAAM4C,EAAI1C,EAAMwC,EACzB7E,EAAI,GAAK6B,EAAMkD,EAAIzC,EAAMuC,EACzB7E,EAAI,GAAK8B,EAAMiD,EAAIhD,EAAM8C,EACzB7E,EAAI,GAAKoC,EAAM2C,EAAI7C,EAAM2C,EACzB7E,EAAI,GAAKqC,EAAM0C,EAAI5C,EAAM0C,EACzB7E,EAAI,IAAMsC,EAAMyC,EAAIlD,EAAMgD,EAC1B7E,EAAI,IAAM+B,EAAMgD,EAAIjD,EAAM+C,EACnB7E,GAGJ,EAAAV,QAAP,SAAeU,EAAmBZ,GAC9B,IAAIyF,EAAIlK,KAAKmK,IAAI1F,GACb2F,EAAIpK,KAAKqK,IAAI5F,GACb6C,EAAMjC,EAAI,GACV0B,EAAM1B,EAAI,GACV2B,EAAM3B,EAAI,GACV4B,EAAM5B,EAAI,GACVkC,EAAMlC,EAAI,GACVmC,EAAMnC,EAAI,GACV6B,EAAM7B,EAAI,GACV8B,EAAM9B,EAAI,GAWd,OARAA,EAAI,GAAKiC,EAAM8C,EAAI7C,EAAM2C,EACzB7E,EAAI,GAAK0B,EAAMqD,EAAI5C,EAAM0C,EACzB7E,EAAI,GAAK2B,EAAMoD,EAAIlD,EAAMgD,EACzB7E,EAAI,GAAK4B,EAAMmD,EAAIjD,EAAM+C,EACzB7E,EAAI,GAAKkC,EAAM6C,EAAI9C,EAAM4C,EACzB7E,EAAI,GAAKmC,EAAM4C,EAAIrD,EAAMmD,EACzB7E,EAAI,GAAK6B,EAAMkD,EAAIpD,EAAMkD,EACzB7E,EAAI,GAAK8B,EAAMiD,EAAInD,EAAMiD,EAClB7E,GAGJ,EAAAiF,OAAP,SAAcjF,EAAmBZ,EAAa8F,GAC1C,IAIIL,EAAGE,EAAGtM,EACNwJ,EAAKP,EAAKC,EAAKC,EACfM,EAAKC,EAAKN,EAAKC,EACfM,EAAKC,EAAKC,EAAKP,EACfY,EAAKC,EAAKC,EACVQ,EAAKC,EAAK6B,EACVC,EAAKC,EAAKC,EAVV/K,EAAI2K,EAAK,GACT1M,EAAI0M,EAAK,GACT1K,EAAI0K,EAAK,GACTK,EAAM5K,KAAK0D,KAAK9D,EAAIA,EAAI/B,EAAIA,EAAIgC,EAAIA,GASxC,GAAIG,KAAK6K,IAAID,GAAO,KAChB,OAAO,KAIXhL,GADAgL,EAAM,EAAIA,EAEV/M,GAAK+M,EACL/K,GAAK+K,EAELV,EAAIlK,KAAKmK,IAAI1F,GAEb3G,EAAI,GADJsM,EAAIpK,KAAKqK,IAAI5F,IAGb6C,EAAMjC,EAAI,GACV0B,EAAM1B,EAAI,GACV2B,EAAM3B,EAAI,GACV4B,EAAM5B,EAAI,GACVkC,EAAMlC,EAAI,GACVmC,EAAMnC,EAAI,GACV6B,EAAM7B,EAAI,GACV8B,EAAM9B,EAAI,GACVoC,EAAMpC,EAAI,GACVqC,EAAMrC,EAAI,GACVsC,EAAMtC,EAAI,IACV+B,EAAM/B,EAAI,IAGV2C,EAAMpI,EAAIA,EAAI9B,EAAIsM,EAClBnC,EAAMpK,EAAI+B,EAAI9B,EAAI+B,EAAIqK,EACtBhC,EAAMrI,EAAID,EAAI9B,EAAID,EAAIqM,EACtBxB,EAAM9I,EAAI/B,EAAIC,EAAI+B,EAAIqK,EACtBvB,EAAM9K,EAAIA,EAAIC,EAAIsM,EAClBI,EAAM3K,EAAIhC,EAAIC,EAAI8B,EAAIsK,EACtBO,EAAM7K,EAAIC,EAAI/B,EAAID,EAAIqM,EACtBQ,EAAM7M,EAAIgC,EAAI/B,EAAI8B,EAAIsK,EACtBS,EAAM9K,EAAIA,EAAI/B,EAAIsM,EAGlB/E,EAAI,GAAKiC,EAAMU,EAAMT,EAAMU,EAAMR,EAAMS,EACvC7C,EAAI,GAAK0B,EAAMiB,EAAMR,EAAMS,EAAMP,EAAMQ,EACvC7C,EAAI,GAAK2B,EAAMgB,EAAMd,EAAMe,EAAMN,EAAMO,EACvC7C,EAAI,GAAK4B,EAAMe,EAAMb,EAAMc,EAAMb,EAAMc,EACvC7C,EAAI,GAAKiC,EAAMoB,EAAMnB,EAAMoB,EAAMlB,EAAM+C,EACvCnF,EAAI,GAAK0B,EAAM2B,EAAMlB,EAAMmB,EAAMjB,EAAM8C,EACvCnF,EAAI,GAAK2B,EAAM0B,EAAMxB,EAAMyB,EAAMhB,EAAM6C,EACvCnF,EAAI,GAAK4B,EAAMyB,EAAMvB,EAAMwB,EAAMvB,EAAMoD,EACvCnF,EAAI,GAAKiC,EAAMmD,EAAMlD,EAAMmD,EAAMjD,EAAMkD,EACvCtF,EAAI,GAAK0B,EAAM0D,EAAMjD,EAAMkD,EAAMhD,EAAMiD,EACvCtF,EAAI,IAAM2B,EAAMyD,EAAMvD,EAAMwD,EAAM/C,EAAMgD,EACxCtF,EAAI,IAAM4B,EAAMwD,EAAMtD,EAAMuD,EAAMtD,EAAMuD,GAGrC,EAAA5F,OAAP,SAAcM,EAAmByF,QACjBrH,IAARqH,IAAmBA,EAAMzF,GAE7B,IAAIiC,EAAMwD,EAAI,GACV/D,EAAM+D,EAAI,GACV9D,EAAM8D,EAAI,GACV7D,EAAM6D,EAAI,GACVvD,EAAMuD,EAAI,GACVtD,EAAMsD,EAAI,GACV5D,EAAM4D,EAAI,GACV3D,EAAM2D,EAAI,GACVrD,EAAMqD,EAAI,GACVpD,EAAMoD,EAAI,GACVnD,EAAMmD,EAAI,IACV1D,EAAM0D,EAAI,IACVlD,EAAMkD,EAAI,IACVjD,EAAMiD,EAAI,IACVhD,EAAMgD,EAAI,IACV/C,EAAM+C,EAAI,IAEV9C,EAAMV,EAAME,EAAMT,EAAMQ,EACxBU,EAAMX,EAAMJ,EAAMF,EAAMO,EACxBW,EAAMZ,EAAMH,EAAMF,EAAMM,EACxBY,EAAMpB,EAAMG,EAAMF,EAAMQ,EACxBY,EAAMrB,EAAMI,EAAMF,EAAMO,EACxBa,EAAMrB,EAAMG,EAAMF,EAAMC,EACxBoB,EAAMb,EAAMI,EAAMH,EAAME,EACxBW,EAAMd,EAAMK,EAAMH,EAAMC,EACxBY,EAAMf,EAAMM,EAAMX,EAAMQ,EACxBa,EAAMf,EAAMI,EAAMH,EAAME,EACxBa,EAAMhB,EAAMK,EAAMX,EAAMS,EACxBc,EAAMhB,EAAMI,EAAMX,EAAMU,EAGxBc,EAAMZ,EAAMW,EAAMV,EAAMS,EAAMR,EAAMO,EAAMN,EAAMK,EAAMJ,EAAMG,EAAMF,EAAMC,EAE5E,QAAKM,IACLA,EAAM,EAAMA,EAEZvD,EAAI,IAAMmC,EAAMmB,EAAMzB,EAAMwB,EAAMvB,EAAMsB,GAAOG,EAC/CvD,EAAI,IAAM2B,EAAM0B,EAAM3B,EAAM4B,EAAM1B,EAAMwB,GAAOG,EAC/CvD,EAAI,IAAMwC,EAAMQ,EAAMP,EAAMM,EAAML,EAAMI,GAAOS,EAC/CvD,EAAI,IAAMsC,EAAMS,EAAMV,EAAMW,EAAMjB,EAAMe,GAAOS,EAC/CvD,EAAI,IAAM6B,EAAMsB,EAAMjB,EAAMoB,EAAMxB,EAAMoB,GAAOK,EAC/CvD,EAAI,IAAMiC,EAAMqB,EAAM3B,EAAMwB,EAAMvB,EAAMsB,GAAOK,EAC/CvD,EAAI,IAAMyC,EAAMI,EAAMN,EAAMS,EAAMN,EAAME,GAAOW,EAC/CvD,EAAI,IAAMoC,EAAMY,EAAMV,EAAMO,EAAMd,EAAMa,GAAOW,EAC/CvD,EAAI,IAAMkC,EAAMmB,EAAMlB,EAAMgB,EAAMrB,EAAMmB,GAAOM,EAC/CvD,EAAI,IAAM0B,EAAMyB,EAAMlB,EAAMoB,EAAMzB,EAAMqB,GAAOM,EAC/CvD,EAAI,KAAOuC,EAAMQ,EAAMP,EAAMK,EAAMH,EAAMC,GAAOY,EAChDvD,EAAI,KAAOqC,EAAMQ,EAAMT,EAAMW,EAAMhB,EAAMY,GAAOY,EAChDvD,EAAI,KAAOmC,EAAMe,EAAMhB,EAAMkB,EAAMvB,EAAMoB,GAAOM,EAChDvD,EAAI,KAAOiC,EAAMmB,EAAM1B,EAAMwB,EAAMvB,EAAMsB,GAAOM,EAChDvD,EAAI,KAAOwC,EAAMI,EAAML,EAAMO,EAAML,EAAME,GAAOY,EAChDvD,EAAI,KAAOoC,EAAMU,EAAMT,EAAMO,EAAMN,EAAMK,GAAOY,GAEzC,IAIJ,EAAArE,UAAP,SAAiBc,EAAmBzF,EAAW/B,EAAWgC,GACtDwF,EAAI,IAAMA,EAAI,GAAKzF,EAAIyF,EAAI,GAAKxH,EAAIwH,EAAI,GAAKxF,EAAIwF,EAAI,IACrDA,EAAI,IAAMA,EAAI,GAAKzF,EAAIyF,EAAI,GAAKxH,EAAIwH,EAAI,GAAKxF,EAAIwF,EAAI,IACrDA,EAAI,IAAMA,EAAI,GAAKzF,EAAIyF,EAAI,GAAKxH,EAAIwH,EAAI,IAAMxF,EAAIwF,EAAI,IACtDA,EAAI,IAAMA,EAAI,GAAKzF,EAAIyF,EAAI,GAAKxH,EAAIwH,EAAI,IAAMxF,EAAIwF,EAAI,KAE9D,EA9lBA,G,QClEA,WAEI,aAGI7G,KAAKgB,SAAW,IAAI0E,EAAQ,EAAG,EAAG,GAClC1F,KAAKsG,MAAQ,IAAIZ,EAAQ,EAAG,EAAG,GAC/B1F,KAAKuM,SAAW,IAAI7G,EAAQ,EAAG,EAAG,GAClC1F,KAAKwM,QAAU,IAAI5G,EACnB5F,KAAKyM,UAAY,IAAI1K,aAAa,GAGlC/B,KAAK0M,QAAU,IAAI3K,aAAa,GAChC/B,KAAK8H,GAAK,IAAI/F,aAAa,GAC3B/B,KAAKsH,MAAQ,IAAIvF,aAAa,GAoDtC,OAvCI,YAAA4K,aAAA,WAgBI,OAfA3M,KAAKwM,QAAQ9F,WACRZ,WAAW9F,KAAKgB,UAChBkF,QAAQ5E,EAAStB,KAAKuM,SAASnL,IAC/B4E,QAAQ1E,EAAStB,KAAKuM,SAASlN,IAC/B8G,QAAQ7E,EAAStB,KAAKuM,SAASlL,IAC/B+E,OAAOpG,KAAKsG,OAGjBV,EAAQiD,WAAW7I,KAAKyM,UAAWzM,KAAKwM,QAAQ7G,QAGhDC,EAAQuF,cAAcnL,KAAK0M,QAAS,CAAC,EAAG,EAAG,EAAG,GAAI1M,KAAKwM,QAAQ7G,QAC/DC,EAAQuF,cAAcnL,KAAK8H,GAAI,CAAC,EAAG,EAAG,EAAG,GAAI9H,KAAKwM,QAAQ7G,QAC1DC,EAAQuF,cAAcnL,KAAKsH,MAAO,CAAC,EAAG,EAAG,EAAG,GAAItH,KAAKwM,QAAQ7G,QAEtD3F,KAAKwM,QAAQ7G,QAGxB,YAAAiH,gBAAA,WAII,OAHAhH,EAAQuF,cAAcnL,KAAK0M,QAAS,CAAC,EAAG,EAAG,EAAG,GAAI1M,KAAKwM,QAAQ7G,QAC/DC,EAAQuF,cAAcnL,KAAK8H,GAAI,CAAC,EAAG,EAAG,EAAG,GAAI9H,KAAKwM,QAAQ7G,QAC1DC,EAAQuF,cAAcnL,KAAKsH,MAAO,CAAC,EAAG,EAAG,EAAG,GAAItH,KAAKwM,QAAQ7G,QACtD3F,MAGX,YAAA6M,eAAA,WACI,OAAO7M,KAAKwM,QAAQ7G,QAGxB,YAAAmH,gBAAA,WACI,OAAO9M,KAAKyM,WAGhB,YAAAM,MAAA,WACI/M,KAAKgB,SAASqE,IAAI,EAAG,EAAG,GACxBrF,KAAKsG,MAAMjB,IAAI,EAAG,EAAG,GACrBrF,KAAKuM,SAASlH,IAAI,EAAG,EAAG,IAEhC,EAlEA,GCGA,iBACE,WAAYpD,EAA2B+K,EAA4ChG,EAA0CC,QAAtF,IAAA+F,MAActM,EAAeuM,oBAAe,IAAAjG,MAAetG,EAAewM,iBAAY,IAAAjG,MAAcvG,EAAeyM,WAExJnN,KAAKoN,sBAAwB,IAAIrL,aAAa,IAC9C/B,KAAKqN,gBAAkB,IAAItL,aAAa,IAExC,IAAMuL,EAAQrL,EAAGG,OAAOuB,MAAQ1B,EAAGG,OAAOwB,OACpCyD,GAASpF,EAAGG,OAAOuB,MAAQ,EAC3B2D,EAAQrF,EAAGG,OAAOuB,MAAQ,EAC1B6D,EAAMvF,EAAGG,OAAOwB,OAAS,EACzB2D,GAAWtF,EAAGG,OAAOwB,OAAS,EAEpCgC,EAAQgB,YAAY5G,KAAKoN,sBAAuBJ,EAAKM,EAAOtG,EAAMC,GAClErB,EAAQwB,MAAMpH,KAAKqN,gBAAiBhG,EAAMC,EAAOC,EAAQC,EAAK,EAAG,IAEjExH,KAAKuN,UAAY,IAAI,EACrBvN,KAAKwN,WAAa,IAAIzL,aAAa,IAEnC/B,KAAKyN,KAAOC,EAAOC,WAiEvB,OArDE,YAAAC,KAAA,SAAK1N,GACCF,KAAKyN,MAAQC,EAAOC,aACxB3N,KAAK6N,mBACL7N,KAAKuN,UAAUvM,SAASI,GAAKpB,KAAKuN,UAAUjG,MAAM,GAAKpH,EACvDF,KAAKuN,UAAUvM,SAAS3B,GAAKW,KAAKuN,UAAUjG,MAAM,GAAKpH,EACvDF,KAAKuN,UAAUvM,SAASK,GAAKrB,KAAKuN,UAAUjG,MAAM,GAAKpH,IAGzD,YAAA4N,KAAA,SAAK5N,GACHF,KAAK6N,mBACL7N,KAAKuN,UAAUvM,SAAS3B,GAAKW,KAAKuN,UAAUzF,GAAG,GAAK5H,EAChDF,KAAKyN,MAAQC,EAAOC,aACxB3N,KAAKuN,UAAUvM,SAASI,GAAKpB,KAAKuN,UAAUzF,GAAG,GAAK5H,EACpDF,KAAKuN,UAAUvM,SAASK,GAAKrB,KAAKuN,UAAUzF,GAAG,GAAK5H,IAGtD,YAAA6N,KAAA,SAAK7N,GACHF,KAAK6N,mBACD7N,KAAKyN,MAAQC,EAAOC,WACtB3N,KAAKuN,UAAUvM,SAASK,GAAKnB,GAG7BF,KAAKuN,UAAUvM,SAASI,GAAKpB,KAAKuN,UAAUb,QAAQ,GAAKxM,EACzDF,KAAKuN,UAAUvM,SAAS3B,GAAKW,KAAKuN,UAAUb,QAAQ,GAAKxM,EACzDF,KAAKuN,UAAUvM,SAASK,GAAKrB,KAAKuN,UAAUb,QAAQ,GAAKxM,IAM7D,YAAA2N,iBAAA,WAqBE,OAnBI7N,KAAKyN,MAAQC,EAAOM,UACtBhO,KAAKuN,UAAUf,QAAQ9F,WACpBZ,WAAW9F,KAAKuN,UAAUvM,UAC1BkF,QAAQ5E,EAAStB,KAAKuN,UAAUhB,SAASnL,IACzC4E,QAAQ1E,EAAStB,KAAKuN,UAAUhB,SAASlN,IAG5CW,KAAKuN,UAAUf,QAAQ9F,WACpBR,QAAQ5E,EAAStB,KAAKuN,UAAUhB,SAASnL,IACzC4E,QAAQ1E,EAAStB,KAAKuN,UAAUhB,SAASlN,IACzCyG,WAAW9F,KAAKuN,UAAUvM,UAI/BhB,KAAKuN,UAAUX,kBAGfhH,EAAQW,OAAOvG,KAAKwN,WAAYxN,KAAKuN,UAAUf,QAAQ7G,QAEhD3F,KAAKwN,YAtDP,EAAAQ,UAAYtN,EAAesN,UAC3B,EAAAL,WAAajN,EAAeiN,WAuDrC,EAnFA,GAqFA,aACE,WAAY1L,EAA2BgM,GAAvC,WACQC,EAAOjM,EAAGG,OAA6B+L,wBAC7CnO,KAAKoC,OAASH,EAAGG,OACjBpC,KAAKiO,OAASA,EAEdjO,KAAKoO,WAAazN,EAAuB0N,cACzCrO,KAAKsO,QAAU3N,EAAuB4N,SACtCvO,KAAKwO,SAAW7N,EAAuB8N,UAEvCzO,KAAK0O,QAAUR,EAAI7G,KACnBrH,KAAK2O,QAAUT,EAAI1G,IAEnBxH,KAAK4O,MAAQ,EACb5O,KAAK6O,MAAQ,EACb7O,KAAK8O,MAAQ,EACb9O,KAAK+O,MAAQ,EAEf/O,KAAKgP,YAAc,SAACnQ,GAAkB,SAAKoQ,UAAUpQ,IACrDmB,KAAKkP,cAAgB,SAACrQ,GAAkB,SAAKsQ,YAAYtQ,IAEzDmB,KAAKoC,OAAOgN,iBAAiBzO,EAAuB0O,YAAY,SAACxQ,GAAkB,SAAKyQ,YAAYzQ,MACpGmB,KAAKoC,OAAOgN,iBAAiBzO,EAAuB4O,aAAa,SAAC1Q,GAAc,SAAK2Q,aAAa3Q,MAgEpG,OA9CE,YAAA4Q,aAAA,SAAa5Q,GACX,MAAO,CACLuC,EAAGvC,EAAE6Q,MAAQ1P,KAAK0O,QAClBrP,EAAGR,EAAE8Q,MAAQ3P,KAAK2O,UAMtB,YAAAW,YAAA,SAAYzQ,GACVmB,KAAK4O,MAAQ5O,KAAK8O,MAAQjQ,EAAE6Q,MAAQ1P,KAAK0O,QACzC1O,KAAK6O,MAAQ7O,KAAK+O,MAAQlQ,EAAE8Q,MAAQ3P,KAAK2O,QAEzC3O,KAAKoC,OAAOgN,iBAAiBzO,EAAuBiP,SAAU5P,KAAKgP,aACnEhP,KAAKoC,OAAOgN,iBAAiBzO,EAAuBkP,WAAY7P,KAAKkP,gBAIvE,YAAAD,UAAA,SAAUpQ,GACRmB,KAAKoC,OAAO0N,oBAAoBnP,EAAuBiP,SAAU5P,KAAKgP,aACtEhP,KAAKoC,OAAO0N,oBAAoBnP,EAAuBkP,WAAY7P,KAAKkP,gBAG1E,YAAAM,aAAA,SAAa3Q,GACX,IAAIkR,EAAQvO,KAAKwO,KAAK,EAAGxO,KAAKyO,IAAI,EAAIpR,EAAEqR,aAAerR,EAAEsR,SACzDnQ,KAAKiO,OAAOF,MAAMgC,GAAS/P,KAAKwO,SAAWxO,KAAKoC,OAAOwB,UAGzD,YAAAuL,YAAA,SAAYtQ,GACV,IAAIuC,EAAIvC,EAAE6Q,MAAQ1P,KAAK0O,QACrBrP,EAAIR,EAAE8Q,MAAQ3P,KAAK2O,QACnByB,EAAKhP,EAAIpB,KAAK8O,MACduB,EAAKhR,EAAIW,KAAK+O,MAGXlQ,EAAEyR,UAILtQ,KAAKiO,OAAOL,MAAMwC,GAAMpQ,KAAKsO,QAAUtO,KAAKoC,OAAOuB,QACnD3D,KAAKiO,OAAOH,KAAKuC,GAAMrQ,KAAKsO,QAAUtO,KAAKoC,OAAOwB,WAJlD5D,KAAKiO,OAAOV,UAAUhB,SAASlN,GAAK+Q,GAAMpQ,KAAKoO,WAAapO,KAAKoC,OAAOuB,OACxE3D,KAAKiO,OAAOV,UAAUhB,SAASnL,GAAKiP,GAAMrQ,KAAKoO,WAAapO,KAAKoC,OAAOwB,SAM1E5D,KAAK8O,MAAQ1N,EACbpB,KAAK+O,MAAQ1P,GAEjB,EAtFA,G,QCxFA,WAEI,WAAakR,GAETvQ,KAAKuQ,KAAOA,EACZvQ,KAAKuN,UAAY,IAAI,EA+C7B,OAxCI,YAAAiD,SAAA,SAASpP,EAAW/B,EAAWgC,GAE3B,OADArB,KAAKuN,UAAUjH,MAAMjB,IAAIjE,EAAG/B,EAAGgC,GACxBrB,MAGX,YAAAyQ,YAAA,SAAYrP,EAAW/B,EAAWgC,GAE9B,OADArB,KAAKuN,UAAUvM,SAASqE,IAAIjE,EAAG/B,EAAGgC,GAC3BrB,MAGX,YAAA0Q,YAAA,SAAYtP,EAAW/B,EAAWgC,GAE9B,OADArB,KAAKuN,UAAUhB,SAASlH,IAAIjE,EAAG/B,EAAGgC,GAC3BrB,MAGX,YAAA2Q,SAAA,SAASvP,EAAW/B,EAAWgC,GAI3B,OAHArB,KAAKuN,UAAUjH,MAAMlF,GAAKA,EAC1BpB,KAAKuN,UAAUjH,MAAMjH,GAAKA,EAC1BW,KAAKuN,UAAUjH,MAAMjH,GAAKA,EACnBW,MAGX,YAAA4Q,YAAA,SAAYxP,EAAW/B,EAAWgC,GAI9B,OAHArB,KAAKuN,UAAUvM,SAASI,GAAKA,EAC7BpB,KAAKuN,UAAUvM,SAAS3B,GAAKA,EAC7BW,KAAKuN,UAAUvM,SAASK,GAAKA,EACtBrB,MAGX,YAAA6Q,YAAA,SAAYzP,EAAW/B,EAAWgC,GAI9B,OAHArB,KAAKuN,UAAUhB,SAASnL,GAAKA,EAC7BpB,KAAKuN,UAAUhB,SAASlN,GAAKA,EAC7BW,KAAKuN,UAAUhB,SAASlL,GAAKA,EACtBrB,MAGX,YAAA8Q,UAAA,WAEI,OADA9Q,KAAKuN,UAAUZ,eACR3M,MAEf,EApDA,G,ECHA,WAEI,WAAYiC,EAA2B8O,GACnC,IAAMC,EAAU/O,EAAGgP,gBACnBhP,EAAGiP,YAAYjP,EAAGkP,WAAYH,GAC9B/O,EAAGmP,WAAWnP,EAAGkP,WAAY,EAAGlP,EAAGoP,KAAMpP,EAAGoP,KAAMpP,EAAGqP,cAAeP,GACpE9O,EAAGsP,cAActP,EAAGkP,WAAYlP,EAAGuP,mBAAoBvP,EAAGwP,sBAC1DxP,EAAGsP,cAActP,EAAGkP,WAAYlP,EAAGyP,mBAAoBzP,EAAG0P,QAC1D1P,EAAG2P,eAAe3P,EAAGkP,YAErBnR,KAAKiC,GAAKA,EAgBlB,OAVW,EAAA4P,YAAP,SAAmB5P,EAA2B6P,GAC1C,OAAO,IAAIxT,SAAQ,SAAUC,GACzB,IAAMwS,EAAQ,IAAIgB,MAClBhB,EAAMiB,OAAS,WACXzT,EAAQ,IAAI0T,EAAQhQ,EAAI8O,KAE5BA,EAAMmB,IAAMJ,MAIxB,EA1BA,G,ECEA,WAEE,WAAY7P,EAA2BkQ,EAAgBC,EAAeC,GAGpE,OAFArS,KAAKsS,OAASrQ,EAAGsQ,eAETF,GACN,KAAKzR,EAAY4R,qBACfvQ,EAAGwQ,WAAWxQ,EAAGyQ,aAAc1S,KAAKsS,QACpCrQ,EAAG0Q,WAAW1Q,EAAGyQ,aAAc,IAAI3Q,aAAaoQ,GAAOlQ,EAAG2Q,aAC1D,MAEF,KAAKhS,EAAYiS,oBACf5Q,EAAGwQ,WAAWxQ,EAAG6Q,qBAAsB9S,KAAKsS,QAC5CrQ,EAAG0Q,WAAW1Q,EAAG6Q,qBAAsB,IAAIC,YAAYZ,GAAOlQ,EAAG2Q,aACjE,MAEF,QACE3Q,EAAGwQ,WAAWxQ,EAAGyQ,aAAc1S,KAAKsS,QACpCrQ,EAAG0Q,WAAW1Q,EAAGyQ,aAAc,IAAI3Q,aAAaoQ,GAAOlQ,EAAG2Q,aAK9D5S,KAAKiC,GAAKA,EACVjC,KAAKgT,KAAOb,EAAK5R,OAAS6R,EAwC9B,OAhCE,YAAAa,QAAA,WACEjT,KAAKiC,GAAGiR,aAAalT,KAAKsS,SAI5B,YAAAa,gBAAA,SAAgBhB,EAAuBiB,EAAgBC,EAAgBL,EAA0BX,QAA1B,IAAAW,MAAehT,KAAKgT,WAAM,IAAAX,MAAczR,EAAY4R,sBACzH,IAAMvQ,EAAKjC,KAAKiC,GAChB,OAAQoQ,GACN,KAAKzR,EAAY4R,qBACfvQ,EAAGqR,wBAAwBnB,GAC3BlQ,EAAGwQ,WAAWxQ,EAAGyQ,aAAc1S,KAAKsS,QACpCrQ,EAAGsR,oBAAoBpB,EAAgBa,EAAM/Q,EAAGuR,OAAO,EAAOJ,EAAQC,GACtEpR,EAAGwQ,WAAWxQ,EAAGyQ,aAAa,MAC9B,MAEF,KAAK9R,EAAYiS,oBACf5Q,EAAGwQ,WAAWxQ,EAAG6Q,qBAAsB9S,KAAKsS,QAC5CrQ,EAAG0Q,WAAW1Q,EAAG6Q,qBAAsB,IAAIC,YAAYZ,GAAmBlQ,EAAG2Q,aAC7E3Q,EAAGwQ,WAAWxQ,EAAG6Q,qBAAqB,MACtC,MAEF,QACE7Q,EAAGqR,wBAAwBnB,GAC3BlQ,EAAGwQ,WAAWxQ,EAAGyQ,aAAc1S,KAAKsS,QACpCrQ,EAAGsR,oBAAoBpB,EAAgBa,EAAM/Q,EAAGuR,OAAO,EAAOJ,EAAQC,GACtEpR,EAAGwQ,WAAWxQ,EAAGyQ,aAAa,QAOtC,EAhEA,G,ECCA,WACE,WAAYzQ,EAA2BwR,EAAkBC,GASzD,KAAAzR,GAAmC,KACnC,KAAA0R,aAAmC,KACnC,KAAAC,eAAqC,KATnC,IAAMD,EAAe3T,KAAK6T,aAAa5R,EAAIA,EAAG6R,cAAeL,GACvDG,EAAiB5T,KAAK6T,aAAa5R,EAAIA,EAAG8R,gBAAiBL,GAC3DM,EAAgBhU,KAAKiU,oBAAoBhS,EAAI2R,EAAgBD,GACnE3T,KAAKkU,QAAUF,EACfhU,KAAKiC,GAAKA,EAuFd,OA9EE,YAAA4R,aAAA,SAAa5R,EAA2BoQ,EAAc8B,GACpD,IAAMC,EAASnS,EAAG4R,aAAaxB,GAS/B,OANApQ,EAAGoS,aAAaD,EAAQD,GAGxBlS,EAAGqS,cAAcF,GAGZnS,EAAGsS,mBAAmBH,EAAQnS,EAAGuS,gBAM/BJ,GALLK,QAAQC,MAAM,4CAA8CzS,EAAG0S,iBAAiBP,IAChFnS,EAAG2S,aAAaR,GACT,OAMX,YAAAH,oBAAA,SAAoBhS,EAA2B0R,EAA2BC,GAExE,IAAMM,EAAUjS,EAAG4S,gBAMnB,GAJA5S,EAAG6S,aAAaZ,EAASP,GACzB1R,EAAG6S,aAAaZ,EAASN,GACzB3R,EAAG8S,YAAYb,IAEVjS,EAAG+S,oBAAoBd,EAASjS,EAAGgT,aAGtC,MAFAR,QAAQC,MAAM,iCAAkCzS,EAAGiT,kBAAkBhB,IACrEjS,EAAGkT,cAAcjB,GACX,IAAIkB,MAAM,gCAYlB,OATApV,KAAK2T,aAAeA,EACpB3T,KAAK4T,eAAiBA,EAGtB3R,EAAGoT,aAAanB,EAASP,GACzB1R,EAAGoT,aAAanB,EAASN,GACzB3R,EAAG2S,aAAahB,GAChB3R,EAAG2S,aAAajB,GAETO,GAGT,YAAAoB,eAAA,WAEE,OADCtV,KAAKiC,GAA6BsT,WAAWvV,KAAKkU,SAC5ClU,MAGT,YAAAwV,iBAAA,WAEE,OADCxV,KAAKiC,GAA6BsT,WAAW,MACvCvV,MAGT,YAAAyV,QAAA,WAEOzV,KAAKiC,GAA6ByT,aAAc1V,KAAKiC,GAA6B0T,mBAAqB3V,KAAKkU,SAC/GlU,KAAKwV,mBAENxV,KAAKiC,GAA6BkT,cAAcnV,KAAKkU,UAGxD,YAAA0B,YAAA,SAAYC,GACV,IAAM5T,EAAKjC,KAAKiC,GAWlB,OATG4T,EAAMtF,KAAKuF,WAAW7T,EAAG8T,QAAQ9T,EAAGgB,WACpC4S,EAAMtF,KAAKyF,YAAY/T,EAAGc,OAAOd,EAAGgU,OAEvChU,EAAGiU,WAAWL,EAAMtF,KAAK4F,SAAU,EAAGN,EAAMtF,KAAK6F,aAG9CP,EAAMtF,KAAKuF,WAAW7T,EAAGc,OAAOd,EAAGgB,WACnC4S,EAAMtF,KAAKyF,YAAY/T,EAAG8T,QAAQ9T,EAAGgU,OAEjCjW,MAGT,EA9FA,G,ECAA,WAEI,WAAYqW,GAIZ,KAAAA,SAAsB,GAHlBrW,KAAKqW,SAAWA,EA8FxB,OAzFW,EAAAC,SAAP,SAAgBpE,GAEZ,IAAMqE,EAAW,2DACXC,EAAS,4DACTC,EAAK,0CACLC,EAAU,0HAEVC,EAAQzE,EAAI0E,MAAM,MAClBC,EAAsB,GACtBC,EAAY,GACZC,EAAoB,GACpBV,EAAsB,GA6B5B,OA3BAM,EAAMK,SAAQ,SAAUC,GAEpB,IAAIlY,EAAS,KACb,GAAuC,QAAlCA,EAASwX,EAASW,KAAKD,IAExBJ,EAAUrW,KAAKW,EAAWgW,WAAWpY,EAAO,IAAKoY,WAAWpY,EAAO,IAAKoY,WAAWpY,EAAO,WACvF,GAAqC,QAAhCA,EAASyX,EAAOU,KAAKD,IAE7BF,EAAQvW,KAAKW,EAAWgW,WAAWpY,EAAO,IAAKoY,WAAWpY,EAAO,IAAKoY,WAAWpY,EAAO,WACrF,GAAiC,QAA5BA,EAAS0X,EAAGS,KAAKD,IAEzBH,EAAItW,KT9BgC,CAAGY,ES8BnB+V,WAAWpY,EAAO,IT9BIM,ES8BC,EAAI8X,WAAWpY,EAAO,WAC9D,GAAsC,QAAjCA,EAAS2X,EAAQQ,KAAKD,IAAiB,CAI/C,IAFA,IAAMG,EAAqB,GAElB3Q,EAAI,EAAGA,EAAI,GAAIA,GAAK,EAAG,CAC5B,IAAM4Q,EAAOtY,EAAOuY,MAAM7Q,EAAGA,EAAI,GAC3BzF,EAAW6V,EAAUU,SAASF,EAAK,IAAM,GACzCnW,EAAK4V,EAAIS,SAASF,EAAK,IAAM,GAC7BpW,EAAS8V,EAAQQ,SAASF,EAAK,IAAM,GAC3CD,EAAS5W,KAAKO,EAAaC,EAAUC,EAAQC,IAEjDmV,EAAS7V,KT7CI,SAAC4W,GAAgC,OAAGA,SAAQ,GS6C3CI,CAAcJ,QAI7B,IAAIK,EAAUpB,IAGZ,EAAAqB,QAAb,SAAqB5F,G,oGACA,SAAM6F,MAAM7F,I,OACG,OAD1B8F,EAAW,SACJ,KAAAH,GAAUnB,SAAS,GAAMsB,EAASC,Q,OAC/C,MAAO,CAAP,EADa,WAAmB,oBAIpC,YAAAzB,YAAA,WACI,OAA8B,EAAvBpW,KAAKqW,SAAS9V,QAGzB,YAAAsW,UAAA,WACI,IAAM9X,EAAmB,GAQzB,OAPAiB,KAAKqW,SAASW,SAAQ,SAAUc,GAC5BA,EAAQV,SAASJ,SAAQ,SAAUe,GAC/B,IAAM7X,EAAI6X,EAAO/W,SACjBjC,EAAOyB,KAAKN,EAAEkB,EAAGlB,EAAEb,EAAGa,EAAEmB,SAIzBtC,GAGX,YAAAgY,QAAA,WACI,IAAMhY,EAAmB,GAQzB,OAPAiB,KAAKqW,SAASW,SAAQ,SAAUc,GAC5BA,EAAQV,SAASJ,SAAQ,SAAUe,GAC/B,IAAM7X,EAAI6X,EAAO9W,OACjBlC,EAAOyB,KAAKN,EAAEkB,EAAGlB,EAAEb,EAAGa,EAAEmB,SAIzBtC,GAGX,YAAA+X,IAAA,WACI,IAAM/X,EAAmB,GAQzB,OAPAiB,KAAKqW,SAASW,SAAQ,SAAUc,GAC5BA,EAAQV,SAASJ,SAAQ,SAAUe,GAC/B,IAAM7X,EAAI6X,EAAO7W,GACjBnC,EAAOyB,KAAKN,EAAEkB,EAAGlB,EAAEb,SAIpBN,GAGf,EAjGA,GCOA,iBACC,WAAYkD,EAA2BgM,EAAe+J,GACrD,IAkHMhE,EAAgB,IAAI,EAAc/R,EAlHnB,w2CA4CE,2rEAwEvB+R,EAAcsB,iBAEdtV,KAAKiY,YAAchW,EAAGiW,kBAAkBlE,EAAcE,QAAyBtT,EAAYuX,oBAC3FnY,KAAKoY,YAAcnW,EAAGiW,kBAAkBlE,EAAcE,QAAyBtT,EAAYyX,cAC3FrY,KAAKsY,UAAYrW,EAAGiW,kBAAkBlE,EAAcE,QAAyBtT,EAAY2X,kBAEzFvY,KAAKwY,mBAAqBvW,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAY8X,eACnG1Y,KAAK2Y,qBAAuB1W,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYgY,oBACrG5Y,KAAK6Y,gBAAkB5W,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYkY,gBAChG9Y,KAAK+Y,oBAAsB9W,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYoY,uBACpGhZ,KAAKiZ,iBAAmBhX,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYsY,iBACjGlZ,KAAKmZ,yBAA2BlX,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYwY,iCAEzGpZ,KAAKqZ,WAAapX,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAY0Y,aAC3FtZ,KAAKuZ,qBAAuBtX,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAY4Y,mBACrGxZ,KAAKyZ,iBAAmBxX,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAY8Y,oBACjG1Z,KAAK2Z,kBAAoB1X,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYgZ,qBAClG5Z,KAAK6Z,aAAe5X,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYkZ,sBAC7F9Z,KAAK+Z,cAAgB9X,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYoZ,iBAC9Fha,KAAKia,iBAAmBhY,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYsZ,oBACjGla,KAAKma,kBAAoBlY,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYwZ,qBAElGpG,EAAcwB,mBAEdxV,KAAKqa,4BAA8BpM,EAAOb,sBAC1CpN,KAAKsa,sBAAwBrM,EAAOZ,gBACpCrN,KAAKua,gBAAkBtM,EAAOT,WAC9BxN,KAAKwa,qBAAuBxC,EAC5BhY,KAAKgU,cAAgBA,EAkEvB,OAlCC,YAAAyG,YAAA,SAAYxY,EAA0B4T,GACrC7V,KAAKgU,cAAcsB,iBAEnB,IAAMoF,EAAmB1a,KAAK2a,oBAAoB3a,KAAKwa,qBAAsB3E,GAQ7E,OANA5T,EAAG2Y,iBAAiB5a,KAAK2Y,sBAAsB,EAAO3Y,KAAKqa,6BAC3DpY,EAAG2Y,iBAAiB5a,KAAK6Y,iBAAkB,EAAO7Y,KAAKua,iBACvDtY,EAAG4Y,WAAW7a,KAAKmZ,yBAA2BuB,EAAiBpD,MAAM,EAAG,KACxErV,EAAG2Y,iBAAiB5a,KAAKiZ,kBAAmB,EAAOjZ,KAAK8a,iBAAiBJ,IACzEzY,EAAG2Y,iBAAiB5a,KAAKwY,oBAAoB,EAAO3C,EAAMtI,UAAUV,kBAE7D7M,MAGR,YAAA8a,iBAAA,SAAiBJ,GAChB,IAAIK,EAAgBnV,EAAQC,WAC5BD,EAAQG,UAAUgV,EAAe,GAAK,GAAK,IAC3CnV,EAAQU,MAAMyU,EAAe,GAAK,GAAK,IACvCnV,EAAQyF,KAAK0P,EAAeA,EAAe/a,KAAKsa,uBAChD,IAAIU,EAAe,GAGnB,OAFApV,EAAQW,OAAOyU,EAAUN,GACzB9U,EAAQyF,KAAK0P,EAAeA,EAAeC,GACpCD,GAGR,YAAAJ,oBAAA,SAAoB3C,EAAwBnC,GAE3C,OAAOjQ,EAAQ+B,OACd,CAACqQ,EAAgBzK,UAAUvM,SAASI,EAAG4W,EAAgBzK,UAAUvM,SAAS3B,EAAG2Y,EAAgBzK,UAAUvM,SAASK,GAChH,CAACwU,EAAMtI,UAAUvM,SAASI,EAAGyU,EAAMtI,UAAUvM,SAAS3B,EAAGwW,EAAMtI,UAAUvM,SAASK,GAClF,CAAC,EAAG,EAAG,KAIV,EApNA,GAuNA,aAEE,cAmCF,OAjCe,EAAA4Z,eAAb,SAA4BhZ,EAA2B+R,EAA4BkH,EAAgBC,G,gGAC5E,O,EAAT,OAAS,GAAMC,EAAMC,WAAWpZ,EAAI+R,EAAekH,EAAQC,I,OAAvE,MAAO,CAAP,EAAQ,YAAI,EAAQ,QAAC,qBAGV,EAAAE,WAAb,SAAwBpZ,EAA2B+R,EAA4BkH,EAAgBC,G,8GAE/E,SAAMC,EAAME,UAAUrZ,EAAIiZ,EAAQC,I,OAgBhD,OAhBMtF,EAAQ,SACRO,EAAcP,EAAMuB,SAAShB,cAE7B7F,EAAiB,CACrBsG,UAAY,IAAI,EAAQ5U,EAAI4T,EAAMuB,SAASP,YAAaT,EAAaxV,EAAY4R,sBACjFuE,QAAS,IAAI,EAAQ9U,EAAI4T,EAAMuB,SAASL,UAAWX,EAAaxV,EAAY4R,sBAC5EsE,IAAK,IAAI,EAAQ7U,EAAI4T,EAAMuB,SAASN,MAAOV,EAAaxV,EAAY4R,sBACpExB,QAAS6E,EAAM7E,QACfmF,SAAWlU,EAAGsZ,UACdnF,YAAW,GAGC,QAAd,EAAA7F,EAAKsG,iBAAS,SAAE1D,gBAAgBa,EAAciE,YAAuBrX,EAAY4a,eAAgB5a,EAAY6a,gBACjG,QAAZ,EAAAlL,EAAKwG,eAAO,SAAE5D,gBAAgBa,EAAcsE,UAAqB1X,EAAY4a,eAAgB5a,EAAY6a,gBACjG,QAAR,EAAAlL,EAAKuG,WAAG,SAAE3D,gBAAgBa,EAAcoE,YAAuBxX,EAAY4a,eAAgB5a,EAAY6a,gBAEhG,CAAP,EAAOlL,WAGI,EAAA+K,UAAb,SAAuBrZ,EAA2BiZ,EAAgBC,G,wGAC5C,SAAM,UAAkBD,I,OACzB,OADbQ,EAAc,SACD,GAAM,cAAoBzZ,EAAIkZ,I,OACrB,OADtBQ,EAAa,SACS,GAAMrd,QAAQsd,IAAI,CAACF,EAAaC,K,OAE5D,OAFM,EAAsB,SAArBvE,EAAQ,KAAEpG,EAAO,KAEjB,CAAP,EAAO,CAACoG,SAAQ,EAAEpG,QAAO,YAG7B,EArCA,G,QC/NI,SAAY/O,EAA2BkC,GA4DvC,KAAAJ,aAAoC,KACpC,KAAAG,iBAA4C,KA5DxClE,KAAK+D,aAAe9B,EAAGgP,gBACvBhP,EAAGiP,YAAYjP,EAAGkP,WAAYnR,KAAK+D,cACnC9B,EAAGmP,WACCnP,EAAGkP,WACH,EACAlP,EAAG4Z,kBACH1X,EACAA,EACA,EACAlC,EAAG6Z,gBACH7Z,EAAG8Z,aACH,MAEJ9Z,EAAGsP,cAActP,EAAGkP,WAAYlP,EAAGyP,mBAAoBzP,EAAG+Z,SAC1D/Z,EAAGsP,cAActP,EAAGkP,WAAYlP,EAAGuP,mBAAoBvP,EAAG+Z,SAC1D/Z,EAAGsP,cAActP,EAAGkP,WAAYlP,EAAGga,eAAgBha,EAAGia,eACtDja,EAAGsP,cAActP,EAAGkP,WAAYlP,EAAGka,eAAgBla,EAAGia,eAEtDlc,KAAKkE,iBAAmBjC,EAAGma,oBAC3Bna,EAAG+B,gBAAgB/B,EAAGgC,YAAajE,KAAKkE,kBACxCjC,EAAGoa,qBACCpa,EAAGgC,YACHhC,EAAGqa,iBACHra,EAAGkP,WACHnR,KAAK+D,aACL,GAIJ,IAAMwY,EAAgBta,EAAGgP,gBACzBhP,EAAGiP,YAAYjP,EAAGkP,WAAYoL,GAC9Bta,EAAGmP,WACCnP,EAAGkP,WACH,EACAlP,EAAGoP,KACHlN,EACAA,EACA,EACAlC,EAAGoP,KACHpP,EAAGqP,cACH,MAEJrP,EAAGsP,cAActP,EAAGkP,WAAYlP,EAAGyP,mBAAoBzP,EAAG+Z,SAC1D/Z,EAAGsP,cAActP,EAAGkP,WAAYlP,EAAGuP,mBAAoBvP,EAAG+Z,SAC1D/Z,EAAGsP,cAActP,EAAGkP,WAAYlP,EAAGga,eAAgBha,EAAGia,eACtDja,EAAGsP,cAActP,EAAGkP,WAAYlP,EAAGka,eAAgBla,EAAGia,eAGtDja,EAAGoa,qBACCpa,EAAGgC,YACHhC,EAAGua,kBACHva,EAAGkP,WACHoL,EACA,GAEJvc,KAAKmE,iBAAmBA,EACxBnE,KAAKiC,GAAKA,GCjDlB,iBACC,WAAYA,EAA2BgM,GACtC,IA+BM+F,EAAgB,IAAI,EAAc/R,EA/BnB,4jBAoBE,iLAavB+R,EAAcsB,iBAEdtV,KAAKiY,YAAchW,EAAGiW,kBAAkBlE,EAAcE,QAA0BtT,EAAYuX,oBAE5FnY,KAAKwY,mBAAqBvW,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAY8X,eACnG1Y,KAAKyc,eAAiBxa,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAY8b,eACzF1c,KAAK6Y,gBAAkB5W,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYkY,gBACtG9Y,KAAK2c,UAAY1a,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYgc,WAE1F5c,KAAKsa,sBAAwBrM,EAAOZ,gBACpCrN,KAAKua,gBAAkBtM,EAAOT,WAC9BxN,KAAKgU,cAAgBA,EAErBA,EAAcwB,mBAuBhB,OATC,YAAAiF,YAAA,SAAYxY,EAA0B4T,GAOrC,OANA7V,KAAKgU,cAAcsB,iBACbrT,EAAG2Y,iBAAiB5a,KAAKyc,gBAAiB,EAAOzc,KAAKsa,uBAC5DrY,EAAG2Y,iBAAiB5a,KAAK6Y,iBAAkB,EAAO7Y,KAAKua,iBACvDtY,EAAG2Y,iBAAiB5a,KAAKwY,oBAAoB,EAAO3C,EAAMtI,UAAUV,kBACpE5K,EAAG4a,WAAW7c,KAAK2c,UAAW,IAAI5a,aAAa,CAAC,EAAK,EAAK,EAAK,KAExD/B,MAET,EAvEA,GA0EA,aAEC,cA+BD,OA7Bc,EAAAib,eAAb,SAA4BhZ,EAA2B+R,EAAwCkH,G,gGAC1E,O,EAAT,OAAS,GAAM4B,EAAkBzB,WAAWpZ,EAAI+R,EAAekH,I,OAA1E,MAAO,CAAP,EAAO,YAAI,EAAQ,QAAC,qBAGR,EAAAG,WAAb,SAAwBpZ,EAA2B+R,EAAwCkH,G,0GAE5E,SAAM4B,EAAkBxB,UAAUrZ,EAAIiZ,I,OAYpD,OAZMrF,EAAQ,SACRO,EAAcP,EAAMuB,SAAShB,cAE7B7F,EAAiB,CACtBsG,UAAW,IAAI,EAAQ5U,EAAI4T,EAAMuB,SAASP,YAAaT,EAAaxV,EAAY4R,sBAChFuK,MAAOlH,EAAM7E,QACbmF,SAAUlU,EAAGsZ,UACbnF,YAAW,GAGE,QAAd,EAAA7F,EAAKsG,iBAAS,SAAE1D,gBAAgBa,EAAciE,YAAuBrX,EAAY4a,eAAgB5a,EAAY6a,gBAEtG,CAAP,EAAOlL,WAGK,EAAA+K,UAAb,SAAuBrZ,EAA2BiZ,G,wGAC7B,SAAM,UAAkBA,I,OAEhB,OAFtBQ,EAAc,SACdC,EAAa,IAAI,EAAa1Z,EAAIxB,EAAqBuc,oBACjC,GAAM1e,QAAQsd,IAAI,CAACF,EAAaC,K,OAE5D,OAFM,EAAsB,SAArBvE,EAAQ,KAAEpG,EAAO,KAEjB,CAAP,EAAO,CAACoG,SAAQ,EAAEpG,QAAO,YAG3B,EAjCA,G,QC/EA,WACI,WAAYiM,GACRjd,KAAKkd,cAAgBD,EACrBjd,KAAKmd,eAAiB,EACtBnd,KAAKod,WAAa1b,EAAe,CAACE,IAAI,IAAKC,MAAM,IAAKC,KAAK,MAC3D9B,KAAKqd,kBAAoB3b,EAAe,CAACE,IAAI,KAAMC,MAAM,KAAMC,KAAK,OACpE9B,KAAKsd,cAAgB5b,EAAe,CAACE,IAAI,IAAKC,MAAM,IAAKC,KAAK,MAC9D9B,KAAKud,UAAY,IACjBvd,KAAKmd,eAAiB,EAoB9B,OAVI,YAAA1C,YAAA,SAAYxY,EAA0BiS,EAAqBjG,GACvDhM,EAAG4Y,WAAW3G,EAAQuF,iBAAkB,CAACzZ,KAAKkd,cAAc9b,EAAGpB,KAAKkd,cAAc7d,EAAGW,KAAKkd,cAAc7b,IACxGY,EAAG4a,WAAW3I,EAAQ6F,cAAe/Z,KAAKod,YAC1Cnb,EAAG4a,WAAW3I,EAAQqF,qBAAsBvZ,KAAKqd,mBACjDpb,EAAG4a,WAAW3I,EAAQ+F,iBAAkBja,KAAKsd,eAC7Crb,EAAG4Y,WAAW3G,EAAQyF,kBAAmB1L,EAAOV,UAAUvM,SAASwE,iBACnEvD,EAAGub,UAAUtJ,EAAQ2F,aAAc7Z,KAAKud,WACxCtb,EAAGub,UAAUtJ,EAAQiG,kBAAmBna,KAAKmd,iBAGrD,EA5BA,GCEA,iBACC,WAAYlb,EAA2BgM,EAAe+J,GACrD,IAyFMhE,EAAgB,IAAI,EAAc/R,EAzFnB,yiCAkCE,u0DAyDvB+R,EAAcsB,iBAEdtV,KAAKiY,YAAchW,EAAGiW,kBAAkBlE,EAAcE,QAAyBtT,EAAYuX,oBAE3FnY,KAAKwY,mBAAqBvW,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAY8X,eACnG1Y,KAAK2Y,qBAAuB1W,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYgY,oBACrG5Y,KAAK6Y,gBAAkB5W,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYkY,gBAChG9Y,KAAK2c,UAAY1a,EAAGwW,mBAAmBzE,EAAcE,QAAyBtT,EAAYgc,WAE1F5I,EAAcwB,mBAEdxV,KAAKqa,4BAA8BpM,EAAOb,sBAC1CpN,KAAKsa,sBAAwBrM,EAAOZ,gBACpCrN,KAAKua,gBAAkBtM,EAAOT,WAC9BxN,KAAKwa,qBAAuBxC,EAC5BhY,KAAKgU,cAAgBA,EA6BvB,OATC,YAAAyG,YAAA,SAAYxY,EAA0B4T,GAOrC,OANA7V,KAAKgU,cAAcsB,iBAEnBrT,EAAG2Y,iBAAiB5a,KAAK2Y,sBAAsB,EAAO3Y,KAAKqa,6BAC3DpY,EAAG2Y,iBAAiB5a,KAAK6Y,iBAAkB,EAAO7Y,KAAKua,iBACvDtY,EAAG2Y,iBAAiB5a,KAAKwY,oBAAoB,EAAO3C,EAAMtI,UAAUV,kBAE7D7M,MAET,EAzIA,GA4IA,aAEG,cA6BH,OA3BiB,EAAAib,eAAb,SAA4BhZ,EAA2B+R,G,gGAChC,O,EAAV,OAAU,GAAMyJ,EAAapC,WAAWpZ,EAAI+R,I,OAAxD,MAAO,CAAP,EAAQ,YAAI,EAAQ,QAAE,qBAGX,EAAAqH,WAAb,SAAwBpZ,EAA2B+R,G,qFAqBpD,OAVMoC,GATAsH,EAAQ,CACb,GAAG,EAAE,EACL,EAAE,EAAE,GACH,GAAG,EAAE,GACL,EAAE,EAAE,GACJ,GAAG,EAAE,EACN,EAAE,EAAE,IAGqBnd,OAAO,EAC3Bod,EAA6C,EAAjC5b,aAAa6b,kBACzBrN,EAAiB,CACtBsG,UAAY,IAAI,EAAQ5U,EAAIyb,EAAOtH,EAAaxV,EAAY4R,sBAC5D2D,SAAWlU,EAAGsZ,UACdnF,YAAW,GAGE,QAAd,EAAA7F,EAAKsG,iBAAS,SAAE1D,gBAAgBa,EAAciE,YAAuB0F,EAAW/c,EAAY6a,eAAgB7a,EAAYid,kBAEjH,CAAP,EAAOtN,UAET,EA/BA,GCxIC,mC,gFAW6B,OAVpBuN,EAAY,IAAI,EAAUrd,EAAqBuB,kBAC3CoC,UAAU,IAAM,IAAMM,cAAc,GAAI,GAAI,GAAI,GAAKG,QACzD5C,EAAK6b,EAAUvb,aAEf2a,EAAgB,IAAIxX,EAAQ,IAAK,IAAK,GACtCqY,EAAQ,IAAI,EAAMb,IAClBc,EAAY,IAAItQ,EAAOzL,IACnBsL,UAAUvM,SAASqE,IAAI6X,EAAc9b,EAAG8b,EAAc7d,EAAG6d,EAAc7b,GAE3E4c,EAA0B,IAAIC,EAAwBjc,EAA6B+b,GAC/D,GAAMlB,EAAkB7B,eAAehZ,EAAIgc,EAAyBxd,EAAqB0d,kB,OAO9F,OAPfC,EAAoB,UAEpBnQ,EAAS,IAAIP,EAAOzL,IACnBsL,UAAUvM,SAASqE,IAAI,EAAG,GAAK,KACtC,IAAIgZ,EAAiBpc,EAA6BgM,GAE5CqQ,EAAqB,IAAIC,EAAmBtc,EAA6BgM,EAAQ+P,GAClE,GAAMP,EAAaxC,eAAehZ,EAAIqc,I,OAG7C,OAHRE,EAAe,SAEfC,EAAc,IAAIC,EAAYzc,EAA6BgM,EAAQ+P,GAC3D,GAAM5C,EAAMH,eAAehZ,EAAIwc,EAAahe,EAAqB0d,gBAAiB1d,EAAqBke,sB,cAA/G9I,EAAQ,UACRrF,SAAS,MAAO,MAAO,OAAQE,YAAY,EAAE,GAAG,IAEhDkO,EAAO,WAETd,EAAUha,YAAYsa,EAAkB7N,KAAKwM,OAE7CiB,EAAUnQ,mBACVoQ,EAAwBxD,YAAYxY,EAAImc,EAAkBtN,aAAakD,cAClE4B,YAAYwI,EAAkBtN,aAEnCgN,EAAUlZ,mBAAmBR,UAAU,IAAM,IAAMS,QAEnDoJ,EAAOJ,mBAEPyQ,EAAmB7D,YAAYxY,EAAIuc,EAAa1N,aAAakD,cACxD4B,YAAY4I,EAAa1N,aAE9B2N,EAAYhE,YAAYxY,EAAI4T,EAAM/E,aAC7BkD,cAAc4B,YAAYC,EAAM/E,aAErCiN,EAAMtD,YAAYxY,EAAIwc,EAAaxQ,GAEnC4Q,sBAAsBD,O","file":"bundle.js","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","export const TEXTURE = 'TEXTURE'\r\n\r\nexport enum ProgramEntrySettings {\r\n    WEBGL_CANVAS_ID = 'qrius-glCanvas',\r\n    WEBGL_CONTEXT = 'webgl2',\r\n    WEBGL_CONTEXT_EXPERIMENTAL = 'experimental-webgl',\r\n    WEBGL_CONTEXT_WEBKIT = 'webkit-3d',\r\n    WEBGL_CONTEXT_MOZ = 'moz-webgl',\r\n    WEBGL_DEPTH_TEXTURE = 'WEBGL_depth_texture',\r\n    WEBGL_CONTEXT_ERROR_MESSAGE = 'Could not initialise WebGL',\r\n    WEBGL_DEPTH_TEXTUR_ERROR_MESSAGE = 'need WEBGL_depth_texture',\r\n    PATH_ASSETS_OBJ = '/webgl-3d-renderer/assets/resources/yoshi/source/yoshi.obj',\r\n    PATH_ASSETS_TEXTURE = '/webgl-3d-renderer/assets/resources/yoshi/textures/yoshi.png',\r\n    DEPTH_TEXTURE_SIZE = 512,\r\n}\r\n\r\nexport enum CameraSettings {\r\n    NEAR_PLANE = 0.1,\r\n    FAR_PLANE = 100.0,\r\n    FIELD_OF_VIEW = 45,\r\n    MODE_FREE = 0,\r\n    MODE_ORBIT = 1,\r\n}\r\n\r\nexport enum CameraControlsSettings {\r\n    KEY_DOWN_EVENT = 'keydown',\r\n    KEY_UP_EVENT = 'keyup',\r\n    KEY_DOWN = 40,\r\n    KEY_UP = 38,\r\n    KEY_LEFT = 37,\r\n    KEY_RIGHT = 39,\r\n    MOUSE_UP = 'mouseup',\r\n    MOUSE_DOWN = 'mousedown',\r\n    MOUSE_WHEEL = 'mousewheel',\r\n    MOUSE_MOVE = 'mousemove',\r\n    ROTATION_RATE = -300,\r\n    PAN_RATE = 5,\r\n    ZOOM_RATE = 200,\r\n\r\n}\r\n\r\nexport enum GLSetttings {\r\n    DEFAULT_OFFSET = 0,\r\n    DEFAULT_STRIDE = 0,\r\n    ATTR_POSITION_NAME = \"a_position\",\r\n    ATTR_NORMAL_NAME = \"a_norm\",\r\n    ATTR_UV_NAME = \"a_texCoord\",\r\n    UNI_COLOR = 'u_color',\r\n    ATTR_UV_LOC = 2,\r\n    GRID_VECTOR_SIZE = 3,\r\n    GRID_COLOR_SIZE = 1,\r\n    GRID_VERTEX_LEN = 4,\r\n    UNI_MODEL_MAT ='u_mVMatrix',\r\n    UNI_PERSPECTIV_MAT = 'u_pMatrix',\r\n    UNI_ORTHO_MAT = 'u_oMatrix',\r\n    UNI_CAMERA_MAT = 'u_cameraViewMatrix',\r\n    UNI_LIGHT_VIEW_CAMERA_MAT = 'u_lightViewCameraMatrix',\r\n    UNI_REVERSE_LIGHT_DIRECTION_MAT = 'u_reverseLightDirection',\r\n    UNI_TEXTURE_MAT = 'u_textureMatrix',\r\n    UNI_DIFFUSE = 'u_diffuse',\r\n    UNI_PROJECTED_TEXTURE = 'u_projectedTexture',\r\n    UNI_LIGHT_AMBIENT = 'u_ambientLightColor',\r\n    UNI_LIGHT_DIRECTION = 'u_lightDirection',\r\n    UNI_LIGHT_POSITION = 'u_lightPosition',\r\n    UNI_CAMERA_POSITION = 'u_cameraPosition',\r\n    UNI_CAMERA_SHININESS = 'u_shininess',\r\n    UNI_LIGHT_COLOR = 'u_lightColor',\r\n    UNI_SPECULAR_COLOR = 'u_specularColor',\r\n    UNI_SPECULAR_FACTOR = 'u_specularFactor',\r\n    BUFFER_TYPE_INDICES = 'indices',\r\n    BUFFER_TYPE_VERTICES = 'vertices',\r\n\r\n}\r\n\r\nexport enum ShaderProgramMatrixFields {\r\n    CAMERA_MATRIX = 'cameraMatrix',\r\n    MODEL_MATRIX = 'modelViewMatrix',\r\n    PERSPECTIVE_MATRIX = 'perspectiveMatrix',\r\n    ORTHO_MATRIX = 'orthoMatrix'\r\n}\r\n\r\nexport enum ObjTypes {\r\n    V = 'v',\r\n    VN = 'vn',\r\n    VT = 'vt',\r\n    F = 'f',\r\n}\r\n\r\nexport const NEW_LINE = '\\n'\r\nexport const END_OF_LINE = '\\r'\r\nexport const BACKSLASH = '/'\r\nexport const SPACE = /\\s+/\r\n","import { Normal, UV, Vector, Vertex } from \"@/entities\";\r\n\r\nexport const SurfaceStruct = (vertices: Array < Vertex > ) => ({ vertices })\r\nexport const VertexStruct = (position: Vector, normal: Normal, uv: UV) => ({ position, normal, uv })\r\nexport const Vec3Struct = (x: number, y: number, z: number) => ({ x, y, z })\r\nexport const Vec2Struct = (x: number, y: number) => ({ x, y })\r\nexport const radToDeg = (r: number) => r * 180 / Math.PI\r\nexport const degToRad = (d: number) => d * Math.PI / 180\r\nexport const loadShaders = async (vsSource: string, fsSource: string) => {\r\n\r\n    const loadFile = async (src: string) => {\r\n        const response = await fetch(src)\r\n        const data = await response.text()\r\n        return data\r\n    }\r\n\r\n    const [vertexShaderFile, fragmentShaderFile] = await Promise.all([loadFile(vsSource), loadFile(fsSource)])\r\n\r\n    return {\r\n        vertexShaderFile,\r\n        fragmentShaderFile\r\n    };\r\n}\r\n\r\nexport const mapValues = (x: number, xMin: number, xMax: number, zMin: number, zMax: number) => ( ((x-xMin)/(xMax-xMin)) * ((zMax-zMin)+zMin) )\r\n\r\nexport const normalizeColor = (rgb:{red: number, green: number, blue: number})=>{\r\n    const alpha = 1\r\n    const rgb_32_bit = 255\r\n\r\n    const result=[(rgb.red/rgb_32_bit), (rgb.green/rgb_32_bit), (rgb.blue/rgb_32_bit), alpha]\r\n    return new Float32Array(result)\r\n\r\n}\r\n","import { ProgramEntrySettings } from \"@/modules\";\r\nimport DepthTexture from \"./Textures/depthTexture\";\r\n\r\n\r\nexport default class GLContext {\r\n    constructor(WEBGL_CANVAS_ID: string) {\r\n        const canvas = document.getElementById(WEBGL_CANVAS_ID) as HTMLCanvasElement;\r\n        this.gl = canvas.getContext(ProgramEntrySettings.WEBGL_CONTEXT) as WebGLRenderingContext\r\n        this.gl ?? alert(ProgramEntrySettings.WEBGL_CONTEXT_ERROR_MESSAGE); //user if webgl is not available\r\n        this.gl?.cullFace(this.gl.BACK);\t\t\t\t\t\t\t\t    //Back is also default\r\n        this.gl?.frontFace(this.gl.CCW);\t\t\t\t\t\t\t\t    //Dont really need to set it, its ccw by default.\r\n        this.gl?.enable(this.gl.DEPTH_TEST);\t\t\t\t\t\t\t    //Shouldn't use this, use something else to add depth detection\r\n        this.gl?.enable(this.gl.CULL_FACE);\t\t\t\t\t\t\t        //Cull back face, so only show triangles that are created clockwise\r\n        this.gl?.depthFunc(this.gl.LEQUAL);\t\t\t\t\t\t\t        //Near things obscure far things\r\n        this.gl?.blendFunc(this.gl.SRC_ALPHA, this.gl.ONE_MINUS_SRC_ALPHA);\t//Setup default alpha blending\r\n        this.canvas = canvas;\r\n    }\r\n\r\n    gl: WebGLRenderingContext | null = null;\r\n    rgb_32_bit = 255;\r\n    alpha = 1;\r\n    canvas: HTMLCanvasElement;\r\n\r\n    setSize(w: number, h: number) {\r\n        //set the size of the canvas, on chrome we need to set it 3 ways to make it work perfectly.\r\n        this.canvas.style.width = w + \"px\";\r\n        this.canvas.style.height = h + \"px\";\r\n        this.canvas.width = w;\r\n        this.canvas.height = h;\r\n\r\n        //when updating the canvas size, must reset the viewport of the canvas \r\n        //else the resolution webgl renders at will not change\r\n        this.gl?.viewport(0, 0, w, h);\r\n        \r\n        return this;\r\n    }\r\n\r\n    depthRender(depthTexture:DepthTexture){\r\n        this.gl?.bindFramebuffer(this.gl?.FRAMEBUFFER, depthTexture.depthFramebuffer);\r\n        this.gl?.viewport(0, 0, depthTexture.depthTextureSize, depthTexture.depthTextureSize);\r\n        return this\r\n    }\r\n\r\n    //Set the size of the canvas to fill a % of the total screen.\r\n    fitScreen(wp: number, hp: number) {\r\n        return this.setSize(window.innerWidth * (wp || 1), window.innerHeight * (hp || 1));\r\n    }\r\n\r\n    setClearColor(red: number, green: number, blue: number, alpha: number = 1) {\r\n        this.gl?.clearColor(red / this.rgb_32_bit, green / this.rgb_32_bit, blue / this.rgb_32_bit, alpha);\r\n        return this\r\n    }\r\n\r\n    clearFramebuffer(){\r\n        this.gl?.bindFramebuffer(this.gl?.FRAMEBUFFER, null);\r\n        return this;\r\n    }\r\n\r\n    clear() {\r\n        this.gl?.clear(this.gl?.COLOR_BUFFER_BIT | this.gl?.DEPTH_BUFFER_BIT);\r\n        return this;\r\n    }\r\n\r\n    getContext() {\r\n        return this.gl;\r\n    }\r\n}","//###########################################################################################\r\nimport { Vector } from \"@/entities\";\r\n\r\n\r\n//https://github.com/sketchpunk/FunWithWebGL2/tree/master/lesson_006\r\nclass Vector3 {\r\n    constructor(x: number, y: number, z: number) {\r\n        this.x = x || 0.0;\r\n        this.y = y || 0.0;\r\n        this.z = z || 0.0;\r\n    }\r\n\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n\r\n    magnitude(v: Vector = {\r\n        x: 0.0,\r\n        y: 0.0,\r\n        z: 0.0\r\n    }) {\r\n        //Only get the magnitude of this vector\r\n        if (v === undefined) return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\r\n\r\n        //Get magnitude based on another vector\r\n        let x = v.x - this.x,\r\n            y = v.y - this.y,\r\n            z = v.y - this.z;\r\n\r\n        return Math.sqrt(x * x + y * y + z * z);\r\n    }\r\n\r\n    normalize() {\r\n        let mag = this.magnitude();\r\n        this.x /= mag;\r\n        this.y /= mag;\r\n        this.z /= mag;\r\n        return this;\r\n    }\r\n\r\n    set(x: number, y: number, z: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        return this;\r\n    }\r\n\r\n    multiScalar(v: number) {\r\n        this.x *= v;\r\n        this.y *= v;\r\n        this.z *= v;\r\n        return this;\r\n    }\r\n\r\n    getArray() {\r\n        return [this.x, this.y, this.z];\r\n    }\r\n\r\n    getFloatArray() {\r\n        return new Float32Array([this.x, this.y, this.z]);\r\n    }\r\n\r\n    clone() {\r\n        return new Vector3(this.x, this.y, this.z);\r\n    }\r\n}\r\n\r\n\r\n//###########################################################################################\r\nclass Matrix4 {\r\n    constructor() {\r\n        this.matrix = Matrix4.identity();\r\n    }\r\n\r\n    matrix: Float32Array;\r\n\r\n    //....................................................................\r\n    //Transformations Methods\r\n    vtranslate(v: Vector) {\r\n        Matrix4.translate(this.matrix, v.x, v.y, v.z);\r\n        return this;\r\n    }\r\n    translate(x: number, y: number, z: number) {\r\n        Matrix4.translate(this.matrix, x, y, z);\r\n        return this;\r\n    }\r\n\r\n    rotateY(rad: number) {\r\n        Matrix4.rotateY(this.matrix, rad);\r\n        return this;\r\n    }\r\n    rotateX(rad: number) {\r\n        Matrix4.rotateX(this.matrix, rad);\r\n        return this;\r\n    }\r\n    rotateZ(rad: number) {\r\n        Matrix4.rotateZ(this.matrix, rad);\r\n        return this;\r\n    }\r\n\r\n    vscale(vec3: Vector) {\r\n        Matrix4.scale(this.matrix, vec3.x, vec3.y, vec3.z);\r\n        return this;\r\n    }\r\n    scale(x: number, y: number, z: number) {\r\n        Matrix4.scale(this.matrix, x, y, z);\r\n        return this;\r\n    }\r\n\r\n    invert() {\r\n        Matrix4.invert(this.matrix);\r\n        return this;\r\n    }\r\n\r\n    //....................................................................\r\n    //Methods\r\n    //Bring is back to identity without changing the transform values.\r\n    resetRotation() {\r\n        for (let i = 0; i < this.matrix.length; i++) {\r\n            if (i >= 12 && i <= 14) continue;\r\n            this.matrix[i] = (i % 5 == 0) ? 1 : 0; //only positions 0,5,10,15 need to be 1 else 0.\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    //reset data back to identity.\r\n    resetMat() {\r\n        for (let i = 0; i < this.matrix.length; i++) this.matrix[i] = (i % 5 == 0) ? 1 : 0; //only positions 0,5,10,15 need to be 1 else 0.\r\n        return this;\r\n    }\r\n\r\n    //....................................................................\r\n    //Static Data Methods\r\n    static identity() {\r\n        let a = new Float32Array(16);\r\n        a[0] = a[5] = a[10] = a[15] = 1;\r\n        return a;\r\n    }\r\n\r\n    //from glMatrix\r\n    static perspective(out: Float32Array, fovy: number, aspect: number, near: number, far: number) {\r\n        let f = 1.0 / Math.tan(fovy / 2),\r\n            nf = 1 / (near - far);\r\n        out[0] = f / aspect;\r\n        out[1] = 0;\r\n        out[2] = 0;\r\n        out[3] = 0;\r\n        out[4] = 0;\r\n        out[5] = f;\r\n        out[6] = 0;\r\n        out[7] = 0;\r\n        out[8] = 0;\r\n        out[9] = 0;\r\n        out[10] = (far + near) * nf;\r\n        out[11] = -1;\r\n        out[12] = 0;\r\n        out[13] = 0;\r\n        out[14] = (2 * far * near) * nf;\r\n        out[15] = 0;\r\n    }\r\n\r\n\r\n    static ortho(out: Float32Array, left: number, right: number, bottom: number, top: number, near: number, far: number) {\r\n        let lr = 1 / (left - right),\r\n            bt = 1 / (bottom - top),\r\n            nf = 1 / (near - far);\r\n        out[0] = -2 * lr;\r\n        out[1] = 0;\r\n        out[2] = 0;\r\n        out[3] = 0;\r\n        out[4] = 0;\r\n        out[5] = -2 * bt;\r\n        out[6] = 0;\r\n        out[7] = 0;\r\n        out[8] = 0;\r\n        out[9] = 0;\r\n        out[10] = 2 * nf;\r\n        out[11] = 0;\r\n        out[12] = (left + right) * lr;\r\n        out[13] = (top + bottom) * bt;\r\n        out[14] = (far + near) * nf;\r\n        out[15] = 1;\r\n    };\r\n\r\n\r\n     /**\r\n   * Creates a lookAt matrix.\r\n   * This is a world matrix for a camera. In other words it will transform\r\n   * from the origin to a place and orientation in the world. For a view\r\n   * matrix take the inverse of this.\r\n   * @param {Float32Array} cameraPosition position of the camera\r\n   * @param {Vector3} target position of the target\r\n   * @param {Vector3} up direction\r\n   * @param {Float32Array} [dst] optional matrix to store result\r\n   * @return {Float32Array} dst or a new matrix if none provided\r\n   * @memberOf module:webgl-3d-math\r\n   */\r\n    static lookAt(cameraPosition: any, target:any, up:any, dst:any=null) {\r\n        dst = dst || new Float32Array(16);\r\n        var zAxis = Matrix4.normalize(Matrix4.subtractVectors(cameraPosition, target));\r\n        var xAxis = Matrix4.normalize(Matrix4.cross(up, zAxis));\r\n        var yAxis = Matrix4.normalize(Matrix4.cross(zAxis, xAxis));\r\n\r\n        dst[ 0] = xAxis[0];\r\n        dst[ 1] = xAxis[1];\r\n        dst[ 2] = xAxis[2];\r\n        dst[ 3] = 0;\r\n        dst[ 4] = yAxis[0];\r\n        dst[ 5] = yAxis[1];\r\n        dst[ 6] = yAxis[2];\r\n        dst[ 7] = 0;\r\n        dst[ 8] = zAxis[0];\r\n        dst[ 9] = zAxis[1];\r\n        dst[10] = zAxis[2];\r\n        dst[11] = 0;\r\n        dst[12] = cameraPosition[0];\r\n        dst[13] = cameraPosition[1];\r\n        dst[14] = cameraPosition[2];\r\n        dst[15] = 1;\r\n\r\n        return dst;\r\n    }\r\n\r\n    static subtractVectors(a:any, b:any, dst:any=null) {\r\n        dst = dst || new Float32Array(3);\r\n        dst[0] = a[0] - b[0];\r\n        dst[1] = a[1] - b[1];\r\n        dst[2] = a[2] - b[2];\r\n        return dst;\r\n    }\r\n\r\n    static cross(a:any, b:any, dst:any=null) {\r\n        dst = dst || new Float32Array(3);\r\n        dst[0] = a[1] * b[2] - a[2] * b[1];\r\n        dst[1] = a[2] * b[0] - a[0] * b[2];\r\n        dst[2] = a[0] * b[1] - a[1] * b[0];\r\n        return dst;\r\n    }\r\n\r\n    static normalize(v:any, dst:any=null) {\r\n        dst = dst || new Float32Array(3);\r\n        var length = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\r\n        // make sure we don't divide by 0.\r\n        if (length > 0.00001) {\r\n            dst[0] = v[0] / length;\r\n            dst[1] = v[1] / length;\r\n            dst[2] = v[2] / length;\r\n        }\r\n        return dst;\r\n    }\r\n\r\n\r\n    //https://github.com/toji/gl-matrix/blob/master/src/gl-matrix/mat4.js\r\n    //make the rows into the columns\r\n    static transpose(out: Float32Array, a: Float32Array) {\r\n        //If we are transposing ourselves we can skip a few steps but have to cache some values\r\n        if (out === a) {\r\n            let a01 = a[1],\r\n                a02 = a[2],\r\n                a03 = a[3],\r\n                a12 = a[6],\r\n                a13 = a[7],\r\n                a23 = a[11];\r\n            out[1] = a[4];\r\n            out[2] = a[8];\r\n            out[3] = a[12];\r\n            out[4] = a01;\r\n            out[6] = a[9];\r\n            out[7] = a[13];\r\n            out[8] = a02;\r\n            out[9] = a12;\r\n            out[11] = a[14];\r\n            out[12] = a03;\r\n            out[13] = a13;\r\n            out[14] = a23;\r\n        } else {\r\n            out[0] = a[0];\r\n            out[1] = a[4];\r\n            out[2] = a[8];\r\n            out[3] = a[12];\r\n            out[4] = a[1];\r\n            out[5] = a[5];\r\n            out[6] = a[9];\r\n            out[7] = a[13];\r\n            out[8] = a[2];\r\n            out[9] = a[6];\r\n            out[10] = a[10];\r\n            out[11] = a[14];\r\n            out[12] = a[3];\r\n            out[13] = a[7];\r\n            out[14] = a[11];\r\n            out[15] = a[15];\r\n        }\r\n\r\n        return out;\r\n    }\r\n\r\n    //Calculates a 3x3 normal matrix (transpose inverse) from the 4x4 matrix\r\n    static normalMat3(out: Float32Array, a: Float32Array) {\r\n        let a00 = a[0],\r\n            a01 = a[1],\r\n            a02 = a[2],\r\n            a03 = a[3],\r\n            a10 = a[4],\r\n            a11 = a[5],\r\n            a12 = a[6],\r\n            a13 = a[7],\r\n            a20 = a[8],\r\n            a21 = a[9],\r\n            a22 = a[10],\r\n            a23 = a[11],\r\n            a30 = a[12],\r\n            a31 = a[13],\r\n            a32 = a[14],\r\n            a33 = a[15],\r\n\r\n            b00 = a00 * a11 - a01 * a10,\r\n            b01 = a00 * a12 - a02 * a10,\r\n            b02 = a00 * a13 - a03 * a10,\r\n            b03 = a01 * a12 - a02 * a11,\r\n            b04 = a01 * a13 - a03 * a11,\r\n            b05 = a02 * a13 - a03 * a12,\r\n            b06 = a20 * a31 - a21 * a30,\r\n            b07 = a20 * a32 - a22 * a30,\r\n            b08 = a20 * a33 - a23 * a30,\r\n            b09 = a21 * a32 - a22 * a31,\r\n            b10 = a21 * a33 - a23 * a31,\r\n            b11 = a22 * a33 - a23 * a32,\r\n\r\n            // Calculate the determinant\r\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n        if (!det) return null;\r\n\r\n        det = 1.0 / det;\r\n\r\n        out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\r\n        out[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\r\n        out[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\r\n\r\n        out[3] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\r\n        out[4] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\r\n        out[5] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\r\n\r\n        out[6] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\r\n        out[7] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\r\n        out[8] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\r\n        return out;\r\n    }\r\n\r\n    //....................................................................\r\n    //Static Operation\r\n\r\n    //https://github.com/gregtatum/mdn-model-view-projection/blob/master/shared/matrices.js\r\n    static multiplyVector(mat4: Float32Array, v: Float32Array) {\r\n        let x = v[0],\r\n            y = v[1],\r\n            z = v[2],\r\n            w = v[3];\r\n        let c1r1 = mat4[0],\r\n            c2r1 = mat4[1],\r\n            c3r1 = mat4[2],\r\n            c4r1 = mat4[3],\r\n            c1r2 = mat4[4],\r\n            c2r2 = mat4[5],\r\n            c3r2 = mat4[6],\r\n            c4r2 = mat4[7],\r\n            c1r3 = mat4[8],\r\n            c2r3 = mat4[9],\r\n            c3r3 = mat4[10],\r\n            c4r3 = mat4[11],\r\n            c1r4 = mat4[12],\r\n            c2r4 = mat4[13],\r\n            c3r4 = mat4[14],\r\n            c4r4 = mat4[15];\r\n\r\n        return [\r\n            x * c1r1 + y * c1r2 + z * c1r3 + w * c1r4,\r\n            x * c2r1 + y * c2r2 + z * c2r3 + w * c2r4,\r\n            x * c3r1 + y * c3r2 + z * c3r3 + w * c3r4,\r\n            x * c4r1 + y * c4r2 + z * c4r3 + w * c4r4\r\n        ];\r\n    }\r\n\r\n    //https://github.com/toji/gl-matrix/blob/master/src/gl-matrix/vec4.js, vec4.transformMat4\r\n    static transformVec4(out: Float32Array, v: number[], m: Float32Array) {\r\n        out[0] = m[0] * v[0] + m[4] * v[1] + m[8] * v[2] + m[12] * v[3];\r\n        out[1] = m[1] * v[0] + m[5] * v[1] + m[9] * v[2] + m[13] * v[3];\r\n        out[2] = m[2] * v[0] + m[6] * v[1] + m[10] * v[2] + m[14] * v[3];\r\n        out[3] = m[3] * v[0] + m[7] * v[1] + m[11] * v[2] + m[15] * v[3];\r\n        return out;\r\n    }\r\n\r\n    //From glMatrix\r\n    //Multiple two mat4 together\r\n    static mult(out: Float32Array, a: Float32Array, b: Float32Array) {\r\n        let a00 = a[0],\r\n            a01 = a[1],\r\n            a02 = a[2],\r\n            a03 = a[3],\r\n            a10 = a[4],\r\n            a11 = a[5],\r\n            a12 = a[6],\r\n            a13 = a[7],\r\n            a20 = a[8],\r\n            a21 = a[9],\r\n            a22 = a[10],\r\n            a23 = a[11],\r\n            a30 = a[12],\r\n            a31 = a[13],\r\n            a32 = a[14],\r\n            a33 = a[15];\r\n\r\n        // Cache only the current line of the second matrix\r\n        let b0 = b[0],\r\n            b1 = b[1],\r\n            b2 = b[2],\r\n            b3 = b[3];\r\n        out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n        out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n        out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n        out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n        b0 = b[4];\r\n        b1 = b[5];\r\n        b2 = b[6];\r\n        b3 = b[7];\r\n        out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n        out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n        out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n        out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n        b0 = b[8];\r\n        b1 = b[9];\r\n        b2 = b[10];\r\n        b3 = b[11];\r\n        out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n        out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n        out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n        out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n        b0 = b[12];\r\n        b1 = b[13];\r\n        b2 = b[14];\r\n        b3 = b[15];\r\n        out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n        out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n        out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n        out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n        return out;\r\n    }\r\n\r\n\r\n    //....................................................................\r\n    //Static Transformation\r\n    static scale(out: Float32Array, x: number, y: number, z: number) {\r\n        out[0] *= x;\r\n        out[1] *= x;\r\n        out[2] *= x;\r\n        out[3] *= x;\r\n        out[4] *= y;\r\n        out[5] *= y;\r\n        out[6] *= y;\r\n        out[7] *= y;\r\n        out[8] *= z;\r\n        out[9] *= z;\r\n        out[10] *= z;\r\n        out[11] *= z;\r\n        return out;\r\n    };\r\n\r\n    static rotateY(out: Float32Array, rad: number) {\r\n        let s = Math.sin(rad),\r\n            c = Math.cos(rad),\r\n            a00 = out[0],\r\n            a01 = out[1],\r\n            a02 = out[2],\r\n            a03 = out[3],\r\n            a20 = out[8],\r\n            a21 = out[9],\r\n            a22 = out[10],\r\n            a23 = out[11];\r\n\r\n        // Perform axis-specific matrix multiplication\r\n        out[0] = a00 * c - a20 * s;\r\n        out[1] = a01 * c - a21 * s;\r\n        out[2] = a02 * c - a22 * s;\r\n        out[3] = a03 * c - a23 * s;\r\n        out[8] = a00 * s + a20 * c;\r\n        out[9] = a01 * s + a21 * c;\r\n        out[10] = a02 * s + a22 * c;\r\n        out[11] = a03 * s + a23 * c;\r\n        return out;\r\n    }\r\n\r\n    static rotateX(out: Float32Array, rad: number) {\r\n        let s = Math.sin(rad),\r\n            c = Math.cos(rad),\r\n            a10 = out[4],\r\n            a11 = out[5],\r\n            a12 = out[6],\r\n            a13 = out[7],\r\n            a20 = out[8],\r\n            a21 = out[9],\r\n            a22 = out[10],\r\n            a23 = out[11];\r\n\r\n        // Perform axis-specific matrix multiplication\r\n        out[4] = a10 * c + a20 * s;\r\n        out[5] = a11 * c + a21 * s;\r\n        out[6] = a12 * c + a22 * s;\r\n        out[7] = a13 * c + a23 * s;\r\n        out[8] = a20 * c - a10 * s;\r\n        out[9] = a21 * c - a11 * s;\r\n        out[10] = a22 * c - a12 * s;\r\n        out[11] = a23 * c - a13 * s;\r\n        return out;\r\n    }\r\n\r\n    static rotateZ(out: Float32Array, rad: number) {\r\n        let s = Math.sin(rad),\r\n            c = Math.cos(rad),\r\n            a00 = out[0],\r\n            a01 = out[1],\r\n            a02 = out[2],\r\n            a03 = out[3],\r\n            a10 = out[4],\r\n            a11 = out[5],\r\n            a12 = out[6],\r\n            a13 = out[7];\r\n\r\n        // Perform axis-specific matrix multiplication\r\n        out[0] = a00 * c + a10 * s;\r\n        out[1] = a01 * c + a11 * s;\r\n        out[2] = a02 * c + a12 * s;\r\n        out[3] = a03 * c + a13 * s;\r\n        out[4] = a10 * c - a00 * s;\r\n        out[5] = a11 * c - a01 * s;\r\n        out[6] = a12 * c - a02 * s;\r\n        out[7] = a13 * c - a03 * s;\r\n        return out;\r\n    }\r\n\r\n    static rotate(out: Float32Array, rad: number, axis: Float32Array) {\r\n        let x = axis[0],\r\n            y = axis[1],\r\n            z = axis[2],\r\n            len = Math.sqrt(x * x + y * y + z * z),\r\n            s, c, t,\r\n            a00, a01, a02, a03,\r\n            a10, a11, a12, a13,\r\n            a20, a21, a22, a23,\r\n            b00, b01, b02,\r\n            b10, b11, b12,\r\n            b20, b21, b22;\r\n\r\n        if (Math.abs(len) < 0.000001) {\r\n            return null;\r\n        }\r\n\r\n        len = 1 / len;\r\n        x *= len;\r\n        y *= len;\r\n        z *= len;\r\n\r\n        s = Math.sin(rad);\r\n        c = Math.cos(rad);\r\n        t = 1 - c;\r\n\r\n        a00 = out[0];\r\n        a01 = out[1];\r\n        a02 = out[2];\r\n        a03 = out[3];\r\n        a10 = out[4];\r\n        a11 = out[5];\r\n        a12 = out[6];\r\n        a13 = out[7];\r\n        a20 = out[8];\r\n        a21 = out[9];\r\n        a22 = out[10];\r\n        a23 = out[11];\r\n\r\n        // Construct the elements of the rotation matrix\r\n        b00 = x * x * t + c;\r\n        b01 = y * x * t + z * s;\r\n        b02 = z * x * t - y * s;\r\n        b10 = x * y * t - z * s;\r\n        b11 = y * y * t + c;\r\n        b12 = z * y * t + x * s;\r\n        b20 = x * z * t + y * s;\r\n        b21 = y * z * t - x * s;\r\n        b22 = z * z * t + c;\r\n\r\n        // Perform rotation-specific matrix multiplication\r\n        out[0] = a00 * b00 + a10 * b01 + a20 * b02;\r\n        out[1] = a01 * b00 + a11 * b01 + a21 * b02;\r\n        out[2] = a02 * b00 + a12 * b01 + a22 * b02;\r\n        out[3] = a03 * b00 + a13 * b01 + a23 * b02;\r\n        out[4] = a00 * b10 + a10 * b11 + a20 * b12;\r\n        out[5] = a01 * b10 + a11 * b11 + a21 * b12;\r\n        out[6] = a02 * b10 + a12 * b11 + a22 * b12;\r\n        out[7] = a03 * b10 + a13 * b11 + a23 * b12;\r\n        out[8] = a00 * b20 + a10 * b21 + a20 * b22;\r\n        out[9] = a01 * b20 + a11 * b21 + a21 * b22;\r\n        out[10] = a02 * b20 + a12 * b21 + a22 * b22;\r\n        out[11] = a03 * b20 + a13 * b21 + a23 * b22;\r\n    }\r\n\r\n    static invert(out: Float32Array, mat ? : Float32Array) {\r\n        if (mat === undefined) mat = out; //If input isn't sent, then output is also input\r\n\r\n        let a00 = mat[0],\r\n            a01 = mat[1],\r\n            a02 = mat[2],\r\n            a03 = mat[3],\r\n            a10 = mat[4],\r\n            a11 = mat[5],\r\n            a12 = mat[6],\r\n            a13 = mat[7],\r\n            a20 = mat[8],\r\n            a21 = mat[9],\r\n            a22 = mat[10],\r\n            a23 = mat[11],\r\n            a30 = mat[12],\r\n            a31 = mat[13],\r\n            a32 = mat[14],\r\n            a33 = mat[15],\r\n\r\n            b00 = a00 * a11 - a01 * a10,\r\n            b01 = a00 * a12 - a02 * a10,\r\n            b02 = a00 * a13 - a03 * a10,\r\n            b03 = a01 * a12 - a02 * a11,\r\n            b04 = a01 * a13 - a03 * a11,\r\n            b05 = a02 * a13 - a03 * a12,\r\n            b06 = a20 * a31 - a21 * a30,\r\n            b07 = a20 * a32 - a22 * a30,\r\n            b08 = a20 * a33 - a23 * a30,\r\n            b09 = a21 * a32 - a22 * a31,\r\n            b10 = a21 * a33 - a23 * a31,\r\n            b11 = a22 * a33 - a23 * a32,\r\n\r\n            // Calculate the determinant\r\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n        if (!det) return false;\r\n        det = 1.0 / det;\r\n\r\n        out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\r\n        out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\r\n        out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\r\n        out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\r\n        out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\r\n        out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\r\n        out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\r\n        out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\r\n        out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\r\n        out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\r\n        out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\r\n        out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\r\n        out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\r\n        out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\r\n        out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\r\n        out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\r\n\r\n        return true;\r\n    }\r\n\r\n    //https://github.com/toji/gl-matrix/blob/master/src/gl-matrix/mat4.js  mat4.scalar.translate = function (out, a, v) {\r\n    static translate(out: Float32Array, x: number, y: number, z: number) {\r\n        out[12] = out[0] * x + out[4] * y + out[8] * z + out[12];\r\n        out[13] = out[1] * x + out[5] * y + out[9] * z + out[13];\r\n        out[14] = out[2] * x + out[6] * y + out[10] * z + out[14];\r\n        out[15] = out[3] * x + out[7] * y + out[11] * z + out[15];\r\n    }\r\n}\r\n\r\nexport {\r\n    Vector3,\r\n    Matrix4\r\n}","import { Matrix4, Vector3 } from \"./math\";\r\nimport { degToRad } from \"@/modules\";\r\n\r\nexport default class Transformation {\r\n\r\n    constructor() {\r\n        //identity matrix\r\n        //transform vectors\r\n        this.position = new Vector3(0, 0, 0);   //Traditional X,Y,Z 3d position\r\n        this.scale = new Vector3(1, 1, 1);      //How much to scale a mesh. Having a 1 means no scaling is done.\r\n        this.rotation = new Vector3(0, 0, 0);   //Hold rotation values based on degrees, Object will translate it to radians\r\n        this.matView = new Matrix4();           //Cache the results when calling updateMatrix\r\n        this.matNormal = new Float32Array(9);   //This is a Mat3, matrix array to hold the values is enough for what its used for\r\n\r\n        //Direction Vectors, Need 4 elements for math operations with matrices\r\n        this.forward = new Float32Array(4);     //When rotating, keep track of what the forward direction is\r\n        this.up = new Float32Array(4);          //what the up direction is, invert to get bottom\r\n        this.right = new Float32Array(4);       //what the right direction is, invert to get left\r\n    }\r\n\r\n    position: Vector3;\r\n    scale: Vector3;\r\n    rotation: Vector3;\r\n    matView: Matrix4;\r\n    matNormal: Float32Array;\r\n    forward: Float32Array;\r\n    up: Float32Array;\r\n    right: Float32Array;\r\n\r\n\r\n    updateMatrix() {\r\n        this.matView.resetMat() //Order is very important!!\r\n            .vtranslate(this.position)\r\n            .rotateX(degToRad(this.rotation.x))\r\n            .rotateY(degToRad(this.rotation.y))\r\n            .rotateZ(degToRad(this.rotation.z))\r\n            .vscale(this.scale);\r\n\r\n        //Calcuate the Normal Matrix which doesn't need translate, then transpose and inverses the mat4 to mat3\r\n        Matrix4.normalMat3(this.matNormal, this.matView.matrix);\r\n\r\n        //Determine Direction after all the transformations.\r\n        Matrix4.transformVec4(this.forward, [0, 0, 1, 0], this.matView.matrix); //Z\r\n        Matrix4.transformVec4(this.up, [0, 1, 0, 0], this.matView.matrix); //Y\r\n        Matrix4.transformVec4(this.right, [1, 0, 0, 0], this.matView.matrix); //X\r\n\r\n        return this.matView.matrix;\r\n    }\r\n\r\n    updateDirection() {\r\n        Matrix4.transformVec4(this.forward, [0, 0, 1, 0], this.matView.matrix);\r\n        Matrix4.transformVec4(this.up, [0, 1, 0, 0], this.matView.matrix);\r\n        Matrix4.transformVec4(this.right, [1, 0, 0, 0], this.matView.matrix);\r\n        return this;\r\n    }\r\n\r\n    getModelMatrix() {\r\n        return this.matView.matrix;\r\n    }\r\n\r\n    getNormalMatrix() {\r\n        return this.matNormal;\r\n    }\r\n\r\n    reset() {\r\n        this.position.set(0, 0, 0);\r\n        this.scale.set(1, 1, 1);\r\n        this.rotation.set(0, 0, 0);\r\n    }\r\n}","\r\nimport { CameraControlsSettings, CameraSettings, degToRad } from \"@/modules\";\r\nimport { Matrix4 } from \"./math\";\r\nimport Transformation from \"./transformation\";\r\n\r\n//https://github.com/sketchpunk/FunWithWebGL2/tree/master/lesson_006\r\nclass Camera {\r\n  constructor(gl: WebGLRenderingContext, fov: number = CameraSettings.FIELD_OF_VIEW, near: number = CameraSettings.NEAR_PLANE, far: number = CameraSettings.FAR_PLANE) {\r\n\r\n    this.perspectiveProjection = new Float32Array(16);\r\n    this.orthoProjection = new Float32Array(16);\r\n\r\n    const ratio = gl.canvas.width / gl.canvas.height;\r\n    const left = - gl.canvas.width / 2\r\n    const right = gl.canvas.width / 2\r\n    const top = gl.canvas.height / 2\r\n    const bottom = - gl.canvas.height / 2\r\n    \r\n    Matrix4.perspective(this.perspectiveProjection, fov, ratio, near, far);\r\n    Matrix4.ortho(this.orthoProjection, left, right, bottom, top, 1, 10)\r\n\r\n    this.transform = new Transformation(); //Setup transform to control the position of the camera\r\n    this.viewMatrix = new Float32Array(16); //Cache the matrix that will hold the inverse of the transform.\r\n\r\n    this.mode = Camera.MODE_ORBIT; //Set what sort of control mode to use.\r\n  }\r\n\r\n  transform: Transformation;\r\n  perspectiveProjection: Float32Array;\r\n  orthoProjection: Float32Array;\r\n  viewMatrix: Float32Array;\r\n  mode: number;\r\n\r\n  static MODE_FREE = CameraSettings.MODE_FREE; //Allows free movement of position and rotation, basicly first person type of camera\r\n  static MODE_ORBIT = CameraSettings.MODE_ORBIT; //Movement is locked to rotate around the origin, Great for 3d editors or a single model viewer\r\n\r\n  panX(v: number) {\r\n    if (this.mode == Camera.MODE_ORBIT) return; // Panning on the X Axis is only allowed when in free mode\r\n    this.updateViewMatrix();\r\n    this.transform.position.x += this.transform.right[0] * v;\r\n    this.transform.position.y += this.transform.right[1] * v;\r\n    this.transform.position.z += this.transform.right[2] * v;\r\n  }\r\n\r\n  panY(v: number) {\r\n    this.updateViewMatrix();\r\n    this.transform.position.y += this.transform.up[1] * v;\r\n    if (this.mode == Camera.MODE_ORBIT) return; //Can only move up and down the y axix in orbit mode\r\n    this.transform.position.x += this.transform.up[0] * v;\r\n    this.transform.position.z += this.transform.up[2] * v;\r\n  }\r\n\r\n  panZ(v: number) {\r\n    this.updateViewMatrix();\r\n    if (this.mode == Camera.MODE_ORBIT) {\r\n      this.transform.position.z += v; //orbit mode does translate after rotate, so only need to set Z, the rotate will handle the rest.\r\n    } else {\r\n      //in freemode to move forward, we need to move based on our forward which is relative to our current rotation\r\n      this.transform.position.x += this.transform.forward[0] * v;\r\n      this.transform.position.y += this.transform.forward[1] * v;\r\n      this.transform.position.z += this.transform.forward[2] * v;\r\n    }\r\n  }\r\n\r\n  //To have different modes of movements, this function handles the view matrix update for the transform object.\r\n  \r\n  updateViewMatrix() {\r\n    //Optimize camera transform update, no need for scale nor rotateZ\r\n    if (this.mode == Camera.MODE_FREE) {\r\n      this.transform.matView.resetMat()\r\n        .vtranslate(this.transform.position)\r\n        .rotateX(degToRad(this.transform.rotation.x))\r\n        .rotateY(degToRad(this.transform.rotation.y));\r\n\r\n    } else {\r\n      this.transform.matView.resetMat()\r\n        .rotateX(degToRad(this.transform.rotation.x))\r\n        .rotateY(degToRad(this.transform.rotation.y))\r\n        .vtranslate(this.transform.position);\r\n\r\n    }\r\n\r\n    this.transform.updateDirection();\r\n\r\n    //Cameras work by doing the inverse transformation on all meshes, the camera itself is a lie :)\r\n    Matrix4.invert(this.viewMatrix, this.transform.matView.matrix);\r\n\r\n    return this.viewMatrix;\r\n  }\r\n}\r\n\r\nclass CameraController {\r\n  constructor(gl: WebGLRenderingContext, camera: Camera) {\r\n    const box = (gl.canvas as HTMLCanvasElement).getBoundingClientRect();\r\n    this.canvas = gl.canvas as HTMLCanvasElement; //Need access to the canvas html element, main to access events\r\n    this.camera = camera; //Reference to the camera to control\r\n\r\n    this.rotateRate = CameraControlsSettings.ROTATION_RATE; //How fast to rotate, degrees per dragging delta\r\n    this.panRate = CameraControlsSettings.PAN_RATE; //How fast to pan, max unit per dragging delta\r\n    this.zoomRate = CameraControlsSettings.ZOOM_RATE; //How fast to zoom or can be viewed as forward/backward movement\r\n\r\n    this.offsetX = box.left; //Help calc global x,y mouse cords.\r\n    this.offsetY = box.top;\r\n\r\n    this.initX = 0; //Starting X,Y position on mouse down\r\n    this.initY = 0;\r\n    this.prevX = 0; //Previous X,Y position on mouse move\r\n    this.prevY = 0;\r\n\r\n\t\tthis.onUpHandler = (e: MouseEvent) => this.onMouseUp(e);//Cache func reference that gets bound and unbound a lot\r\n\t\tthis.onMoveHandler = (e: MouseEvent) => this.onMouseMove(e);\r\n\r\n\t\tthis.canvas.addEventListener(CameraControlsSettings.MOUSE_DOWN, (e: MouseEvent) => this.onMouseDown(e));\t\t//Initializes the up and move events\r\n\t\tthis.canvas.addEventListener(CameraControlsSettings.MOUSE_WHEEL, (e: Event ) => this.onMouseWheel(e));\t//Handles zoom/forward movement\r\n  }\r\n\r\n  canvas: HTMLCanvasElement;\r\n  camera: Camera;\r\n  rotateRate: number; //How fast to rotate, degrees per dragging delta\r\n  panRate: number; //How fast to pan, max unit per dragging delta\r\n  zoomRate: number; //How fast to zoom or can be viewed as forward/backward movement\r\n  offsetX: number; //Help calc global x,y mouse cords.\r\n  offsetY: number;\r\n  initX: number; //Starting X,Y position on mouse down\r\n  initY: number;\r\n  prevX: number; //Previous X,Y position on mouse move\r\n  prevY: number;\r\n  onUpHandler:any;\r\n  onMoveHandler:any;\r\n\r\n  //Transform mouse x,y cords to something useable by the canvas.\r\n  getMouseVec2(e: MouseEvent) {\r\n    return {\r\n      x: e.pageX - this.offsetX,\r\n      y: e.pageY - this.offsetY\r\n    };\r\n  }\r\n\r\n\r\n  //Begin listening for dragging movement\r\n  onMouseDown(e: MouseEvent) {\r\n    this.initX = this.prevX = e.pageX - this.offsetX;\r\n    this.initY = this.prevY = e.pageY - this.offsetY;\r\n\r\n    this.canvas.addEventListener(CameraControlsSettings.MOUSE_UP, this.onUpHandler);\r\n    this.canvas.addEventListener(CameraControlsSettings.MOUSE_MOVE, this.onMoveHandler);\r\n  }\r\n\r\n  //End listening for dragging movement\r\n  onMouseUp(e: MouseEvent) {\r\n    this.canvas.removeEventListener(CameraControlsSettings.MOUSE_UP, this.onUpHandler);\r\n    this.canvas.removeEventListener(CameraControlsSettings.MOUSE_MOVE, this.onMoveHandler);\r\n  }\r\n\r\n  onMouseWheel(e: any) {\r\n    let delta = Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail))); //Try to map wheel movement to a number between -1 and 1\r\n    this.camera.panZ(-delta * (this.zoomRate / this.canvas.height)); //Keep the movement speed the same, no matter the height diff\r\n  }\r\n\r\n  onMouseMove(e: MouseEvent) {\r\n    let x = e.pageX - this.offsetX, //Get X,y where the canvas's position is origin.\r\n      y = e.pageY - this.offsetY,\r\n      dx = x - this.prevX, //Difference since last mouse move\r\n      dy = y - this.prevY;\r\n\r\n    //When shift is being helt down, we pan around else we rotate.\r\n    if (!e.shiftKey) {\r\n      this.camera.transform.rotation.y += dx * (this.rotateRate / this.canvas.width);\r\n      this.camera.transform.rotation.x += dy * (this.rotateRate / this.canvas.height);\r\n    } else {\r\n      this.camera.panX(-dx * (this.panRate / this.canvas.width));\r\n      this.camera.panY(dy * (this.panRate / this.canvas.height));\r\n    }\r\n\r\n    this.prevX = x;\r\n    this.prevY = y;\r\n  }\r\n}\r\n\r\nexport {\r\n  Camera,\r\n  CameraController\r\n}","\r\nimport { MeshData } from \"@/entities\";\r\nimport Transformation from \"./transformation\";\r\nexport default class Geometry {\r\n\r\n    constructor( mesh: MeshData) {\r\n\r\n        this.mesh = mesh;\r\n        this.transform = new Transformation();\r\n    }\r\n\r\n    mesh: MeshData;\r\n    transform: Transformation;\r\n\r\n\r\n    setScale(x: number, y: number, z: number) {\r\n        this.transform.scale.set(x, y, z);\r\n        return this;\r\n    }\r\n\r\n    setPosition(x: number, y: number, z: number) {\r\n        this.transform.position.set(x, y, z);\r\n        return this;\r\n    }\r\n\r\n    setRotation(x: number, y: number, z: number) {\r\n        this.transform.rotation.set(x, y, z);\r\n        return this;\r\n    }\r\n\r\n    addScale(x: number, y: number, z: number) {\r\n        this.transform.scale.x += x;\r\n        this.transform.scale.y += y;\r\n        this.transform.scale.y += y;\r\n        return this;\r\n    }\r\n\r\n    addPosition(x: number, y: number, z: number) {\r\n        this.transform.position.x += x;\r\n        this.transform.position.y += y;\r\n        this.transform.position.z += z;\r\n        return this;\r\n    }\r\n\r\n    addRotation(x: number, y: number, z: number) {\r\n        this.transform.rotation.x += x;\r\n        this.transform.rotation.y += y;\r\n        this.transform.rotation.z += z;\r\n        return this;\r\n    }\r\n\r\n    preRender() {\r\n        this.transform.updateMatrix();\r\n        return this;\r\n    }\r\n}","export default class Texture {\r\n\r\n    constructor(gl: WebGLRenderingContext, image: HTMLImageElement) {\r\n        const texture = gl.createTexture() as WebGLTexture\r\n        gl.bindTexture(gl.TEXTURE_2D, texture as WebGLTexture)\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image)\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR)\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\r\n        gl.generateMipmap(gl.TEXTURE_2D)\r\n\r\n        this.gl = gl\r\n    }\r\n\r\n    gl: WebGLRenderingContext;\r\n\r\n    // Asynchronously load an image\r\n    static loadTexture(gl: WebGLRenderingContext, url: string): Promise < Texture > {\r\n        return new Promise(function (resolve) {\r\n            const image = new Image()\r\n            image.onload = function () {\r\n                resolve(new Texture(gl, image))\r\n            };\r\n            image.src = url\r\n        });\r\n    }\r\n\r\n}","import { GLSetttings } from \"@/modules\";\r\n\r\nexport default class Vbuffer {\r\n\r\n  constructor(gl: WebGLRenderingContext, data: number[], count: number, type:string) {\r\n    this.buffer = gl.createBuffer() as WebGLBuffer;\r\n\r\n    switch (type) {\r\n      case GLSetttings.BUFFER_TYPE_VERTICES:\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);\r\n        break;\r\n\r\n      case GLSetttings.BUFFER_TYPE_INDICES:\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(data), gl.STATIC_DRAW);\r\n        break;\r\n    \r\n      default:\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);\r\n        break;\r\n    }\r\n\r\n\r\n    this.gl = gl;\r\n    this.size = data.length / count;\r\n  }\r\n\r\n  buffer: WebGLBuffer;\r\n  gl: WebGLRenderingContext;\r\n  size: number;\r\n\r\n\r\n  destroy() {\r\n    this.gl.deleteBuffer(this.buffer);\r\n  }\r\n\r\n\r\n  bindToAttribute(data: number|number[], stride: number, offset: number, size: number = this.size, type:string = GLSetttings.BUFFER_TYPE_VERTICES) {\r\n    const gl = this.gl\r\n    switch (type) {\r\n      case GLSetttings.BUFFER_TYPE_VERTICES:\r\n        gl.enableVertexAttribArray(data as number);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n        gl.vertexAttribPointer(data as number, size, gl.FLOAT, false, stride, offset);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER,null);\r\n        break;\r\n\r\n      case GLSetttings.BUFFER_TYPE_INDICES:\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(data as number[]), gl.STATIC_DRAW);\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null);\r\n        break;\r\n    \r\n      default:\r\n        gl.enableVertexAttribArray(data as number);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n        gl.vertexAttribPointer(data as number, size, gl.FLOAT, false, stride, offset);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER,null);\r\n        break;\r\n    }\r\n  }\r\n\r\n\r\n\r\n}","import { ShaderProgramMatrixFields } from \"@/modules\"\r\nimport Geometry from \"./geometry\"\r\n\r\nexport default class ShaderProgram {\r\n  constructor(gl: WebGLRenderingContext, vsSource: string, fsSource: string) {\r\n\r\n    const vertexShader = this.createShader(gl, gl.VERTEX_SHADER, vsSource) as WebGLShader\r\n    const fragmentShader = this.createShader(gl, gl.FRAGMENT_SHADER, fsSource) as WebGLShader\r\n    const shaderProgram = this.createShaderProgram(gl, fragmentShader, vertexShader)\r\n    this.program = shaderProgram\r\n    this.gl = gl\r\n  }\r\n\r\n  gl: WebGLRenderingContext | null = null\r\n  vertexShader: WebGLShader | null = null\r\n  fragmentShader: WebGLShader | null = null\r\n  program: WebGLProgram\r\n\r\n\r\n  createShader(gl: WebGLRenderingContext, type: number, source: string) {\r\n    const shader = gl.createShader(type) as WebGLShader\r\n\r\n    // Send the source to the shader object\r\n    gl.shaderSource(shader, source)\r\n\r\n    // Compile the shader program\r\n    gl.compileShader(shader)\r\n\r\n    // See if it compiled successfully\r\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n      console.error('An error occurred compiling the shaders: ' + gl.getShaderInfoLog(shader))\r\n      gl.deleteShader(shader)\r\n      return null\r\n    }\r\n\r\n    return shader\r\n  }\r\n\r\n  createShaderProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\r\n\r\n    const program = gl.createProgram() as WebGLProgram\r\n\r\n    gl.attachShader(program, vertexShader)\r\n    gl.attachShader(program, fragmentShader)\r\n    gl.linkProgram(program)\r\n\r\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n      console.error(\"Error creating shader program.\", gl.getProgramInfoLog(program))\r\n      gl.deleteProgram(program)\r\n      throw new Error('Failed to link shaderProgram')\r\n    }\r\n\r\n    this.vertexShader = vertexShader\r\n    this.fragmentShader = fragmentShader\r\n\r\n\r\n    gl.detachShader(program, vertexShader)\r\n    gl.detachShader(program, fragmentShader)\r\n    gl.deleteShader(fragmentShader)\r\n    gl.deleteShader(vertexShader)\r\n\r\n    return program\r\n  }\r\n\r\n  activateShader() {\r\n    (this.gl as WebGLRenderingContext).useProgram(this.program)\r\n    return this\r\n  }\r\n\r\n  deactivateShader() {\r\n    (this.gl as WebGLRenderingContext).useProgram(null)\r\n    return this\r\n  }\r\n\r\n  dispose() {\r\n    //unbind the program if its currently active\r\n    if ((this.gl as WebGLRenderingContext).getParameter((this.gl as WebGLRenderingContext).CURRENT_PROGRAM) === this.program) {\r\n      this.deactivateShader()\r\n    }\r\n    (this.gl as WebGLRenderingContext).deleteProgram(this.program)\r\n  }\r\n\r\n  renderModel(model: Geometry) {\r\n    const gl = this.gl as WebGLRenderingContext\r\n    \r\n\t\tif(model.mesh.noCulling) gl.disable(gl.CULL_FACE)\r\n\t\tif(model.mesh.doBlending) gl.enable(gl.BLEND)\r\n\r\n\t\tgl.drawArrays(model.mesh.drawMode, 0, model.mesh.vertexCount)\r\n\r\n\t\t//Cleanup\r\n\t\tif(model.mesh.noCulling) gl.enable(gl.CULL_FACE)\r\n\t\tif(model.mesh.doBlending) gl.disable(gl.BLEND)\r\n\r\n\t\treturn this\r\n  }\r\n\r\n}","import { Normal, Vector, Surface, UV, Vertex } from \"@/entities\";\r\nimport { SurfaceStruct, Vec2Struct, Vec3Struct, VertexStruct } from \"@/modules\";\r\n\r\nexport default class ObjLoader {\r\n\r\n    constructor(surfaces: Array < Surface > ) {\r\n        this.surfaces = surfaces;\r\n    }\r\n\r\n    surfaces: Surface[] = [];\r\n\r\n    static parseOBJ(src: string) {\r\n\r\n        const POSITION = /^v\\s+([\\d\\.\\+\\-eE]+)\\s+([\\d\\.\\+\\-eE]+)\\s+([\\d\\.\\+\\-eE]+)/\r\n        const NORMAL = /^vn\\s+([\\d\\.\\+\\-eE]+)\\s+([\\d\\.\\+\\-eE]+)\\s+([\\d\\.\\+\\-eE]+)/\r\n        const UV = /^vt\\s+([\\d\\.\\+\\-eE]+)\\s+([\\d\\.\\+\\-eE]+)/\r\n        const SURFACE = /^f\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+))?/\r\n\r\n        const lines = src.split('\\n');\r\n        const positions: Vector[] = [];\r\n        const uvs: UV[] = [];\r\n        const normals: Normal[] = [];\r\n        const surfaces: Surface[] = [];\r\n\r\n        lines.forEach(function (line: string) {\r\n            // Match each line of the file against various RegEx-es\r\n            let result = null;\r\n            if ((result = POSITION.exec(line)) !== null) {\r\n                // Add new vertex position\r\n                positions.push(Vec3Struct(parseFloat(result[1]), parseFloat(result[2]), parseFloat(result[3])))\r\n            } else if ((result = NORMAL.exec(line)) !== null) {\r\n                // Add new vertex normal\r\n                normals.push(Vec3Struct(parseFloat(result[1]), parseFloat(result[2]), parseFloat(result[3])))\r\n            } else if ((result = UV.exec(line)) !== null) {\r\n                // Add new texture mapping point\r\n                uvs.push(Vec2Struct(parseFloat(result[1]), 1 - parseFloat(result[2])))\r\n            } else if ((result = SURFACE.exec(line)) !== null) {\r\n                // Add new face\r\n                const vertices: Vertex[] = [];\r\n                // Create three vertices from the passed one-indexed indices\r\n                for (let i = 1; i < 10; i += 3) {\r\n                    const part = result.slice(i, i + 3);\r\n                    const position = positions[parseInt(part[0]) - 1];\r\n                    const uv = uvs[parseInt(part[1]) - 1];\r\n                    const normal = normals[parseInt(part[2]) - 1];\r\n                    vertices.push(VertexStruct(position, normal, uv));\r\n                }\r\n                surfaces.push(SurfaceStruct(vertices));\r\n            }\r\n        })\r\n\r\n        return new ObjLoader(surfaces);\r\n    }\r\n\r\n    static async loadOBJ(url: string) {\r\n        const response = await fetch(url);\r\n        const data = ObjLoader.parseOBJ(await response.text());\r\n        return data;\r\n    }\r\n\r\n    vertexCount() {\r\n        return this.surfaces.length * 3;\r\n    }\r\n\r\n    positions() {\r\n        const result: number[] = [];\r\n        this.surfaces.forEach(function (surface: Surface) {\r\n            surface.vertices.forEach(function (vertex: Vertex) {\r\n                const v = vertex.position;\r\n                result.push(v.x, v.y, v.z);\r\n            })\r\n        })\r\n\r\n        return result;\r\n    }\r\n\r\n    normals() {\r\n        const result: number[] = [];\r\n        this.surfaces.forEach(function (surface: Surface) {\r\n            surface.vertices.forEach(function (vertex: Vertex) {\r\n                const v = vertex.normal;\r\n                result.push(v.x, v.y, v.z);\r\n            })\r\n        })\r\n\r\n        return result;\r\n    }\r\n\r\n    uvs() {\r\n        const result: number[] = [];\r\n        this.surfaces.forEach(function (surface: Surface) {\r\n            surface.vertices.forEach(function (vertex: Vertex) {\r\n                const v = vertex.uv;\r\n                result.push(v.x, v.y);\r\n            })\r\n        })\r\n\r\n        return result;\r\n    }\r\n\r\n}","import Geometry from './geometry';\r\nimport Texture from './Textures/texture';\r\nimport Vbuffer from './vbuffer';\r\nimport ShaderProgram from './shaderProgram';\r\nimport ObjLoader from './objLoader';\r\nimport { MeshData } from '@/entities';\r\nimport { GLSetttings } from '@/modules';\r\nimport { Camera } from './camera';\r\nimport { Matrix4 } from './math';\r\n\r\nclass ModelShader{\r\n\tconstructor(gl: WebGLRenderingContext, camera:Camera, lightViewCamera:Camera){\t\r\n\t\tconst vertexShader = `#version 300 es\r\n\t\t\tin vec3 a_position;\r\n\t\t\tin vec3 a_norm;\r\n\t\t\tin vec2 a_texCoord;\r\n\r\n\t\t\tuniform vec3 u_lightPosition;\r\n\t\t\tuniform vec3 u_cameraPosition;\r\n\r\n\t\t\tuniform mat4 u_mVMatrix;\r\n\t\t\tuniform mat4 u_cameraViewMatrix;\r\n\t\t\tuniform mat4 u_pMatrix;\r\n\t\t\tuniform mat4 u_textureMatrix;\r\n\r\n\t\t\tmat4 m_worldMatrix;\r\n\t\t\tmat4 m_viewProjectionMatrix;\r\n\t\t\tmat4 m_worldViewProjectionMatrix;\r\n\t\t\tmat4 m_textureMatrix;\r\n\t\t\t\r\n\t\t\tout vec3 v_normal;\r\n\t\t\tout vec3 v_surfaceToLight;\r\n\t\t\tout vec3 v_surfaceToCamera;\r\n\r\n\t\t\tout vec2 v_texCoord;\r\n\t\t\tout vec4 v_projectedTexcoord;\r\n\r\n\t\t\tvoid main(void){\r\n\r\n\t\t\t\tm_worldMatrix = u_mVMatrix;\r\n\t\t\t\tm_viewProjectionMatrix = u_pMatrix * u_cameraViewMatrix;\r\n\t\t\t\tm_worldViewProjectionMatrix = m_viewProjectionMatrix * m_worldMatrix;\r\n\t\t\t\tm_textureMatrix = u_textureMatrix;\r\n\r\n\t\t\t\tgl_Position = m_worldViewProjectionMatrix * vec4(a_position, 1.0);\r\n\t\t\t\t\r\n\t\t\t\tv_normal = (u_cameraViewMatrix * vec4(a_norm, 0.0)).xyz;\r\n\r\n\t\t\t\tvec3 v_surfaceWorldPosition = (m_worldMatrix * vec4(a_position, 1.0)).xyz;\r\n\t\t\t\tv_surfaceToLight = u_lightPosition - v_surfaceWorldPosition;\r\n\t\t\t\tv_surfaceToCamera = u_cameraPosition - v_surfaceWorldPosition;\r\n\r\n\t\t\t\tv_texCoord = a_texCoord;\r\n\t\t\t\tv_projectedTexcoord = m_textureMatrix * vec4(v_surfaceWorldPosition, 1.0);\r\n\t\t\t}`;\r\n\r\n\t\tconst fragmentShader = `#version 300 es\r\n\t\t\tprecision highp float;\r\n\r\n\t\t\tin vec2 v_texCoord;\r\n\t\t\tin vec4 v_projectedTexcoord;\r\n\t\t\tin vec3 v_normal;\r\n\t\t\tin vec3 v_surfaceToLight;\r\n\t\t\tin vec3 v_surfaceToCamera;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tuniform vec4 u_lightColor;\r\n\t\t\tuniform vec4 u_ambientLightColor;\r\n\t\t\tuniform sampler2D u_diffuse;\r\n\t\t\tuniform sampler2D u_projectedTexture;\r\n\t\t\tuniform vec4 u_specularColor;\r\n\t\t\tuniform float u_shininess;\r\n\t\t\tuniform float u_specularFactor;\r\n\t\t\tuniform float u_bias;\r\n\t\t\tuniform vec3 u_reverseLightDirection;\r\n\r\n\t\t\tvec4 lit(float l ,float h, float m) {\r\n\t\t\t\treturn vec4(\r\n\t\t\t\t\t1.0,\r\n\t\t\t\t\tabs(l),\r\n\t\t\t\t\t(l > 0.0) ? pow(max(0.0, h), m) : 0.0,\r\n\t\t\t\t\t1.0\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tout vec4 finalColor;\r\n\r\n\t\t\tvoid main(void) {\r\n\r\n\t\t\t\tvec3 normal = normalize(v_normal);\r\n\r\n\t\t\t\tfloat light = dot(normal, u_reverseLightDirection);\r\n\r\n\t\t\t\tvec3 projectedTexcoord = v_projectedTexcoord.xyz / v_projectedTexcoord.w;\r\n\t\t\t\tfloat currentDepth = projectedTexcoord.z + u_bias;\r\n\r\n\t\t\t\tbool inRange =+\r\n\t\t\t\t\tprojectedTexcoord.x >= 0.0 &&+\r\n\t\t\t\t\tprojectedTexcoord.x <= 1.0 &&+\r\n\t\t\t\t\tprojectedTexcoord.y >= 0.0 &&+\r\n\t\t\t\t\tprojectedTexcoord.y <= 1.0;\r\n\r\n\t\t\t\tfloat projectedDepth = texture(u_projectedTexture, projectedTexcoord.xy).r;\r\n\t\t\t\tfloat shadowLight = (inRange && projectedDepth <= currentDepth) ? 0.0 : 1.0;\r\n\r\n\t\t\t\tvec3 surfaceToLightDirection = normalize(v_surfaceToLight);\r\n\t\t\t\tvec3 surfaceToCameraDirection = normalize(v_surfaceToCamera);\r\n\t\t\t\tvec3 halfVector = normalize(surfaceToLightDirection + surfaceToCameraDirection);\r\n\r\n\r\n\t\t\t\tvec4 diffuseColor = texture(u_diffuse, v_texCoord);\r\n\t\t\t\tvec4 litR = lit(dot(normal, surfaceToLightDirection), dot(normal, halfVector), u_shininess);\r\n\t\t\t\t\r\n\t\t\t\tvec4 mult1 = diffuseColor * litR.y;\r\n\t\t\t\tvec4 mult2 = diffuseColor * u_ambientLightColor;\r\n\t\t\t\tvec4 mult3 = u_specularColor * litR.z * u_specularFactor;\r\n\t\t\t\tvec4 mult4 = u_lightColor * ( mult1 + mult2 + mult3);\r\n\r\n\t\t\t\tvec4 outColor = mult4 * vec4(\r\n\t\t\t\t\tdiffuseColor.rgb * light * shadowLight,\r\n\t\t\t\t\tdiffuseColor.a);\r\n\r\n\r\n\t\t\t\tfinalColor = outColor;\r\n\t\t\t}`;\t\t\t\t\t\t\t\t\t\t\t\r\n\r\n\t\tconst shaderProgram = new ShaderProgram(gl, vertexShader, fragmentShader);\r\n\r\n\t\tshaderProgram.activateShader()\r\n\r\n\t\tthis.positionLoc = gl.getAttribLocation(shaderProgram.program as WebGLProgram, GLSetttings.ATTR_POSITION_NAME)\r\n\t\tthis.texCoordLoc = gl.getAttribLocation(shaderProgram.program as WebGLProgram, GLSetttings.ATTR_UV_NAME)\r\n\t\tthis.normalLoc = gl.getAttribLocation(shaderProgram.program as WebGLProgram, GLSetttings.ATTR_NORMAL_NAME)\r\n\r\n\t\tthis.modelViewMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_MODEL_MAT) as WebGLUniformLocation\r\n\t\tthis.perspectiveMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_PERSPECTIV_MAT) as WebGLUniformLocation\r\n\t\tthis.cameraMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_CAMERA_MAT) as WebGLUniformLocation\r\n\t\tthis.projectedTextureLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_PROJECTED_TEXTURE) as WebGLUniformLocation\r\n\t\tthis.textureMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_TEXTURE_MAT) as WebGLUniformLocation\r\n\t\tthis.reverseLightDirectionLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_REVERSE_LIGHT_DIRECTION_MAT) as WebGLUniformLocation\r\n\r\n\t\tthis.diffuseLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_DIFFUSE) as WebGLUniformLocation\r\n\t\tthis.ambientLightColorLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_LIGHT_AMBIENT) as WebGLUniformLocation\r\n\t\tthis.lightPositionLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_LIGHT_POSITION) as WebGLUniformLocation\r\n\t\tthis.cameraPositionLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_CAMERA_POSITION) as WebGLUniformLocation\r\n\t\tthis.shininessLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_CAMERA_SHININESS) as WebGLUniformLocation\r\n\t\tthis.lightColorLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_LIGHT_COLOR) as WebGLUniformLocation\r\n\t\tthis.specularColorLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_SPECULAR_COLOR) as WebGLUniformLocation\r\n\t\tthis.specularFactorLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_SPECULAR_FACTOR) as WebGLUniformLocation\r\n\t\t//Cleanup\r\n\t\tshaderProgram.deactivateShader()\r\n\r\n\t\tthis.perspectiveProjectionMatrix = camera.perspectiveProjection\r\n\t\tthis.orthoProjectionMatrix = camera.orthoProjection\r\n\t\tthis.viewModelMatrix = camera.viewMatrix\r\n\t\tthis.lightViewModelMatrix = lightViewCamera\r\n\t\tthis.shaderProgram = shaderProgram\r\n\t}\r\n\r\n\tpositionLoc: number\r\n\tnormalLoc: number\r\n\ttexCoordLoc: number\r\n  \r\n\tmodelViewMatrixLoc: WebGLUniformLocation\r\n\tperspectiveMatrixLoc: WebGLUniformLocation\r\n\tcameraMatrixLoc: WebGLUniformLocation\r\n\ttextureMatrixLoc: WebGLUniformLocation\r\n\r\n\tdiffuseLoc: WebGLUniformLocation\r\n\tprojectedTextureLoc: WebGLUniformLocation\r\n\tambientLightColorLoc: WebGLUniformLocation\r\n\tlightPositionLoc: WebGLUniformLocation\r\n\tcameraPositionLoc: WebGLUniformLocation\r\n\tshininessLoc: WebGLUniformLocation\r\n\tlightColorLoc: WebGLUniformLocation\r\n\tspecularColorLoc: WebGLUniformLocation\r\n\tspecularFactorLoc: WebGLUniformLocation\r\n\treverseLightDirectionLoc: WebGLUniformLocation\r\n\r\n\tperspectiveProjectionMatrix: Float32Array\r\n\torthoProjectionMatrix:Float32Array\r\n\tviewModelMatrix:Float32Array\r\n\r\n\tlightViewModelMatrix:Camera\r\n\r\n\tshaderProgram: ShaderProgram\r\n\r\n\r\n\tsetUniforms(gl:WebGLRenderingContext, model: Geometry) {\r\n\t\tthis.shaderProgram.activateShader()\r\n\r\n\t\tconst lightWorldMatrix = this.getLightWorldMatrix(this.lightViewModelMatrix, model) as Float32Array\r\n\r\n\t\tgl.uniformMatrix4fv(this.perspectiveMatrixLoc, false, this.perspectiveProjectionMatrix)\r\n\t\tgl.uniformMatrix4fv(this.cameraMatrixLoc , false, this.viewModelMatrix)\r\n\t\tgl.uniform3fv(this.reverseLightDirectionLoc , lightWorldMatrix.slice(8, 11))\r\n\t\tgl.uniformMatrix4fv(this.textureMatrixLoc , false, this.getTextureMatrix(lightWorldMatrix))\r\n\t\tgl.uniformMatrix4fv(this.modelViewMatrixLoc, false, model.transform.getModelMatrix())\t//Set the transform, so the shader knows where the model exists in 3d space\r\n\r\n\t\treturn this\r\n    }\r\n\r\n\tgetTextureMatrix(lightWorldMatrix:Float32Array){\r\n\t\tlet textureMatrix = Matrix4.identity();\r\n\t\tMatrix4.translate(textureMatrix, 0.5, 0.5, 0.5);\r\n\t\tMatrix4.scale(textureMatrix, 0.5, 0.5, 0.5);\r\n\t\tMatrix4.mult(textureMatrix, textureMatrix, this.orthoProjectionMatrix)\r\n\t\tlet inverted:any = []\r\n\t\tMatrix4.invert(inverted, lightWorldMatrix)\r\n\t\tMatrix4.mult(textureMatrix, textureMatrix, inverted)\r\n\t\treturn textureMatrix\r\n\t}\r\n\r\n\tgetLightWorldMatrix(lightViewCamera:Camera, model:Geometry){\r\n\t\t// first draw from the POV of the light\r\n\t\treturn Matrix4.lookAt(\r\n\t\t\t[lightViewCamera.transform.position.x, lightViewCamera.transform.position.y, lightViewCamera.transform.position.z], // position\r\n\t\t\t[model.transform.position.x, model.transform.position.y, model.transform.position.z], // target\r\n\t\t\t[0, 1, 0],// up\r\n\t\t);\r\n\t}\r\n\r\n}\r\n\r\n\r\nclass Model {\r\n\r\n  constructor() {}\r\n\r\n  static async createGeometry(gl: WebGLRenderingContext, shaderProgram: ModelShader, objSrc: string, textureSrc: string){ \r\n    return  new Geometry(await Model.createMesh(gl, shaderProgram, objSrc, textureSrc)); \r\n  }\r\n\r\n  static async createMesh(gl: WebGLRenderingContext, shaderProgram: ModelShader, objSrc: string, textureSrc: string) {\r\n    \r\n    const model = await Model.loadModel(gl, objSrc, textureSrc);\r\n    const vertexCount = model.vertices.vertexCount();\r\n\r\n    const mesh: MeshData = {\r\n      positions : new Vbuffer(gl, model.vertices.positions(), vertexCount, GLSetttings.BUFFER_TYPE_VERTICES),\r\n      normals: new Vbuffer(gl, model.vertices.normals(), vertexCount, GLSetttings.BUFFER_TYPE_VERTICES),\r\n      uvs: new Vbuffer(gl, model.vertices.uvs(), vertexCount, GLSetttings.BUFFER_TYPE_VERTICES),\r\n      texture: model.texture,\r\n      drawMode : gl.TRIANGLES,\r\n      vertexCount,\r\n    }\r\n\r\n    mesh.positions?.bindToAttribute(shaderProgram.positionLoc as number, GLSetttings.DEFAULT_STRIDE, GLSetttings.DEFAULT_OFFSET);\r\n    mesh.normals?.bindToAttribute(shaderProgram.normalLoc as number, GLSetttings.DEFAULT_STRIDE, GLSetttings.DEFAULT_OFFSET);\r\n    mesh.uvs?.bindToAttribute(shaderProgram.texCoordLoc as number, GLSetttings.DEFAULT_STRIDE, GLSetttings.DEFAULT_OFFSET);\r\n\r\n    return mesh;\r\n  }\r\n  \r\n  static async loadModel(gl: WebGLRenderingContext, objSrc: string, textureSrc: string) {\r\n    const objVertices = await ObjLoader.loadOBJ(objSrc);\r\n    const objTexture = await Texture.loadTexture(gl, textureSrc);\r\n    const [vertices, texture] = await Promise.all([objVertices, objTexture]);\r\n    \r\n    return {vertices, texture};\r\n  }\r\n\r\n}\r\n\r\nexport {\r\n\tModelShader,\r\n\tModel\r\n}","export default class DepthTexture {\r\n\r\n    constructor(gl: WebGLRenderingContext, depthTextureSize: number) {\r\n        this.depthTexture = gl.createTexture() as WebGLTexture;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.depthTexture)\r\n        gl.texImage2D(\r\n            gl.TEXTURE_2D,              // target\r\n            0,                          // mip level\r\n            gl.DEPTH_COMPONENT16,       // internal format\r\n            depthTextureSize,           // width\r\n            depthTextureSize,           // height\r\n            0,                          // border\r\n            gl.DEPTH_COMPONENT,         // format\r\n            gl.UNSIGNED_INT,            // type\r\n            null\r\n        );\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n            \r\n        this.depthFramebuffer = gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.depthFramebuffer);\r\n        gl.framebufferTexture2D(\r\n            gl.FRAMEBUFFER,         // target\r\n            gl.DEPTH_ATTACHMENT,    // attachment point\r\n            gl.TEXTURE_2D,          // texture target\r\n            this.depthTexture,      // texture\r\n            0                       // mip level\r\n        );\r\n        \r\n        // create a color texture of the same size as the depth texture\r\n        const unusedTexture = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, unusedTexture);\r\n        gl.texImage2D(\r\n            gl.TEXTURE_2D,\r\n            0,\r\n            gl.RGBA,\r\n            depthTextureSize,\r\n            depthTextureSize,\r\n            0,\r\n            gl.RGBA,\r\n            gl.UNSIGNED_BYTE,\r\n            null,\r\n        );\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        \r\n        // attach it to the framebuffer\r\n        gl.framebufferTexture2D(\r\n            gl.FRAMEBUFFER,        // target\r\n            gl.COLOR_ATTACHMENT0,  // attachment point\r\n            gl.TEXTURE_2D,         // texture target\r\n            unusedTexture,         // texture\r\n            0                       // mip level\r\n        );\r\n        this.depthTextureSize = depthTextureSize\r\n        this.gl = gl\r\n    }\r\n\r\n    depthTexture: WebGLTexture | null = null;\r\n    depthFramebuffer: WebGLFramebuffer | null = null;\r\n    depthTextureSize:number;\r\n    gl: WebGLRenderingContext;\r\n\r\n}","import ShaderProgram from '../shaderProgram';\r\nimport { GLSetttings, ProgramEntrySettings } from \"@/modules\";\r\nimport Geometry from '../geometry';\r\nimport DepthTexture from '../Textures/depthTexture';\r\nimport ObjLoader from '../objLoader';\r\nimport { MeshData } from '@/entities';\r\nimport Vbuffer from '../vbuffer';\r\nimport { Camera } from '../camera';\r\n\r\n\r\nclass DirectionalShadowShader {\r\n\tconstructor(gl: WebGLRenderingContext, camera: Camera) {\r\n\t\tconst vertexShader = `#version 300 es\r\n\t\t\tlayout(location=8) in vec3 a_position;\r\n\r\n\t\t\tuniform mat4 u_mVMatrix;\r\n\t\t\tuniform mat4 u_cameraViewMatrix;\r\n\t\t\tuniform mat4 u_oMatrix;\r\n\r\n\t\t\tmat4 m_worldMatrix;\r\n\t\t\tmat4 m_viewProjectionMatrix;\r\n\t\t\tmat4 m_worldViewProjectionMatrix;\r\n\r\n\t\t\tvoid main(void){\r\n\r\n\t\t\t\tm_worldMatrix = u_mVMatrix;\r\n\t\t\t\tm_viewProjectionMatrix = u_oMatrix * u_cameraViewMatrix;\r\n\t\t\t\tm_worldViewProjectionMatrix = m_viewProjectionMatrix * m_worldMatrix;\r\n\r\n\t\t\t\tgl_Position = m_worldViewProjectionMatrix * vec4(a_position, 1.0);\r\n\t\t\t}`;\r\n\r\n\t\tconst fragmentShader = `#version 300 es\r\n\t\t\tprecision mediump float;\r\n\t\t\tuniform vec4 u_color;\r\n\r\n\t\t\tout vec4 finalColor;\r\n\r\n\t\t\tvoid main(void) {\r\n\t\t\t\tfinalColor = u_color;\r\n\t\t\t}`;\r\n\r\n\t\t\r\n\t\tconst shaderProgram = new ShaderProgram(gl,vertexShader, fragmentShader)\r\n\r\n\t\tshaderProgram.activateShader()\r\n\r\n\t\tthis.positionLoc = gl.getAttribLocation(shaderProgram.program  as WebGLProgram, GLSetttings.ATTR_POSITION_NAME)\r\n\t\t\r\n\t\tthis.modelViewMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_MODEL_MAT) as WebGLUniformLocation\r\n\t\tthis.orthoMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_ORTHO_MAT) as WebGLUniformLocation\r\n        this.cameraMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_CAMERA_MAT) as WebGLUniformLocation\r\n\t\tthis.uColorLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_COLOR) as WebGLUniformLocation\r\n\r\n\t\tthis.orthoProjectionMatrix = camera.orthoProjection\r\n\t\tthis.viewModelMatrix = camera.viewMatrix\r\n\t\tthis.shaderProgram = shaderProgram\r\n\r\n\t\tshaderProgram.deactivateShader()\r\n\t}\r\n\r\n\tpositionLoc: number\r\n\tshaderProgram: ShaderProgram\r\n\r\n\tmodelViewMatrixLoc: WebGLUniformLocation\r\n\torthoMatrixLoc: WebGLUniformLocation\r\n\tcameraMatrixLoc: WebGLUniformLocation\r\n\tuColorLoc: WebGLUniformLocation\r\n\r\n\torthoProjectionMatrix:Float32Array\r\n\tviewModelMatrix:Float32Array\r\n\r\n\tsetUniforms(gl:WebGLRenderingContext, model: Geometry) {\r\n\t\tthis.shaderProgram.activateShader()\r\n        gl.uniformMatrix4fv(this.orthoMatrixLoc , false, this.orthoProjectionMatrix)\r\n\t\tgl.uniformMatrix4fv(this.cameraMatrixLoc , false, this.viewModelMatrix)\r\n\t\tgl.uniformMatrix4fv(this.modelViewMatrixLoc, false, model.transform.getModelMatrix())\r\n\t\tgl.uniform4fv(this.uColorLoc, new Float32Array([0.0, 0.0, 0.0, 1.0]))\r\n\r\n\t\treturn this\r\n    }\r\n}\r\n\r\n\r\nclass DirectionalShadow {\r\n\r\n\tconstructor() {}\r\n\r\n\tstatic async createGeometry(gl: WebGLRenderingContext, shaderProgram: DirectionalShadowShader, objSrc: string) {\r\n\t\treturn new Geometry(await DirectionalShadow.createMesh(gl, shaderProgram, objSrc));\r\n\t}\r\n\r\n\tstatic async createMesh(gl: WebGLRenderingContext, shaderProgram: DirectionalShadowShader, objSrc: string,) {\r\n\r\n\t\tconst model = await DirectionalShadow.loadModel(gl, objSrc);\r\n\t\tconst vertexCount = model.vertices.vertexCount();\r\n\r\n\t\tconst mesh: MeshData = {\r\n\t\t\tpositions: new Vbuffer(gl, model.vertices.positions(), vertexCount, GLSetttings.BUFFER_TYPE_VERTICES),\r\n\t\t\tdepth: model.texture as DepthTexture,\r\n\t\t\tdrawMode: gl.TRIANGLES,\r\n\t\t\tvertexCount,\r\n\t\t}\r\n\r\n\t\tmesh.positions?.bindToAttribute(shaderProgram.positionLoc as number, GLSetttings.DEFAULT_STRIDE, GLSetttings.DEFAULT_OFFSET);\r\n\r\n\t\treturn mesh;\r\n\t}\r\n\r\n\tstatic async loadModel(gl: WebGLRenderingContext, objSrc: string) {\r\n\t\tconst objVertices = await ObjLoader.loadOBJ(objSrc);\r\n\t\tconst objTexture = new DepthTexture(gl, ProgramEntrySettings.DEPTH_TEXTURE_SIZE)\r\n\t\tconst [vertices, texture] = await Promise.all([objVertices, objTexture]);\r\n\t\t\r\n\t\treturn {vertices, texture};\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport {\r\n\tDirectionalShadowShader,\r\n\tDirectionalShadow\r\n}","import { normalizeColor } from \"@/modules\"\r\nimport { Camera } from \"./camera\"\r\nimport { Vector3 } from \"./math\"\r\nimport { ModelShader } from \"./model\"\r\n\r\nexport default class Light {\r\n    constructor(p:Vector3) {\r\n        this.lightPosition = p\r\n        this.specularFactor = 1\r\n        this.lightColor = normalizeColor({red:195, green:210, blue:190})\r\n        this.ambientLightColor = normalizeColor({red:25.5, green:25.5, blue:25.5})\r\n        this.specularColor = normalizeColor({red:195, green:210, blue:190})\r\n        this.shininess = 500\r\n        this.specularFactor = 1\r\n    }\r\n\r\n    lightPosition: Vector3\r\n    lightColor: Float32Array\r\n    ambientLightColor: Float32Array\r\n    specularColor: Float32Array\r\n    shininess: number\r\n    specularFactor: number\r\n\r\n    setUniforms(gl:WebGLRenderingContext, program:ModelShader, camera:Camera): void {\r\n        gl.uniform3fv(program.lightPositionLoc, [this.lightPosition.x, this.lightPosition.y, this.lightPosition.z]);\r\n        gl.uniform4fv(program.lightColorLoc, this.lightColor);\r\n        gl.uniform4fv(program.ambientLightColorLoc, this.ambientLightColor)\r\n        gl.uniform4fv(program.specularColorLoc, this.specularColor);\r\n        gl.uniform3fv(program.cameraPositionLoc, camera.transform.position.getFloatArray());\r\n        gl.uniform1f(program.shininessLoc, this.shininess);\r\n        gl.uniform1f(program.specularFactorLoc, this.specularFactor);\r\n    }\r\n\r\n}","import Geometry from '../../geometry';\r\nimport Vbuffer from '../../vbuffer';\r\nimport ShaderProgram from '../../shaderProgram';\r\nimport { MeshData } from '@/entities';\r\nimport { GLSetttings } from '@/modules';\r\nimport { Camera } from '../../camera';\r\n\r\nclass InfiniteGridShader{\r\n\tconstructor(gl: WebGLRenderingContext, camera:Camera, lightViewCamera:Camera){\t\r\n\t\tconst vertexShader = `#version 300 es\r\n            layout(location=5) in vec3 a_position;\r\n\r\n\t\t\tuniform mat4 u_mVMatrix;\r\n\t\t\tuniform mat4 u_cameraViewMatrix;\r\n\t\t\tuniform mat4 u_pMatrix;\r\n\r\n\t\t\tvec3 unprojectPoint(float x, float y, float z, mat4 view, mat4 projection) {\r\n                mat4 viewInv = inverse(view);\r\n                mat4 projInv = inverse(projection);\r\n                vec4 unprojectedPoint =  viewInv * projInv * vec4(x, y, z, 1.0);\r\n                return unprojectedPoint.xyz / unprojectedPoint.w;\r\n            }\r\n\r\n\t\t\tout vec3 nearPoint;\r\n\t\t\tout vec3 farPoint;\r\n\t\t\tout mat4 fragView;\r\n            out mat4 fragProj;\r\n\r\n\t\t\tout vec3 vertexPosition;\r\n\r\n\t\t\tvoid main(void){\r\n\t\t\t\tvec3 p = a_position;\r\n\r\n\t\t\t\tfragView = u_cameraViewMatrix;\r\n                fragProj = u_pMatrix;\r\n\t\t\t\tnearPoint = unprojectPoint(p.x, p.y, 0.0, u_cameraViewMatrix, u_pMatrix).xyz;\r\n\t\t\t\tfarPoint = unprojectPoint(p.x, p.y, 1.0, u_cameraViewMatrix, u_pMatrix).xyz;\r\n\r\n\t\t\t\tvertexPosition = p.xyz;\r\n\t\t\t\tgl_Position = vec4(p, 1.0);\r\n\r\n\t\t\t}`;\r\n\r\n\t\tconst fragmentShader = `#version 300 es\r\n\t\t\tprecision highp float;\r\n\r\n\t\t\tin vec3 vertexPosition;\r\n\t\t\tin vec3 nearPoint;\r\n            in vec3 farPoint;\r\n            in mat4 fragView;\r\n            in mat4 fragProj;\r\n\r\n\t\t\t// computes Z-buffer depth value, and converts the range.\r\n\t\t\tfloat computeDepth(vec3 pos) {\r\n\t\t\t\t// get the clip-space coordinates\r\n\t\t\t\tvec4 clip_space_pos = fragProj * fragView * vec4(pos.xyz, 1.0);\r\n\r\n\t\t\t\t// get the depth value in normalized device coordinates\r\n\t\t\t\tfloat clip_space_depth = clip_space_pos.z / clip_space_pos.w;\r\n\r\n\t\t\t\t// and compute the range based on gl_DepthRange settings (not necessary with default settings, but left for completeness)\r\n\t\t\t\tfloat far = gl_DepthRange.far;\r\n\t\t\t\tfloat near = gl_DepthRange.near;\r\n\r\n\t\t\t\tfloat depth = (((far-near) * clip_space_depth) + near + far) / 2.0;\r\n\r\n\t\t\t\t// and return the result\r\n\t\t\t\treturn depth;\r\n\t\t\t}\r\n\r\n\t\t\tfloat checkerboard(vec2 R, float scale) {\r\n\t\t\t\treturn float((\r\n\t\t\t\t\tint(floor(R.x / scale)) +\r\n\t\t\t\t\tint(floor(R.y / scale))\r\n\t\t\t\t) % 2);\r\n\t\t\t}\r\n\r\n            out vec4 finalColor;\r\n\r\n\t\t\tvoid main(void){\r\n\r\n                float t = -nearPoint.y / (farPoint.y - nearPoint.y);\r\n                vec3 fragPos3D = nearPoint + t * (farPoint - nearPoint);\r\n\t\r\n\t\t\t\tfloat isIntersect = (t > 0.0) ? 1.0 : 0.0;\r\n\t\t\t\tfloat gridPattern = (checkerboard(fragPos3D.xz, 1.0) * 0.3) + (checkerboard(fragPos3D.xz, 10.0) * 0.2) + (checkerboard(fragPos3D.xz, 100.0) * 0.1) + 0.1;\r\n\r\n\t\t\t\tfloat linearFieldSection = 0.02 * length(fragPos3D.xz);\r\n\t\t\t\tfloat fading = min(1.0, 1.5 - linearFieldSection);\r\n\r\n\t\t\t\tvec4 outColor = vec4(vec3((gridPattern/2.0) + 0.3), 1.0);\r\n\r\n\t\t\t\tfinalColor = outColor * isIntersect;\r\n\t\t\t\tfinalColor *= fading;\r\n\r\n\t\t\t\tgl_FragDepth = computeDepth(fragPos3D);\r\n            }`;\t\t\t\t\t\t\t\t\t\t\r\n\r\n\t\tconst shaderProgram = new ShaderProgram(gl, vertexShader, fragmentShader);\r\n\r\n\t\tshaderProgram.activateShader()\r\n\r\n\t\tthis.positionLoc = gl.getAttribLocation(shaderProgram.program as WebGLProgram, GLSetttings.ATTR_POSITION_NAME)\r\n\r\n\t\tthis.modelViewMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_MODEL_MAT) as WebGLUniformLocation\r\n\t\tthis.perspectiveMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_PERSPECTIV_MAT) as WebGLUniformLocation\r\n\t\tthis.cameraMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_CAMERA_MAT) as WebGLUniformLocation\r\n\t\tthis.uColorLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_COLOR) as WebGLUniformLocation\r\n\t\t//Cleanup\r\n\t\tshaderProgram.deactivateShader()\r\n\r\n\t\tthis.perspectiveProjectionMatrix = camera.perspectiveProjection\r\n\t\tthis.orthoProjectionMatrix = camera.orthoProjection\r\n\t\tthis.viewModelMatrix = camera.viewMatrix\r\n\t\tthis.lightViewModelMatrix = lightViewCamera\r\n\t\tthis.shaderProgram = shaderProgram\r\n\t}\r\n\r\n\tpositionLoc: number\r\n  \r\n\tmodelViewMatrixLoc: WebGLUniformLocation\r\n\tperspectiveMatrixLoc: WebGLUniformLocation\r\n\tcameraMatrixLoc: WebGLUniformLocation\r\n\r\n\tuColorLoc: WebGLUniformLocation\r\n\r\n\tperspectiveProjectionMatrix: Float32Array\r\n\torthoProjectionMatrix:Float32Array\r\n\tviewModelMatrix:Float32Array\r\n\r\n\tlightViewModelMatrix:Camera\r\n\r\n\tshaderProgram: ShaderProgram\r\n\r\n\t\r\n\tsetUniforms(gl:WebGLRenderingContext, model: Geometry) {\r\n\t\tthis.shaderProgram.activateShader()\r\n\r\n\t\tgl.uniformMatrix4fv(this.perspectiveMatrixLoc, false, this.perspectiveProjectionMatrix)\r\n\t\tgl.uniformMatrix4fv(this.cameraMatrixLoc , false, this.viewModelMatrix)\r\n\t\tgl.uniformMatrix4fv(this.modelViewMatrixLoc, false, model.transform.getModelMatrix())\r\n\r\n\t\treturn this\r\n    }\r\n}\r\n\r\n\r\nclass InfiniteGrid {\r\n\r\n  \tconstructor() {}\r\n\r\n   \tstatic async createGeometry(gl: WebGLRenderingContext, shaderProgram: InfiniteGridShader){ \r\n    \treturn  new Geometry( await InfiniteGrid.createMesh(gl, shaderProgram)); \r\n  \t}\r\n\r\n   static async createMesh(gl: WebGLRenderingContext, shaderProgram: InfiniteGridShader) {\r\n\r\n\t\tconst verts = [\r\n\t\t\t1,-1,0,\r\n\t\t\t1,1,0,\r\n\t\t\t-1,-1,0,\r\n\t\t\t-1,1,0,\r\n\t\t\t-1,-1,0,\r\n\t\t\t1,1,0,\r\n\t\t]\r\n\r\n\t\tconst vertexCount = verts.length/3;\r\n\t\tconst strideLen = Float32Array.BYTES_PER_ELEMENT * 3; //Stride Length is the Vertex Size for the buffer in Bytes\r\n\t\tconst mesh: MeshData = {\r\n\t\t\tpositions : new Vbuffer(gl, verts, vertexCount, GLSetttings.BUFFER_TYPE_VERTICES),\r\n\t\t\tdrawMode : gl.TRIANGLES,\r\n\t\t\tvertexCount,\r\n\t\t}\r\n\r\n\t\tmesh.positions?.bindToAttribute(shaderProgram.positionLoc as number, strideLen, GLSetttings.DEFAULT_OFFSET, GLSetttings.GRID_VECTOR_SIZE);\r\n\r\n\t\treturn mesh;\r\n  \t}\r\n}\r\n\r\nexport {\r\n\tInfiniteGridShader,\r\n\tInfiniteGrid\r\n}","import { ProgramEntrySettings } from '@/modules'\r\nimport GLContext from './core/glContext'\r\nimport { Camera, CameraController }  from './core/camera'\r\nimport { Model, ModelShader } from './core/model'\r\nimport { DirectionalShadow, DirectionalShadowShader } from './core/shadows/directional'\r\nimport Light from './core/light'\r\nimport DepthTexture from './core/Textures/depthTexture'\r\nimport { Vector3 } from './core/math'\r\nimport { InfiniteGrid, InfiniteGridShader } from './core/primitives/grid/infinite'\r\n\r\n\r\n(async()=>{\r\n    const glContext = new GLContext(ProgramEntrySettings.WEBGL_CANVAS_ID)\r\n    glContext.fitScreen(0.95, 0.90).setClearColor(13, 17, 23, 1.0).clear()\r\n    const gl = glContext.getContext() as WebGLRenderingContext\r\n\r\n    const lightPosition = new Vector3(1.5, 2.5, 3)\r\n    const light = new Light(lightPosition)\r\n    const lightView = new Camera(gl as WebGLRenderingContext)\r\n    lightView.transform.position.set(lightPosition.x, lightPosition.y, lightPosition.z)\r\n\r\n    const directionalShadowShader = new DirectionalShadowShader(gl as WebGLRenderingContext, lightView)\r\n    const directionalShadow = await DirectionalShadow.createGeometry(gl, directionalShadowShader, ProgramEntrySettings.PATH_ASSETS_OBJ)\r\n    \r\n    const camera = new Camera(gl as WebGLRenderingContext)\r\n    camera.transform.position.set(0, 0.5, 1.5)\r\n    new CameraController(gl as WebGLRenderingContext, camera)\r\n\r\n    const infiniteGridShader = new InfiniteGridShader(gl as WebGLRenderingContext, camera, lightView)\r\n    const infiniteGrid = await InfiniteGrid.createGeometry(gl, infiniteGridShader)\r\n\r\n    const modelShader = new ModelShader(gl as WebGLRenderingContext, camera, lightView)\r\n    const model = await Model.createGeometry(gl, modelShader, ProgramEntrySettings.PATH_ASSETS_OBJ, ProgramEntrySettings.PATH_ASSETS_TEXTURE)\r\n    model.setScale(0.0035,0.0035,0.0035).setRotation(0,30,0)\r\n\r\n    const loop = () => {\r\n        \r\n        glContext.depthRender(directionalShadow.mesh.depth as DepthTexture)\r\n\r\n        lightView.updateViewMatrix()\r\n        directionalShadowShader.setUniforms(gl, directionalShadow.preRender()).shaderProgram\r\n            .renderModel(directionalShadow.preRender() )\r\n    \r\n        glContext.clearFramebuffer().fitScreen(0.95, 0.90).clear()\r\n\r\n        camera.updateViewMatrix()\r\n\r\n        infiniteGridShader.setUniforms(gl, infiniteGrid.preRender()).shaderProgram\r\n            .renderModel(infiniteGrid.preRender())\r\n\r\n        modelShader.setUniforms(gl, model.preRender())\r\n            .shaderProgram.renderModel(model.preRender())\r\n\r\n        light.setUniforms(gl, modelShader, camera)\r\n\r\n        requestAnimationFrame(loop)\r\n    }\r\n    loop()\r\n})()"],"sourceRoot":""}