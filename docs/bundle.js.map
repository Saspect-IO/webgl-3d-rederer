{"version":3,"sources":["webpack://qrius-engine-webgl/webpack/bootstrap","webpack://qrius-engine-webgl/./node_modules/tslib/tslib.es6.js","webpack://qrius-engine-webgl/webpack/runtime/global","webpack://qrius-engine-webgl/webpack/runtime/publicPath","webpack://qrius-engine-webgl/./src/assets/resources/formula_1/source/formula_1.obj","webpack://qrius-engine-webgl/./src/assets/resources/formula_1/textures/formula_1.png","webpack://qrius-engine-webgl/./src/modules/global_constants.ts","webpack://qrius-engine-webgl/./src/modules/utils.ts","webpack://qrius-engine-webgl/./src/core/math.ts","webpack://qrius-engine-webgl/./src/core/transformation.ts","webpack://qrius-engine-webgl/./src/core/camera.ts","webpack://qrius-engine-webgl/./src/core/glContext.ts","webpack://qrius-engine-webgl/./src/core/light.ts","webpack://qrius-engine-webgl/./src/core/shaderProgram.ts","webpack://qrius-engine-webgl/./src/core/geometry.ts","webpack://qrius-engine-webgl/./src/core/vbuffer.ts","webpack://qrius-engine-webgl/./src/core/shadows/directional.ts","webpack://qrius-engine-webgl/./src/core/primitives/grid/infinite.ts","webpack://qrius-engine-webgl/./src/core/model.ts","webpack://qrius-engine-webgl/./src/core/objLoader.ts","webpack://qrius-engine-webgl/./src/core/Textures/texture.ts","webpack://qrius-engine-webgl/./src/main.ts"],"names":["__webpack_require__","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","this","n","v","op","TypeError","call","pop","length","push","globalThis","Function","window","scriptUrl","importScripts","location","document","currentScript","src","scripts","getElementsByTagName","Error","replace","p","ProgramEntrySettings","CameraSettings","CameraControlsSettings","GLSetttings","ObjTypes","SPACE","SurfaceStruct","vertices","VertexStruct","position","normal","uv","Vec3Struct","x","z","degToRad","d","Math","PI","normalizeColor","rgb","red","green","blue","Float32Array","magnitude","undefined","sqrt","normalize","mag","set","multiScalar","getArray","getFloatArray","clone","Vector3","matrix","Matrix4","identity","vtranslate","translate","rotateY","rad","rotateX","rotateZ","vscale","vec3","scale","invert","resetRotation","i","resetMat","a","perspective","out","fovy","aspect","near","far","tan","nf","ortho","left","right","bottom","top","lr","bt","lookAt","cameraPosition","target","up","dst","zAxis","subtractVectors","xAxis","cross","yAxis","b","transpose","a01","a02","a03","a12","a13","a23","normalMat3","a00","a10","a11","a20","a21","a22","a30","a31","a32","a33","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","b11","det","multiplyVector","mat4","w","c1r1","c2r1","c3r1","c4r1","c1r2","c2r2","c3r2","c4r2","c1r3","c2r3","c3r3","c4r3","transformVec4","m","mult","b0","b1","b2","b3","s","sin","c","cos","rotate","axis","b12","b20","b21","b22","len","abs","mat","rotation","matView","matNormal","forward","updateMatrix","updateDirection","getModelMatrix","getNormalMatrix","reset","gl","fov","FIELD_OF_VIEW","NEAR_PLANE","FAR_PLANE","perspectiveProjection","orthoProjection","ratio","canvas","width","height","transform","viewMatrix","mode","Camera","MODE_ORBIT","panX","updateViewMatrix","panY","panZ","MODE_FREE","camera","box","getBoundingClientRect","rotateRate","ROTATION_RATE","panRate","PAN_RATE","zoomRate","ZOOM_RATE","offsetX","offsetY","initX","initY","prevX","prevY","onUpHandler","onMouseUp","onMoveHandler","onMouseMove","addEventListener","MOUSE_DOWN","onMouseDown","MOUSE_WHEEL","onMouseWheel","getMouseVec2","pageX","pageY","MOUSE_UP","MOUSE_MOVE","removeEventListener","delta","max","min","wheelDelta","detail","dx","dy","shiftKey","WEBGL_CANVAS_ID","rgb_32_bit","alpha","getElementById","getContext","WEBGL_CONTEXT","alert","WEBGL_CONTEXT_ERROR_MESSAGE","cullFace","BACK","frontFace","CCW","enable","DEPTH_TEST","CULL_FACE","depthFunc","LEQUAL","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","setSize","h","style","viewport","depthRender","depthTexture","bindFramebuffer","FRAMEBUFFER","depthFramebuffer","depthTextureSize","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","fitScreen","wp","hp","innerWidth","innerHeight","setClearColor","clearColor","clearFramebuffer","lightPosition","lightColor","ambientLightColor","specularColor","specularFactor","shininess","setUniforms","program","uniform3fv","lightPositionLoc","uniform4fv","lightColorLoc","ambientLightColorLoc","specularColorLoc","uniform1f","specularFactorLoc","shininessLoc","vsSource","fsSource","vertexShader","fragmentShader","createShader","VERTEX_SHADER","FRAGMENT_SHADER","shaderProgram","createShaderProgram","type","source","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","console","error","getShaderInfoLog","deleteShader","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","detachShader","activateShader","useProgram","deactivateShader","dispose","getParameter","CURRENT_PROGRAM","renderModel","model","mesh","noCulling","disable","doBlending","BLEND","drawArrays","drawMode","vertexCount","setScale","setPosition","setRotation","addScale","addPosition","addRotation","preRender","data","count","buffer","createBuffer","BUFFER_TYPE_ARRAY","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","BUFFER_TYPE_ELEMENT_ARRAY","ELEMENT_ARRAY_BUFFER","Uint16Array","size","destroy","deleteBuffer","bindToAttribute","stride","offset","BUFFER_TYPE_VERTICES","enableVertexAttribArray","vertexAttribPointer","FLOAT","positionLoc","getAttribLocation","ATTR_POSITION_NAME","modelViewMatrixLoc","getUniformLocation","UNI_MODEL_MAT","orthoMatrixLoc","UNI_ORTHO_MAT","cameraMatrixLoc","UNI_CAMERA_MAT","uColorLoc","UNI_COLOR","orthoProjectionMatrix","viewModelMatrix","uniformMatrix4fv","createGeometry","DirectionalShadow","createMesh","positions","TRIANGLES","DEFAULT_STRIDE","DEFAULT_OFFSET","lightViewCamera","perspectiveMatrixLoc","UNI_PERSPECTIV_MAT","perspectiveProjectionMatrix","lightViewModelMatrix","InfiniteGrid","verts","strideLen","BYTES_PER_ELEMENT","GRID_VECTOR_SIZE","sceneViewCamera","lightViewMatrix","texCoordLoc","ATTR_UV_NAME","normalLoc","ATTR_NORMAL_NAME","projectedTextureLoc","UNI_PROJECTED_TEXTURE","textureMatrixLoc","UNI_TEXTURE_MAT","reverseLightDirectionLoc","UNI_REVERSE_LIGHT_DIRECTION_MAT","diffuseLoc","UNI_DIFFUSE","UNI_LIGHT_AMBIENT","UNI_LIGHT_POSITION","cameraPositionLoc","UNI_CAMERA_POSITION","UNI_CAMERA_SHININESS","UNI_LIGHT_COLOR","UNI_SPECULAR_COLOR","UNI_SPECULAR_FACTOR","getLightWorldMatrix","getTextureMatrix","slice","lightWorldMatrix","textureMatrix","inverted","texture","Model","normals","uvs","surfaces","parseOBJ","POSITION","V","NORMAL","VN","UV","VT","SURFACE","F","lines","split","item","lineItems","trim","parseFloat","isQuad","shouldExit","part","parseInt","triagle1","triangle2","ObjLoader","loadOBJ","url","fetch","text","all","forEach","surface","vertex","image","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_MIN_FILTER","LINEAR_MIPMAP_LINEAR","TEXTURE_MAG_FILTER","LINEAR","generateMipmap","loadTexture","Image","decode","Texture","glContext","wh","lightViewPosition","lightView","lightCameraView","PATH_ASSETS_OBJ","PATH_ASSETS_TEXTURE","directionalShadowShader","DirectionalShadowShader","directionalShadow","CameraController","infiniteGridShader","InfiniteGridShader","infiniteGrid","modelShader","ModelShader","loop","requestAnimationFrame"],"mappings":"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","file":"bundle.js","sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) scriptUrl = scripts[scripts.length - 1].src\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","export default __webpack_public_path__ + \"assets/resources/formula_1/sources/formula_1.obj\";","export default __webpack_public_path__ + \"assets/resources/formula_1/textures/formula_1.png\";","import obj from 'assets/resources/formula_1/source/formula_1.obj';\r\nimport texture from 'assets/resources/formula_1/textures/formula_1.png';\r\n\r\nexport const TEXTURE = 'TEXTURE'\r\nexport const PATH_ASSETS_OBJ = obj\r\nexport const PATH_ASSETS_TEXTURE = texture\r\nexport const NEW_LINE = '\\n'\r\nexport const BACKSLASH = '/'\r\nexport const SPACE = /\\s+/\r\n\r\nexport enum ProgramEntrySettings {\r\n    WEBGL_CANVAS_ID = 'qrius-glCanvas',\r\n    WEBGL_CONTEXT = 'webgl2',\r\n    WEBGL_CONTEXT_EXPERIMENTAL = 'experimental-webgl',\r\n    WEBGL_CONTEXT_WEBKIT = 'webkit-3d',\r\n    WEBGL_CONTEXT_MOZ = 'moz-webgl',\r\n    WEBGL_DEPTH_TEXTURE = 'WEBGL_depth_texture',\r\n    WEBGL_CONTEXT_ERROR_MESSAGE = 'Could not initialise WebGL',\r\n    WEBGL_DEPTH_TEXTUR_ERROR_MESSAGE = 'need WEBGL_depth_texture',\r\n    PATH_ASSETS_OBJ = '/webgl-3d-renderer/assets/resources/formula_1/source/formula_1.obj',\r\n    PATH_ASSETS_TEXTURE = '/webgl-3d-renderer/assets/resources/formula_1/textures/formula_1.png',\r\n    DEPTH_TEXTURE_SIZE = 512,\r\n}\r\n\r\nexport enum CameraSettings {\r\n    NEAR_PLANE = 0.1,\r\n    FAR_PLANE = 100.0,\r\n    FIELD_OF_VIEW = 45,\r\n    MODE_FREE = 0,\r\n    MODE_ORBIT = 1,\r\n}\r\n\r\nexport enum CameraControlsSettings {\r\n    KEY_DOWN_EVENT = 'keydown',\r\n    KEY_UP_EVENT = 'keyup',\r\n    KEY_DOWN = 40,\r\n    KEY_UP = 38,\r\n    KEY_LEFT = 37,\r\n    KEY_RIGHT = 39,\r\n    MOUSE_UP = 'mouseup',\r\n    MOUSE_DOWN = 'mousedown',\r\n    MOUSE_WHEEL = 'mousewheel',\r\n    MOUSE_MOVE = 'mousemove',\r\n    ROTATION_RATE = -300,\r\n    PAN_RATE = 5,\r\n    ZOOM_RATE = 200,\r\n}\r\n\r\nexport enum GLSetttings {\r\n    DEFAULT_OFFSET = 0,\r\n    DEFAULT_STRIDE = 0,\r\n    GRID_VECTOR_SIZE = 3,\r\n    GRID_VERTEX_LEN = 4,\r\n    ATTR_POSITION_NAME = \"a_position\",\r\n    ATTR_NORMAL_NAME = \"a_norm\",\r\n    ATTR_UV_NAME = \"a_texCoord\",\r\n    UNI_COLOR = 'u_color',\r\n    UNI_MODEL_MAT ='u_mVMatrix',\r\n    UNI_PERSPECTIV_MAT = 'u_pMatrix',\r\n    UNI_ORTHO_MAT = 'u_oMatrix',\r\n    UNI_CAMERA_MAT = 'u_cameraViewMatrix',\r\n    UNI_LIGHT_VIEW_CAMERA_MAT = 'u_lightViewCameraMatrix',\r\n    UNI_REVERSE_LIGHT_DIRECTION_MAT = 'u_reverseLightDirection',\r\n    UNI_TEXTURE_MAT = 'u_textureMatrix',\r\n    UNI_DIFFUSE = 'u_diffuse',\r\n    UNI_PROJECTED_TEXTURE = 'u_projectedTexture',\r\n    UNI_LIGHT_AMBIENT = 'u_ambientLightColor',\r\n    UNI_LIGHT_DIRECTION = 'u_lightDirection',\r\n    UNI_LIGHT_POSITION = 'u_lightPosition',\r\n    UNI_CAMERA_POSITION = 'u_cameraPosition',\r\n    UNI_CAMERA_SHININESS = 'u_shininess',\r\n    UNI_LIGHT_COLOR = 'u_lightColor',\r\n    UNI_SPECULAR_COLOR = 'u_specularColor',\r\n    UNI_SPECULAR_FACTOR = 'u_specularFactor',\r\n    BUFFER_TYPE_ELEMENT_ARRAY = 'array_elements',\r\n    BUFFER_TYPE_ARRAY = 'arrays',\r\n}\r\n\r\nexport enum ObjTypes {\r\n    V = 'v',\r\n    VN = 'vn',\r\n    VT = 'vt',\r\n    F = 'f',\r\n}\r\n","import { Normal, UV, Vector, Vertex } from \"@/entities\";\r\n\r\nexport const SurfaceStruct = (vertices: Array < Vertex > ) => ({ vertices })\r\nexport const VertexStruct = (position: Vector, normal: Normal, uv: UV) => ({ position, normal, uv })\r\nexport const Vec3Struct = (x: number, y: number, z: number) => ({ x, y, z })\r\nexport const Vec2Struct = (x: number, y: number) => ({ x, y })\r\nexport const radToDeg = (r: number) => r * 180 / Math.PI\r\nexport const degToRad = (d: number) => d * Math.PI / 180\r\nexport const loadShaders = async (vsSource: string, fsSource: string) => {\r\n\r\n    const loadFile = async (src: string) => {\r\n        const response = await fetch(src)\r\n        const data = await response.text()\r\n        return data\r\n    }\r\n\r\n    const [vertexShaderFile, fragmentShaderFile] = await Promise.all([loadFile(vsSource), loadFile(fsSource)])\r\n\r\n    return {\r\n        vertexShaderFile,\r\n        fragmentShaderFile\r\n    };\r\n}\r\n\r\nexport const mapValues = (x: number, xMin: number, xMax: number, zMin: number, zMax: number) => ( ((x-xMin)/(xMax-xMin)) * ((zMax-zMin)+zMin) )\r\n\r\nexport const normalizeColor = (rgb:{red: number, green: number, blue: number})=>{\r\n    const alpha = 1\r\n    const rgb_32_bit = 255\r\n\r\n    const result=[(rgb.red/rgb_32_bit), (rgb.green/rgb_32_bit), (rgb.blue/rgb_32_bit), alpha]\r\n    return new Float32Array(result)\r\n\r\n}\r\n","//###########################################################################################\r\nimport { Vector } from \"@/entities\";\r\n\r\n\r\n//https://github.com/sketchpunk/FunWithWebGL2/tree/master/lesson_006\r\nclass Vector3 {\r\n    constructor(x: number, y: number, z: number) {\r\n        this.x = x || 0.0;\r\n        this.y = y || 0.0;\r\n        this.z = z || 0.0;\r\n    }\r\n\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n\r\n    magnitude(v: Vector = {\r\n        x: 0.0,\r\n        y: 0.0,\r\n        z: 0.0\r\n    }) {\r\n        //Only get the magnitude of this vector\r\n        if (v === undefined) return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\r\n\r\n        //Get magnitude based on another vector\r\n        let x = v.x - this.x,\r\n            y = v.y - this.y,\r\n            z = v.y - this.z;\r\n\r\n        return Math.sqrt(x * x + y * y + z * z);\r\n    }\r\n\r\n    normalize() {\r\n        let mag = this.magnitude();\r\n        this.x /= mag;\r\n        this.y /= mag;\r\n        this.z /= mag;\r\n        return this;\r\n    }\r\n\r\n    set(x: number, y: number, z: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        return this;\r\n    }\r\n\r\n    multiScalar(v: number) {\r\n        this.x *= v;\r\n        this.y *= v;\r\n        this.z *= v;\r\n        return this;\r\n    }\r\n\r\n    getArray() {\r\n        return [this.x, this.y, this.z];\r\n    }\r\n\r\n    getFloatArray() {\r\n        return new Float32Array([this.x, this.y, this.z]);\r\n    }\r\n\r\n    clone() {\r\n        return new Vector3(this.x, this.y, this.z);\r\n    }\r\n}\r\n\r\n\r\n//###########################################################################################\r\nclass Matrix4 {\r\n    constructor() {\r\n        this.matrix = Matrix4.identity();\r\n    }\r\n\r\n    matrix: Float32Array;\r\n\r\n    //....................................................................\r\n    //Transformations Methods\r\n    vtranslate(v: Vector) {\r\n        Matrix4.translate(this.matrix, v.x, v.y, v.z);\r\n        return this;\r\n    }\r\n    translate(x: number, y: number, z: number) {\r\n        Matrix4.translate(this.matrix, x, y, z);\r\n        return this;\r\n    }\r\n\r\n    rotateY(rad: number) {\r\n        Matrix4.rotateY(this.matrix, rad);\r\n        return this;\r\n    }\r\n    rotateX(rad: number) {\r\n        Matrix4.rotateX(this.matrix, rad);\r\n        return this;\r\n    }\r\n    rotateZ(rad: number) {\r\n        Matrix4.rotateZ(this.matrix, rad);\r\n        return this;\r\n    }\r\n\r\n    vscale(vec3: Vector) {\r\n        Matrix4.scale(this.matrix, vec3.x, vec3.y, vec3.z);\r\n        return this;\r\n    }\r\n    scale(x: number, y: number, z: number) {\r\n        Matrix4.scale(this.matrix, x, y, z);\r\n        return this;\r\n    }\r\n\r\n    invert() {\r\n        Matrix4.invert(this.matrix);\r\n        return this;\r\n    }\r\n\r\n    //....................................................................\r\n    //Methods\r\n    //Bring is back to identity without changing the transform values.\r\n    resetRotation() {\r\n        for (let i = 0; i < this.matrix.length; i++) {\r\n            if (i >= 12 && i <= 14) continue;\r\n            this.matrix[i] = (i % 5 == 0) ? 1 : 0; //only positions 0,5,10,15 need to be 1 else 0.\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    //reset data back to identity.\r\n    resetMat() {\r\n        for (let i = 0; i < this.matrix.length; i++) this.matrix[i] = (i % 5 == 0) ? 1 : 0; //only positions 0,5,10,15 need to be 1 else 0.\r\n        return this;\r\n    }\r\n\r\n    //....................................................................\r\n    //Static Data Methods\r\n    static identity() {\r\n        let a = new Float32Array(16);\r\n        a[0] = a[5] = a[10] = a[15] = 1;\r\n        return a;\r\n    }\r\n\r\n    //from glMatrix\r\n    static perspective(out: Float32Array, fovy: number, aspect: number, near: number, far: number) {\r\n        let f = 1.0 / Math.tan(fovy / 2),\r\n            nf = 1 / (near - far);\r\n        out[0] = f / aspect;\r\n        out[1] = 0;\r\n        out[2] = 0;\r\n        out[3] = 0;\r\n        out[4] = 0;\r\n        out[5] = f;\r\n        out[6] = 0;\r\n        out[7] = 0;\r\n        out[8] = 0;\r\n        out[9] = 0;\r\n        out[10] = (far + near) * nf;\r\n        out[11] = -1;\r\n        out[12] = 0;\r\n        out[13] = 0;\r\n        out[14] = (2 * far * near) * nf;\r\n        out[15] = 0;\r\n    }\r\n\r\n\r\n    static ortho(out: Float32Array, left: number, right: number, bottom: number, top: number, near: number, far: number) {\r\n        let lr = 1 / (left - right),\r\n            bt = 1 / (bottom - top),\r\n            nf = 1 / (near - far);\r\n        out[0] = -2 * lr;\r\n        out[1] = 0;\r\n        out[2] = 0;\r\n        out[3] = 0;\r\n        out[4] = 0;\r\n        out[5] = -2 * bt;\r\n        out[6] = 0;\r\n        out[7] = 0;\r\n        out[8] = 0;\r\n        out[9] = 0;\r\n        out[10] = 2 * nf;\r\n        out[11] = 0;\r\n        out[12] = (left + right) * lr;\r\n        out[13] = (top + bottom) * bt;\r\n        out[14] = (far + near) * nf;\r\n        out[15] = 1;\r\n    };\r\n\r\n\r\n     /**\r\n   * Creates a lookAt matrix.\r\n   * This is a world matrix for a camera. In other words it will transform\r\n   * from the origin to a place and orientation in the world. For a view\r\n   * matrix take the inverse of this.\r\n   * @param {Float32Array} cameraPosition position of the camera\r\n   * @param {Vector3} target position of the target\r\n   * @param {Vector3} up direction\r\n   * @param {Float32Array} [dst] optional matrix to store result\r\n   * @return {Float32Array} dst or a new matrix if none provided\r\n   * @memberOf module:webgl-3d-math\r\n   */\r\n    static lookAt(cameraPosition: any, target:any, up:any, dst:any=null) {\r\n        dst = dst || new Float32Array(16);\r\n        var zAxis = Matrix4.normalize(Matrix4.subtractVectors(cameraPosition, target));\r\n        var xAxis = Matrix4.normalize(Matrix4.cross(up, zAxis));\r\n        var yAxis = Matrix4.normalize(Matrix4.cross(zAxis, xAxis));\r\n\r\n        dst[ 0] = xAxis[0];\r\n        dst[ 1] = xAxis[1];\r\n        dst[ 2] = xAxis[2];\r\n        dst[ 3] = 0;\r\n        dst[ 4] = yAxis[0];\r\n        dst[ 5] = yAxis[1];\r\n        dst[ 6] = yAxis[2];\r\n        dst[ 7] = 0;\r\n        dst[ 8] = zAxis[0];\r\n        dst[ 9] = zAxis[1];\r\n        dst[10] = zAxis[2];\r\n        dst[11] = 0;\r\n        dst[12] = cameraPosition[0];\r\n        dst[13] = cameraPosition[1];\r\n        dst[14] = cameraPosition[2];\r\n        dst[15] = 1;\r\n\r\n        return dst;\r\n    }\r\n\r\n    static subtractVectors(a:any, b:any, dst:any=null) {\r\n        dst = dst || new Float32Array(3);\r\n        dst[0] = a[0] - b[0];\r\n        dst[1] = a[1] - b[1];\r\n        dst[2] = a[2] - b[2];\r\n        return dst;\r\n    }\r\n\r\n    static cross(a:any, b:any, dst:any=null) {\r\n        dst = dst || new Float32Array(3);\r\n        dst[0] = a[1] * b[2] - a[2] * b[1];\r\n        dst[1] = a[2] * b[0] - a[0] * b[2];\r\n        dst[2] = a[0] * b[1] - a[1] * b[0];\r\n        return dst;\r\n    }\r\n\r\n    static normalize(v:any, dst:any=null) {\r\n        dst = dst || new Float32Array(3);\r\n        var length = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\r\n        // make sure we don't divide by 0.\r\n        if (length > 0.00001) {\r\n            dst[0] = v[0] / length;\r\n            dst[1] = v[1] / length;\r\n            dst[2] = v[2] / length;\r\n        }\r\n        return dst;\r\n    }\r\n\r\n\r\n    //https://github.com/toji/gl-matrix/blob/master/src/gl-matrix/mat4.js\r\n    //make the rows into the columns\r\n    static transpose(out: Float32Array, a: Float32Array) {\r\n        //If we are transposing ourselves we can skip a few steps but have to cache some values\r\n        if (out === a) {\r\n            let a01 = a[1],\r\n                a02 = a[2],\r\n                a03 = a[3],\r\n                a12 = a[6],\r\n                a13 = a[7],\r\n                a23 = a[11];\r\n            out[1] = a[4];\r\n            out[2] = a[8];\r\n            out[3] = a[12];\r\n            out[4] = a01;\r\n            out[6] = a[9];\r\n            out[7] = a[13];\r\n            out[8] = a02;\r\n            out[9] = a12;\r\n            out[11] = a[14];\r\n            out[12] = a03;\r\n            out[13] = a13;\r\n            out[14] = a23;\r\n        } else {\r\n            out[0] = a[0];\r\n            out[1] = a[4];\r\n            out[2] = a[8];\r\n            out[3] = a[12];\r\n            out[4] = a[1];\r\n            out[5] = a[5];\r\n            out[6] = a[9];\r\n            out[7] = a[13];\r\n            out[8] = a[2];\r\n            out[9] = a[6];\r\n            out[10] = a[10];\r\n            out[11] = a[14];\r\n            out[12] = a[3];\r\n            out[13] = a[7];\r\n            out[14] = a[11];\r\n            out[15] = a[15];\r\n        }\r\n\r\n        return out;\r\n    }\r\n\r\n    //Calculates a 3x3 normal matrix (transpose inverse) from the 4x4 matrix\r\n    static normalMat3(out: Float32Array, a: Float32Array) {\r\n        let a00 = a[0],\r\n            a01 = a[1],\r\n            a02 = a[2],\r\n            a03 = a[3],\r\n            a10 = a[4],\r\n            a11 = a[5],\r\n            a12 = a[6],\r\n            a13 = a[7],\r\n            a20 = a[8],\r\n            a21 = a[9],\r\n            a22 = a[10],\r\n            a23 = a[11],\r\n            a30 = a[12],\r\n            a31 = a[13],\r\n            a32 = a[14],\r\n            a33 = a[15],\r\n\r\n            b00 = a00 * a11 - a01 * a10,\r\n            b01 = a00 * a12 - a02 * a10,\r\n            b02 = a00 * a13 - a03 * a10,\r\n            b03 = a01 * a12 - a02 * a11,\r\n            b04 = a01 * a13 - a03 * a11,\r\n            b05 = a02 * a13 - a03 * a12,\r\n            b06 = a20 * a31 - a21 * a30,\r\n            b07 = a20 * a32 - a22 * a30,\r\n            b08 = a20 * a33 - a23 * a30,\r\n            b09 = a21 * a32 - a22 * a31,\r\n            b10 = a21 * a33 - a23 * a31,\r\n            b11 = a22 * a33 - a23 * a32,\r\n\r\n            // Calculate the determinant\r\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n        if (!det) return null;\r\n\r\n        det = 1.0 / det;\r\n\r\n        out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\r\n        out[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\r\n        out[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\r\n\r\n        out[3] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\r\n        out[4] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\r\n        out[5] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\r\n\r\n        out[6] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\r\n        out[7] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\r\n        out[8] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\r\n        return out;\r\n    }\r\n\r\n    //....................................................................\r\n    //Static Operation\r\n\r\n    //https://github.com/gregtatum/mdn-model-view-projection/blob/master/shared/matrices.js\r\n    static multiplyVector(mat4: Float32Array, v: Float32Array) {\r\n        let x = v[0],\r\n            y = v[1],\r\n            z = v[2],\r\n            w = v[3];\r\n        let c1r1 = mat4[0],\r\n            c2r1 = mat4[1],\r\n            c3r1 = mat4[2],\r\n            c4r1 = mat4[3],\r\n            c1r2 = mat4[4],\r\n            c2r2 = mat4[5],\r\n            c3r2 = mat4[6],\r\n            c4r2 = mat4[7],\r\n            c1r3 = mat4[8],\r\n            c2r3 = mat4[9],\r\n            c3r3 = mat4[10],\r\n            c4r3 = mat4[11],\r\n            c1r4 = mat4[12],\r\n            c2r4 = mat4[13],\r\n            c3r4 = mat4[14],\r\n            c4r4 = mat4[15];\r\n\r\n        return [\r\n            x * c1r1 + y * c1r2 + z * c1r3 + w * c1r4,\r\n            x * c2r1 + y * c2r2 + z * c2r3 + w * c2r4,\r\n            x * c3r1 + y * c3r2 + z * c3r3 + w * c3r4,\r\n            x * c4r1 + y * c4r2 + z * c4r3 + w * c4r4\r\n        ];\r\n    }\r\n\r\n    //https://github.com/toji/gl-matrix/blob/master/src/gl-matrix/vec4.js, vec4.transformMat4\r\n    static transformVec4(out: Float32Array, v: number[], m: Float32Array) {\r\n        out[0] = m[0] * v[0] + m[4] * v[1] + m[8] * v[2] + m[12] * v[3];\r\n        out[1] = m[1] * v[0] + m[5] * v[1] + m[9] * v[2] + m[13] * v[3];\r\n        out[2] = m[2] * v[0] + m[6] * v[1] + m[10] * v[2] + m[14] * v[3];\r\n        out[3] = m[3] * v[0] + m[7] * v[1] + m[11] * v[2] + m[15] * v[3];\r\n        return out;\r\n    }\r\n\r\n    //From glMatrix\r\n    //Multiple two mat4 together\r\n    static mult(out: Float32Array, a: Float32Array, b: Float32Array) {\r\n        let a00 = a[0],\r\n            a01 = a[1],\r\n            a02 = a[2],\r\n            a03 = a[3],\r\n            a10 = a[4],\r\n            a11 = a[5],\r\n            a12 = a[6],\r\n            a13 = a[7],\r\n            a20 = a[8],\r\n            a21 = a[9],\r\n            a22 = a[10],\r\n            a23 = a[11],\r\n            a30 = a[12],\r\n            a31 = a[13],\r\n            a32 = a[14],\r\n            a33 = a[15];\r\n\r\n        // Cache only the current line of the second matrix\r\n        let b0 = b[0],\r\n            b1 = b[1],\r\n            b2 = b[2],\r\n            b3 = b[3];\r\n        out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n        out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n        out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n        out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n        b0 = b[4];\r\n        b1 = b[5];\r\n        b2 = b[6];\r\n        b3 = b[7];\r\n        out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n        out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n        out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n        out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n        b0 = b[8];\r\n        b1 = b[9];\r\n        b2 = b[10];\r\n        b3 = b[11];\r\n        out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n        out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n        out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n        out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n        b0 = b[12];\r\n        b1 = b[13];\r\n        b2 = b[14];\r\n        b3 = b[15];\r\n        out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n        out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n        out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n        out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n        return out;\r\n    }\r\n\r\n\r\n    //....................................................................\r\n    //Static Transformation\r\n    static scale(out: Float32Array, x: number, y: number, z: number) {\r\n        out[0] *= x;\r\n        out[1] *= x;\r\n        out[2] *= x;\r\n        out[3] *= x;\r\n        out[4] *= y;\r\n        out[5] *= y;\r\n        out[6] *= y;\r\n        out[7] *= y;\r\n        out[8] *= z;\r\n        out[9] *= z;\r\n        out[10] *= z;\r\n        out[11] *= z;\r\n        return out;\r\n    };\r\n\r\n    static rotateY(out: Float32Array, rad: number) {\r\n        let s = Math.sin(rad),\r\n            c = Math.cos(rad),\r\n            a00 = out[0],\r\n            a01 = out[1],\r\n            a02 = out[2],\r\n            a03 = out[3],\r\n            a20 = out[8],\r\n            a21 = out[9],\r\n            a22 = out[10],\r\n            a23 = out[11];\r\n\r\n        // Perform axis-specific matrix multiplication\r\n        out[0] = a00 * c - a20 * s;\r\n        out[1] = a01 * c - a21 * s;\r\n        out[2] = a02 * c - a22 * s;\r\n        out[3] = a03 * c - a23 * s;\r\n        out[8] = a00 * s + a20 * c;\r\n        out[9] = a01 * s + a21 * c;\r\n        out[10] = a02 * s + a22 * c;\r\n        out[11] = a03 * s + a23 * c;\r\n        return out;\r\n    }\r\n\r\n    static rotateX(out: Float32Array, rad: number) {\r\n        let s = Math.sin(rad),\r\n            c = Math.cos(rad),\r\n            a10 = out[4],\r\n            a11 = out[5],\r\n            a12 = out[6],\r\n            a13 = out[7],\r\n            a20 = out[8],\r\n            a21 = out[9],\r\n            a22 = out[10],\r\n            a23 = out[11];\r\n\r\n        // Perform axis-specific matrix multiplication\r\n        out[4] = a10 * c + a20 * s;\r\n        out[5] = a11 * c + a21 * s;\r\n        out[6] = a12 * c + a22 * s;\r\n        out[7] = a13 * c + a23 * s;\r\n        out[8] = a20 * c - a10 * s;\r\n        out[9] = a21 * c - a11 * s;\r\n        out[10] = a22 * c - a12 * s;\r\n        out[11] = a23 * c - a13 * s;\r\n        return out;\r\n    }\r\n\r\n    static rotateZ(out: Float32Array, rad: number) {\r\n        let s = Math.sin(rad),\r\n            c = Math.cos(rad),\r\n            a00 = out[0],\r\n            a01 = out[1],\r\n            a02 = out[2],\r\n            a03 = out[3],\r\n            a10 = out[4],\r\n            a11 = out[5],\r\n            a12 = out[6],\r\n            a13 = out[7];\r\n\r\n        // Perform axis-specific matrix multiplication\r\n        out[0] = a00 * c + a10 * s;\r\n        out[1] = a01 * c + a11 * s;\r\n        out[2] = a02 * c + a12 * s;\r\n        out[3] = a03 * c + a13 * s;\r\n        out[4] = a10 * c - a00 * s;\r\n        out[5] = a11 * c - a01 * s;\r\n        out[6] = a12 * c - a02 * s;\r\n        out[7] = a13 * c - a03 * s;\r\n        return out;\r\n    }\r\n\r\n    static rotate(out: Float32Array, rad: number, axis: Float32Array) {\r\n        let x = axis[0],\r\n            y = axis[1],\r\n            z = axis[2],\r\n            len = Math.sqrt(x * x + y * y + z * z),\r\n            s, c, t,\r\n            a00, a01, a02, a03,\r\n            a10, a11, a12, a13,\r\n            a20, a21, a22, a23,\r\n            b00, b01, b02,\r\n            b10, b11, b12,\r\n            b20, b21, b22;\r\n\r\n        if (Math.abs(len) < 0.000001) {\r\n            return null;\r\n        }\r\n\r\n        len = 1 / len;\r\n        x *= len;\r\n        y *= len;\r\n        z *= len;\r\n\r\n        s = Math.sin(rad);\r\n        c = Math.cos(rad);\r\n        t = 1 - c;\r\n\r\n        a00 = out[0];\r\n        a01 = out[1];\r\n        a02 = out[2];\r\n        a03 = out[3];\r\n        a10 = out[4];\r\n        a11 = out[5];\r\n        a12 = out[6];\r\n        a13 = out[7];\r\n        a20 = out[8];\r\n        a21 = out[9];\r\n        a22 = out[10];\r\n        a23 = out[11];\r\n\r\n        // Construct the elements of the rotation matrix\r\n        b00 = x * x * t + c;\r\n        b01 = y * x * t + z * s;\r\n        b02 = z * x * t - y * s;\r\n        b10 = x * y * t - z * s;\r\n        b11 = y * y * t + c;\r\n        b12 = z * y * t + x * s;\r\n        b20 = x * z * t + y * s;\r\n        b21 = y * z * t - x * s;\r\n        b22 = z * z * t + c;\r\n\r\n        // Perform rotation-specific matrix multiplication\r\n        out[0] = a00 * b00 + a10 * b01 + a20 * b02;\r\n        out[1] = a01 * b00 + a11 * b01 + a21 * b02;\r\n        out[2] = a02 * b00 + a12 * b01 + a22 * b02;\r\n        out[3] = a03 * b00 + a13 * b01 + a23 * b02;\r\n        out[4] = a00 * b10 + a10 * b11 + a20 * b12;\r\n        out[5] = a01 * b10 + a11 * b11 + a21 * b12;\r\n        out[6] = a02 * b10 + a12 * b11 + a22 * b12;\r\n        out[7] = a03 * b10 + a13 * b11 + a23 * b12;\r\n        out[8] = a00 * b20 + a10 * b21 + a20 * b22;\r\n        out[9] = a01 * b20 + a11 * b21 + a21 * b22;\r\n        out[10] = a02 * b20 + a12 * b21 + a22 * b22;\r\n        out[11] = a03 * b20 + a13 * b21 + a23 * b22;\r\n    }\r\n\r\n    static invert(out: Float32Array, mat ? : Float32Array) {\r\n        if (mat === undefined) mat = out; //If input isn't sent, then output is also input\r\n\r\n        let a00 = mat[0],\r\n            a01 = mat[1],\r\n            a02 = mat[2],\r\n            a03 = mat[3],\r\n            a10 = mat[4],\r\n            a11 = mat[5],\r\n            a12 = mat[6],\r\n            a13 = mat[7],\r\n            a20 = mat[8],\r\n            a21 = mat[9],\r\n            a22 = mat[10],\r\n            a23 = mat[11],\r\n            a30 = mat[12],\r\n            a31 = mat[13],\r\n            a32 = mat[14],\r\n            a33 = mat[15],\r\n\r\n            b00 = a00 * a11 - a01 * a10,\r\n            b01 = a00 * a12 - a02 * a10,\r\n            b02 = a00 * a13 - a03 * a10,\r\n            b03 = a01 * a12 - a02 * a11,\r\n            b04 = a01 * a13 - a03 * a11,\r\n            b05 = a02 * a13 - a03 * a12,\r\n            b06 = a20 * a31 - a21 * a30,\r\n            b07 = a20 * a32 - a22 * a30,\r\n            b08 = a20 * a33 - a23 * a30,\r\n            b09 = a21 * a32 - a22 * a31,\r\n            b10 = a21 * a33 - a23 * a31,\r\n            b11 = a22 * a33 - a23 * a32,\r\n\r\n            // Calculate the determinant\r\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n        if (!det) return false;\r\n        det = 1.0 / det;\r\n\r\n        out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\r\n        out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\r\n        out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\r\n        out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\r\n        out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\r\n        out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\r\n        out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\r\n        out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\r\n        out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\r\n        out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\r\n        out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\r\n        out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\r\n        out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\r\n        out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\r\n        out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\r\n        out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\r\n\r\n        return true;\r\n    }\r\n\r\n    //https://github.com/toji/gl-matrix/blob/master/src/gl-matrix/mat4.js  mat4.scalar.translate = function (out, a, v) {\r\n    static translate(out: Float32Array, x: number, y: number, z: number) {\r\n        out[12] = out[0] * x + out[4] * y + out[8] * z + out[12];\r\n        out[13] = out[1] * x + out[5] * y + out[9] * z + out[13];\r\n        out[14] = out[2] * x + out[6] * y + out[10] * z + out[14];\r\n        out[15] = out[3] * x + out[7] * y + out[11] * z + out[15];\r\n    }\r\n}\r\n\r\nexport {\r\n    Vector3,\r\n    Matrix4\r\n}","import { Matrix4, Vector3 } from \"./math\";\r\nimport { degToRad } from \"@/modules\";\r\n\r\nexport default class Transformation {\r\n\r\n    constructor() {\r\n        //identity matrix\r\n        //transform vectors\r\n        this.position = new Vector3(0, 0, 0)    //Traditional X,Y,Z 3d position\r\n        this.scale = new Vector3(1, 1, 1)       //How much to scale a mesh. Having a 1 means no scaling is done.\r\n        this.rotation = new Vector3(0, 0, 0)    //Hold rotation values based on degrees, Object will translate it to radians\r\n        this.matView = new Matrix4()            //Cache the results when calling updateMatrix\r\n        this.matNormal = new Float32Array(9)    //This is a Mat3, matrix array to hold the values is enough for what its used for\r\n\r\n        //Direction Vectors, Need 4 elements for math operations with matrices\r\n        this.forward = new Float32Array(4)      //When rotating, keep track of what the forward direction is\r\n        this.up = new Float32Array(4)           //what the up direction is, invert to get bottom\r\n        this.right = new Float32Array(4)        //what the right direction is, invert to get left\r\n    }\r\n\r\n    position: Vector3\r\n    scale: Vector3\r\n    rotation: Vector3\r\n    matView: Matrix4\r\n    matNormal: Float32Array\r\n    forward: Float32Array\r\n    up: Float32Array\r\n    right: Float32Array\r\n\r\n\r\n    updateMatrix() {\r\n        this.matView.resetMat() //Order is very important!!\r\n            .vtranslate(this.position)\r\n            .rotateX(degToRad(this.rotation.x))\r\n            .rotateY(degToRad(this.rotation.y))\r\n            .rotateZ(degToRad(this.rotation.z))\r\n            .vscale(this.scale);\r\n\r\n        //Calcuate the Normal Matrix which doesn't need translate, then transpose and inverses the mat4 to mat3\r\n        Matrix4.normalMat3(this.matNormal, this.matView.matrix);\r\n\r\n        //Determine Direction after all the transformations.\r\n        Matrix4.transformVec4(this.forward, [0, 0, 1, 0], this.matView.matrix) //Z\r\n        Matrix4.transformVec4(this.up, [0, 1, 0, 0], this.matView.matrix)      //Y\r\n        Matrix4.transformVec4(this.right, [1, 0, 0, 0], this.matView.matrix)   //X\r\n\r\n        return this.matView.matrix;\r\n    }\r\n\r\n    updateDirection() {\r\n        Matrix4.transformVec4(this.forward, [0, 0, 1, 0], this.matView.matrix)\r\n        Matrix4.transformVec4(this.up, [0, 1, 0, 0], this.matView.matrix)\r\n        Matrix4.transformVec4(this.right, [1, 0, 0, 0], this.matView.matrix)\r\n        return this\r\n    }\r\n\r\n    getModelMatrix() {\r\n        return this.matView.matrix\r\n    }\r\n\r\n    getNormalMatrix() {\r\n        return this.matNormal\r\n    }\r\n\r\n    reset() {\r\n        this.position.set(0, 0, 0)\r\n        this.scale.set(1, 1, 1)\r\n        this.rotation.set(0, 0, 0)\r\n    }\r\n}","\r\nimport { CameraControlsSettings, CameraSettings, degToRad } from \"@/modules\"\r\nimport { Matrix4 } from \"./math\"\r\nimport Transformation from \"./transformation\"\r\n\r\n//https://github.com/sketchpunk/FunWithWebGL2/tree/master/lesson_006\r\nclass Camera {\r\n  constructor(gl: WebGLRenderingContext, fov: number = CameraSettings.FIELD_OF_VIEW, near: number = CameraSettings.NEAR_PLANE, far: number = CameraSettings.FAR_PLANE) {\r\n\r\n    this.perspectiveProjection = new Float32Array(16)\r\n    this.orthoProjection = new Float32Array(16)\r\n\r\n    const ratio = gl.canvas.width / gl.canvas.height\r\n    const left = - gl.canvas.width / 2\r\n    const right = gl.canvas.width / 2\r\n    const top = gl.canvas.height / 2\r\n    const bottom = - gl.canvas.height / 2\r\n    \r\n    Matrix4.perspective(this.perspectiveProjection, fov, ratio, near, far)\r\n    Matrix4.ortho(this.orthoProjection, left, right, bottom, top, 1, 10)\r\n\r\n    this.transform = new Transformation() //Setup transform to control the position of the camera\r\n    this.viewMatrix = new Float32Array(16) //Cache the matrix that will hold the inverse of the transform.\r\n\r\n    this.mode = Camera.MODE_ORBIT //Set what sort of control mode to use.\r\n  }\r\n\r\n  transform: Transformation\r\n  perspectiveProjection: Float32Array\r\n  orthoProjection: Float32Array\r\n  viewMatrix: Float32Array\r\n  mode: number\r\n\r\n  static MODE_FREE = CameraSettings.MODE_FREE //Allows free movement of position and rotation, basicly first person type of camera\r\n  static MODE_ORBIT = CameraSettings.MODE_ORBIT //Movement is locked to rotate around the origin, Great for 3d editors or a single model viewer\r\n\r\n  panX(v: number) {\r\n    if (this.mode == Camera.MODE_ORBIT) return // Panning on the X Axis is only allowed when in free mode\r\n    this.updateViewMatrix()\r\n    this.transform.position.x += this.transform.right[0] * v\r\n    this.transform.position.y += this.transform.right[1] * v\r\n    this.transform.position.z += this.transform.right[2] * v\r\n  }\r\n\r\n  panY(v: number) {\r\n    this.updateViewMatrix()\r\n    this.transform.position.y += this.transform.up[1] * v\r\n    if (this.mode == Camera.MODE_ORBIT) return //Can only move up and down the y axix in orbit mode\r\n    this.transform.position.x += this.transform.up[0] * v\r\n    this.transform.position.z += this.transform.up[2] * v\r\n  }\r\n\r\n  panZ(v: number) {\r\n    this.updateViewMatrix()\r\n    if (this.mode == Camera.MODE_ORBIT) {\r\n      this.transform.position.z += v //orbit mode does translate after rotate, so only need to set Z, the rotate will handle the rest.\r\n    } else {\r\n      //in freemode to move forward, we need to move based on our forward which is relative to our current rotation\r\n      this.transform.position.x += this.transform.forward[0] * v\r\n      this.transform.position.y += this.transform.forward[1] * v\r\n      this.transform.position.z += this.transform.forward[2] * v\r\n    }\r\n  }\r\n\r\n  //To have different modes of movements, this function handles the view matrix update for the transform object.\r\n  updateViewMatrix() {\r\n    //Optimize camera transform update, no need for scale nor rotateZ\r\n    if (this.mode == Camera.MODE_FREE) {\r\n      this.transform.matView.resetMat()\r\n        .vtranslate(this.transform.position)\r\n        .rotateX(degToRad(this.transform.rotation.x))\r\n        .rotateY(degToRad(this.transform.rotation.y))\r\n\r\n    } else {\r\n      this.transform.matView.resetMat()\r\n        .rotateX(degToRad(this.transform.rotation.x))\r\n        .rotateY(degToRad(this.transform.rotation.y))\r\n        .vtranslate(this.transform.position)\r\n    }\r\n\r\n    this.transform.updateDirection()\r\n\r\n    //Cameras work by doing the inverse transformation on all meshes, the camera itself is a lie :)\r\n    Matrix4.invert(this.viewMatrix, this.transform.matView.matrix)\r\n\r\n    return this.viewMatrix\r\n  }\r\n\r\n}\r\n\r\nclass CameraController {\r\n  constructor(gl: WebGLRenderingContext, camera: Camera) {\r\n    const box = (gl.canvas as HTMLCanvasElement).getBoundingClientRect()\r\n    this.canvas = gl.canvas as HTMLCanvasElement //Need access to the canvas html element, main to access events\r\n    this.camera = camera //Reference to the camera to control\r\n\r\n    this.rotateRate = CameraControlsSettings.ROTATION_RATE  //How fast to rotate, degrees per dragging delta\r\n    this.panRate = CameraControlsSettings.PAN_RATE          //How fast to pan, max unit per dragging delta\r\n    this.zoomRate = CameraControlsSettings.ZOOM_RATE        //How fast to zoom or can be viewed as forward/backward movement\r\n\r\n    this.offsetX = box.left //Help calc global x,y mouse cords.\r\n    this.offsetY = box.top\r\n\r\n    this.initX = 0 //Starting X,Y position on mouse down\r\n    this.initY = 0\r\n    this.prevX = 0 //Previous X,Y position on mouse move\r\n    this.prevY = 0\r\n\r\n\t\tthis.onUpHandler = (e: MouseEvent) => this.onMouseUp(e)//Cache func reference that gets bound and unbound a lot\r\n\t\tthis.onMoveHandler = (e: MouseEvent) => this.onMouseMove(e)\r\n\r\n\t\tthis.canvas.addEventListener(CameraControlsSettings.MOUSE_DOWN, (e: MouseEvent) => this.onMouseDown(e))\t//Initializes the up and move events\r\n\t\tthis.canvas.addEventListener(CameraControlsSettings.MOUSE_WHEEL, (e: Event ) => this.onMouseWheel(e))\t  //Handles zoom/forward movement\r\n  }\r\n\r\n  canvas: HTMLCanvasElement\r\n  camera: Camera\r\n  rotateRate: number         //How fast to rotate, degrees per dragging delta\r\n  panRate: number            //How fast to pan, max unit per dragging delta\r\n  zoomRate: number           //How fast to zoom or can be viewed as forward/backward movement\r\n  offsetX: number            //Help calc global x,y mouse cords.\r\n  offsetY: number\r\n  initX: number              //Starting X,Y position on mouse down\r\n  initY: number\r\n  prevX: number              //Previous X,Y position on mouse move\r\n  prevY: number\r\n  onUpHandler:any\r\n  onMoveHandler:any\r\n\r\n  //Transform mouse x,y cords to something useable by the canvas.\r\n  getMouseVec2(e: MouseEvent) {\r\n    return {\r\n      x: e.pageX - this.offsetX,\r\n      y: e.pageY - this.offsetY\r\n    }\r\n  }\r\n\r\n\r\n  //Begin listening for dragging movement\r\n  onMouseDown(e: MouseEvent) {\r\n    this.initX = this.prevX = e.pageX - this.offsetX\r\n    this.initY = this.prevY = e.pageY - this.offsetY\r\n\r\n    this.canvas.addEventListener(CameraControlsSettings.MOUSE_UP, this.onUpHandler)\r\n    this.canvas.addEventListener(CameraControlsSettings.MOUSE_MOVE, this.onMoveHandler)\r\n  }\r\n\r\n  //End listening for dragging movement\r\n  onMouseUp(e: MouseEvent) {\r\n    this.canvas.removeEventListener(CameraControlsSettings.MOUSE_UP, this.onUpHandler)\r\n    this.canvas.removeEventListener(CameraControlsSettings.MOUSE_MOVE, this.onMoveHandler)\r\n  }\r\n\r\n  onMouseWheel(e: any) {\r\n    let delta = Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail))) //Try to map wheel movement to a number between -1 and 1\r\n    this.camera.panZ(-delta * (this.zoomRate / this.canvas.height))    //Keep the movement speed the same, no matter the height diff\r\n  }\r\n\r\n  onMouseMove(e: MouseEvent) {\r\n    let x = e.pageX - this.offsetX, //Get X,y where the canvas's position is origin.\r\n      y = e.pageY - this.offsetY,\r\n      dx = x - this.prevX,          //Difference since last mouse move\r\n      dy = y - this.prevY\r\n\r\n    //When shift is being helt down, we pan around else we rotate.\r\n    if (!e.shiftKey) {\r\n      this.camera.transform.rotation.y += dx * (this.rotateRate / this.canvas.width)\r\n      this.camera.transform.rotation.x += dy * (this.rotateRate / this.canvas.height)\r\n    } else {\r\n      this.camera.panX(-dx * (this.panRate / this.canvas.width))\r\n      this.camera.panY(dy * (this.panRate / this.canvas.height))\r\n    }\r\n\r\n    this.prevX = x\r\n    this.prevY = y\r\n  }\r\n}\r\n\r\nexport {\r\n  Camera,\r\n  CameraController\r\n}","import { ProgramEntrySettings } from \"@/modules\"\r\nimport DepthTexture from \"./Textures/depthTexture\"\r\n\r\n\r\nexport default class GLContext {\r\n    constructor(WEBGL_CANVAS_ID: string) {\r\n        const canvas = document.getElementById(WEBGL_CANVAS_ID) as HTMLCanvasElement\r\n        this.gl = canvas.getContext(ProgramEntrySettings.WEBGL_CONTEXT) as WebGLRenderingContext\r\n        this.gl ?? alert(ProgramEntrySettings.WEBGL_CONTEXT_ERROR_MESSAGE)  //user if webgl is not available\r\n        this.gl?.cullFace(this.gl.BACK)\t\t\t\t\t\t\t\t        //Back is also default\r\n        this.gl?.frontFace(this.gl.CCW)\t\t\t\t\t\t\t\t        //Dont really need to set it, its ccw by default.\r\n        this.gl?.enable(this.gl.DEPTH_TEST)\t\t\t\t\t\t\t        //Shouldn't use this, use something else to add depth detection\r\n        this.gl?.enable(this.gl.CULL_FACE)\t\t\t\t\t\t\t        //Cull back face, so only show triangles that are created clockwise\r\n        this.gl?.depthFunc(this.gl.LEQUAL)\t\t\t\t\t\t\t        //Near things obscure far things\r\n        this.gl?.blendFunc(this.gl.SRC_ALPHA, this.gl.ONE_MINUS_SRC_ALPHA)\t//Setup default alpha blending\r\n        this.canvas = canvas\r\n    }\r\n\r\n    gl: WebGLRenderingContext | null = null\r\n    rgb_32_bit = 255\r\n    alpha = 1\r\n    canvas: HTMLCanvasElement\r\n\r\n    setSize(w: number, h: number) {\r\n        //set the size of the canvas, on chrome we need to set it 3 ways to make it work perfectly.\r\n        this.canvas.style.width = w + \"px\"\r\n        this.canvas.style.height = h + \"px\"\r\n        this.canvas.width = w\r\n        this.canvas.height = h\r\n\r\n        //when updating the canvas size, must reset the viewport of the canvas \r\n        //else the resolution webgl renders at will not change\r\n        this.gl?.viewport(0, 0, w, h)\r\n        \r\n        return this\r\n    }\r\n\r\n    depthRender(depthTexture:DepthTexture){\r\n        this.gl?.bindFramebuffer(this.gl?.FRAMEBUFFER, depthTexture.depthFramebuffer)\r\n        this.gl?.viewport(0, 0, depthTexture.depthTextureSize, depthTexture.depthTextureSize)\r\n        this.gl?.clear(this.gl?.COLOR_BUFFER_BIT | this.gl?.DEPTH_BUFFER_BIT);\r\n        return this\r\n    }\r\n\r\n    //Set the size of the canvas to fill a % of the total screen.\r\n    fitScreen(wp: number, hp: number) {\r\n        return this.setSize(window.innerWidth * (wp || 1), window.innerHeight * (hp || 1))\r\n    }\r\n\r\n    setClearColor(red: number, green: number, blue: number, alpha: number = 1) {\r\n        this.gl?.clearColor(red / this.rgb_32_bit, green / this.rgb_32_bit, blue / this.rgb_32_bit, alpha)\r\n        return this\r\n    }\r\n\r\n    clearFramebuffer(){\r\n        this.gl?.bindFramebuffer(this.gl?.FRAMEBUFFER, null)\r\n        return this\r\n    }\r\n\r\n    clear() {\r\n        this.gl?.clear(this.gl?.COLOR_BUFFER_BIT | this.gl?.DEPTH_BUFFER_BIT)\r\n        return this\r\n    }\r\n\r\n    getContext() {\r\n        return this.gl\r\n    }\r\n}","import { normalizeColor } from \"@/modules\"\r\nimport { Vector3 } from \"./math\"\r\nimport { ModelShader } from \"./model\"\r\n\r\nexport default class Light {\r\n    constructor(\r\n        lightPosition: Vector3,\r\n        lightColor = normalizeColor({red:255, green:255, blue:255}),\r\n        ambientLightColor = normalizeColor({red:10, green:10, blue:10}),\r\n        specularColor = normalizeColor({red:195, green:210, blue:190}),\r\n        specularFactor = 5,\r\n        shininess = 500,\r\n    ) { \r\n        this.lightPosition = lightPosition\r\n        this.lightColor = lightColor\r\n        this.ambientLightColor = ambientLightColor\r\n        this.specularColor = specularColor\r\n        this.specularFactor = specularFactor\r\n        this.shininess = shininess\r\n    }\r\n\r\n    lightPosition: Vector3\r\n    lightColor: Float32Array\r\n    ambientLightColor: Float32Array\r\n    specularColor: Float32Array\r\n    specularFactor: number\r\n    shininess: number\r\n   \r\n\r\n    setUniforms(gl:WebGLRenderingContext, program:ModelShader): void {\r\n        gl.uniform3fv(program.lightPositionLoc, [this.lightPosition.x, this.lightPosition.y, this.lightPosition.z])\r\n        gl.uniform4fv(program.lightColorLoc, this.lightColor)\r\n        gl.uniform4fv(program.ambientLightColorLoc, this.ambientLightColor)\r\n        gl.uniform4fv(program.specularColorLoc, this.specularColor)\r\n        gl.uniform1f(program.specularFactorLoc, this.specularFactor)\r\n        gl.uniform1f(program.shininessLoc, this.shininess)\r\n    }\r\n\r\n}","import Geometry from \"./geometry\"\r\n\r\nexport default class ShaderProgram {\r\n  constructor(gl: WebGLRenderingContext, vsSource: string, fsSource: string) {\r\n\r\n    const vertexShader = this.createShader(gl, gl.VERTEX_SHADER, vsSource) as WebGLShader\r\n    const fragmentShader = this.createShader(gl, gl.FRAGMENT_SHADER, fsSource) as WebGLShader\r\n    const shaderProgram = this.createShaderProgram(gl, fragmentShader, vertexShader)\r\n    this.program = shaderProgram\r\n    this.gl = gl\r\n  }\r\n\r\n  gl: WebGLRenderingContext | null = null\r\n  vertexShader: WebGLShader | null = null\r\n  fragmentShader: WebGLShader | null = null\r\n  program: WebGLProgram\r\n\r\n\r\n  createShader(gl: WebGLRenderingContext, type: number, source: string) {\r\n    const shader = gl.createShader(type) as WebGLShader\r\n\r\n    // Send the source to the shader object\r\n    gl.shaderSource(shader, source)\r\n\r\n    // Compile the shader program\r\n    gl.compileShader(shader)\r\n\r\n    // See if it compiled successfully\r\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n      console.error('An error occurred compiling the shaders: ' + gl.getShaderInfoLog(shader))\r\n      gl.deleteShader(shader)\r\n      return null\r\n    }\r\n\r\n    return shader\r\n  }\r\n\r\n  createShaderProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\r\n\r\n    const program = gl.createProgram() as WebGLProgram\r\n\r\n    gl.attachShader(program, vertexShader)\r\n    gl.attachShader(program, fragmentShader)\r\n    gl.linkProgram(program)\r\n\r\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n      console.error(\"Error creating shader program.\", gl.getProgramInfoLog(program))\r\n      gl.deleteProgram(program)\r\n      throw new Error('Failed to link shaderProgram')\r\n    }\r\n\r\n    this.vertexShader = vertexShader\r\n    this.fragmentShader = fragmentShader\r\n\r\n    gl.detachShader(program, vertexShader)\r\n    gl.detachShader(program, fragmentShader)\r\n    gl.deleteShader(fragmentShader)\r\n    gl.deleteShader(vertexShader)\r\n\r\n    return program\r\n  }\r\n\r\n  activateShader() {\r\n    (this.gl as WebGLRenderingContext).useProgram(this.program)\r\n    return this\r\n  }\r\n\r\n  deactivateShader() {\r\n    (this.gl as WebGLRenderingContext).useProgram(null)\r\n    return this\r\n  }\r\n\r\n  dispose() {\r\n    //unbind the program if its currently active\r\n    if ((this.gl as WebGLRenderingContext).getParameter((this.gl as WebGLRenderingContext).CURRENT_PROGRAM) === this.program) {\r\n      this.deactivateShader()\r\n    }\r\n    (this.gl as WebGLRenderingContext).deleteProgram(this.program)\r\n  }\r\n\r\n  renderModel(model: Geometry) {\r\n    const gl = this.gl as WebGLRenderingContext\r\n    \r\n\t\tif(model.mesh.noCulling) gl.disable(gl.CULL_FACE)\r\n\t\tif(model.mesh.doBlending) gl.enable(gl.BLEND)\r\n\r\n\t\tgl.drawArrays(model.mesh.drawMode, 0, model.mesh.vertexCount)\r\n\r\n\t\t//Cleanup\r\n\t\tif(model.mesh.noCulling) gl.enable(gl.CULL_FACE)\r\n\t\tif(model.mesh.doBlending) gl.disable(gl.BLEND)\r\n\r\n\t\treturn this\r\n  }\r\n\r\n}","\r\nimport { MeshData } from \"@/entities\"\r\nimport Transformation from \"./transformation\"\r\nexport default class Geometry {\r\n\r\n    constructor( mesh: MeshData) {\r\n\r\n        this.mesh = mesh\r\n        this.transform = new Transformation()\r\n    }\r\n\r\n    mesh: MeshData\r\n    transform: Transformation\r\n\r\n\r\n    setScale(x: number, y: number, z: number) {\r\n        this.transform.scale.set(x, y, z)\r\n        return this\r\n    }\r\n\r\n    setPosition(x: number, y: number, z: number) {\r\n        this.transform.position.set(x, y, z)\r\n        return this\r\n    }\r\n\r\n    setRotation(x: number, y: number, z: number) {\r\n        this.transform.rotation.set(x, y, z)\r\n        return this\r\n    }\r\n\r\n    addScale(x: number, y: number, z: number) {\r\n        this.transform.scale.x += x\r\n        this.transform.scale.y += y\r\n        this.transform.scale.y += y\r\n        return this\r\n    }\r\n\r\n    addPosition(x: number, y: number, z: number) {\r\n        this.transform.position.x += x\r\n        this.transform.position.y += y\r\n        this.transform.position.z += z\r\n        return this\r\n    }\r\n\r\n    addRotation(x: number, y: number, z: number) {\r\n        this.transform.rotation.x += x\r\n        this.transform.rotation.y += y\r\n        this.transform.rotation.z += z\r\n        return this\r\n    }\r\n\r\n    preRender() {\r\n        this.transform.updateMatrix()\r\n        return this\r\n    }\r\n}","import { GLSetttings } from \"@/modules\";\r\n\r\nexport default class Vbuffer {\r\n\r\n  constructor(gl: WebGLRenderingContext, data: number[], count: number, type:string) {\r\n    this.buffer = gl.createBuffer() as WebGLBuffer;\r\n\r\n    switch (type) {\r\n      case GLSetttings.BUFFER_TYPE_ARRAY:\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);\r\n        break;\r\n\r\n      case GLSetttings.BUFFER_TYPE_ELEMENT_ARRAY:\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(data), gl.STATIC_DRAW);\r\n        break;\r\n    \r\n      default:\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);\r\n        break;\r\n    }\r\n\r\n\r\n    this.gl = gl;\r\n    this.size = data.length / count;\r\n  }\r\n\r\n  buffer: WebGLBuffer;\r\n  gl: WebGLRenderingContext;\r\n  size: number;\r\n\r\n\r\n  destroy() {\r\n    this.gl.deleteBuffer(this.buffer);\r\n  }\r\n\r\n  bindToAttribute(data: number|number[], stride: number, offset: number, size: number = this.size, type:string = GLSetttings.BUFFER_TYPE_VERTICES) {\r\n    const gl = this.gl\r\n    switch (type) {\r\n      case GLSetttings.BUFFER_TYPE_ARRAY:\r\n        gl.enableVertexAttribArray(data as number);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n        gl.vertexAttribPointer(data as number, size, gl.FLOAT, false, stride, offset);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER,null);\r\n        break;\r\n\r\n      case GLSetttings.BUFFER_TYPE_ELEMENT_ARRAY:\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.buffer);\r\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(data as number[]), gl.STATIC_DRAW);\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null);\r\n        break;\r\n    \r\n      default:\r\n        gl.enableVertexAttribArray(data as number);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\r\n        gl.vertexAttribPointer(data as number, size, gl.FLOAT, false, stride, offset);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER,null);\r\n        break;\r\n    }\r\n  }\r\n\r\n\r\n\r\n}","import ShaderProgram from '../shaderProgram';\r\nimport { GLSetttings } from \"@/modules\";\r\nimport Geometry from '../geometry';\r\nimport DepthTexture from '../Textures/depthTexture';\r\nimport ObjLoader from '../objLoader';\r\nimport { MeshData } from '@/entities';\r\nimport Vbuffer from '../vbuffer';\r\nimport { Camera } from '../camera';\r\n\r\n\r\nclass DirectionalShadowShader {\r\n\tconstructor(gl: WebGLRenderingContext, camera: Camera) {\r\n\t\tconst vertexShader = `#version 300 es\r\n\t\t\tlayout(location=8) in vec3 a_position;\r\n\r\n\t\t\tuniform mat4 u_mVMatrix;\r\n\t\t\tuniform mat4 u_cameraViewMatrix;\r\n\t\t\tuniform mat4 u_oMatrix;\r\n\r\n\t\t\tmat4 m_worldMatrix;\r\n\t\t\tmat4 m_viewProjectionMatrix;\r\n\t\t\tmat4 m_worldViewProjectionMatrix;\r\n\r\n\t\t\tvoid main(void){\r\n\r\n\t\t\t\tm_worldMatrix = u_mVMatrix;\r\n\t\t\t\tm_viewProjectionMatrix = u_oMatrix * u_cameraViewMatrix;\r\n\t\t\t\tm_worldViewProjectionMatrix = m_viewProjectionMatrix * m_worldMatrix;\r\n\r\n\t\t\t\tgl_Position = m_worldViewProjectionMatrix * vec4(a_position, 1.0);\r\n\t\t\t}`;\r\n\r\n\t\tconst fragmentShader = `#version 300 es\r\n\t\t\tprecision mediump float;\r\n\t\t\tuniform vec4 u_color;\r\n\r\n\t\t\tout vec4 finalColor;\r\n\r\n\t\t\tvoid main(void) {\r\n\t\t\t\tfinalColor = u_color;\r\n\t\t\t}`;\r\n\r\n\t\t\r\n\t\tconst shaderProgram = new ShaderProgram(gl,vertexShader, fragmentShader)\r\n\r\n\t\tshaderProgram.activateShader()\r\n\r\n\t\tthis.positionLoc = gl.getAttribLocation(shaderProgram.program  as WebGLProgram, GLSetttings.ATTR_POSITION_NAME)\r\n\t\t\r\n\t\tthis.modelViewMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_MODEL_MAT) as WebGLUniformLocation\r\n\t\tthis.orthoMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_ORTHO_MAT) as WebGLUniformLocation\r\n        this.cameraMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_CAMERA_MAT) as WebGLUniformLocation\r\n\t\tthis.uColorLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_COLOR) as WebGLUniformLocation\r\n\r\n\t\tthis.orthoProjectionMatrix = camera.orthoProjection\r\n\t\tthis.viewModelMatrix = camera.viewMatrix\r\n\t\tthis.shaderProgram = shaderProgram\r\n\r\n\t\tshaderProgram.deactivateShader()\r\n\t}\r\n\r\n\tpositionLoc: number\r\n\tshaderProgram: ShaderProgram\r\n\r\n\tmodelViewMatrixLoc: WebGLUniformLocation\r\n\torthoMatrixLoc: WebGLUniformLocation\r\n\tcameraMatrixLoc: WebGLUniformLocation\r\n\tuColorLoc: WebGLUniformLocation\r\n\r\n\torthoProjectionMatrix:Float32Array\r\n\tviewModelMatrix:Float32Array\r\n\r\n\tsetUniforms(gl:WebGLRenderingContext, model: Geometry) {\r\n\t\tthis.shaderProgram.activateShader()\r\n        gl.uniformMatrix4fv(this.orthoMatrixLoc , false, this.orthoProjectionMatrix)\r\n\t\tgl.uniformMatrix4fv(this.cameraMatrixLoc , false, this.viewModelMatrix)\r\n\t\tgl.uniformMatrix4fv(this.modelViewMatrixLoc, false, model.transform.getModelMatrix())\r\n\t\tgl.uniform4fv(this.uColorLoc, new Float32Array([0.0, 0.0, 0.0, 1.0]))\r\n\r\n\t\treturn this\r\n    }\r\n}\r\n\r\n\r\nclass DirectionalShadow {\r\n\r\n\tconstructor() {}\r\n\r\n\tstatic createGeometry(gl: WebGLRenderingContext, shaderProgram: DirectionalShadowShader, vertices: ObjLoader) {\r\n\t\treturn new Geometry(DirectionalShadow.createMesh(gl, shaderProgram, vertices));\r\n\t}\r\n\r\n\tstatic createMesh(gl: WebGLRenderingContext, shaderProgram: DirectionalShadowShader, vertices: ObjLoader) {\r\n\r\n\t\tconst vertexCount = vertices.vertexCount();\r\n\r\n\t\tconst mesh: MeshData = {\r\n\t\t\tpositions: new Vbuffer(gl, vertices.positions(), vertexCount, GLSetttings.BUFFER_TYPE_ARRAY),\r\n\t\t\tdrawMode: gl.TRIANGLES,\r\n\t\t\tvertexCount,\r\n\t\t}\r\n\r\n\t\tmesh.positions?.bindToAttribute(shaderProgram.positionLoc as number, GLSetttings.DEFAULT_STRIDE, GLSetttings.DEFAULT_OFFSET);\r\n\r\n\t\treturn mesh;\r\n\t}\r\n\r\n\r\n\r\n}\r\n\r\n\r\nexport {\r\n\tDirectionalShadowShader,\r\n\tDirectionalShadow\r\n}","import Geometry from '../../geometry';\r\nimport Vbuffer from '../../vbuffer';\r\nimport ShaderProgram from '../../shaderProgram';\r\nimport { MeshData } from '@/entities';\r\nimport { GLSetttings } from '@/modules';\r\nimport { Camera } from '../../camera';\r\n\r\nclass InfiniteGridShader{\r\n\tconstructor(gl: WebGLRenderingContext, camera:Camera, lightViewCamera:Camera){\t\r\n\t\tconst vertexShader = `#version 300 es\r\n            layout(location=5) in vec3 a_position;\r\n\r\n\t\t\tuniform mat4 u_mVMatrix;\r\n\t\t\tuniform mat4 u_cameraViewMatrix;\r\n\t\t\tuniform mat4 u_pMatrix;\r\n\r\n\t\t\tvec3 unprojectPoint(float x, float y, float z, mat4 view, mat4 projection) {\r\n                mat4 viewInv = inverse(view);\r\n                mat4 projInv = inverse(projection);\r\n                vec4 unprojectedPoint =  viewInv * projInv * vec4(x, y, z, 1.0);\r\n                return unprojectedPoint.xyz / unprojectedPoint.w;\r\n            }\r\n\r\n\t\t\tout vec3 nearPoint;\r\n\t\t\tout vec3 farPoint;\r\n\t\t\tout mat4 fragView;\r\n            out mat4 fragProj;\r\n\r\n\t\t\tout vec3 vertexPosition;\r\n\r\n\t\t\tvoid main(void){\r\n\t\t\t\tvec3 p = a_position;\r\n\r\n\t\t\t\tfragView = u_cameraViewMatrix;\r\n                fragProj = u_pMatrix;\r\n\t\t\t\tnearPoint = unprojectPoint(p.x, p.y, 0.0, u_cameraViewMatrix, u_pMatrix).xyz;\r\n\t\t\t\tfarPoint = unprojectPoint(p.x, p.y, 1.0, u_cameraViewMatrix, u_pMatrix).xyz;\r\n\r\n\t\t\t\tvertexPosition = p.xyz;\r\n\t\t\t\tgl_Position = vec4(p, 1.0);\r\n\r\n\t\t\t}`;\r\n\r\n\t\tconst fragmentShader = `#version 300 es\r\n\t\t\tprecision highp float;\r\n\r\n\t\t\tin vec3 vertexPosition;\r\n\t\t\tin vec3 nearPoint;\r\n            in vec3 farPoint;\r\n            in mat4 fragView;\r\n            in mat4 fragProj;\r\n\r\n\t\t\t// computes Z-buffer depth value, and converts the range.\r\n\t\t\tfloat computeDepth(vec3 pos) {\r\n\t\t\t\t// get the clip-space coordinates\r\n\t\t\t\tvec4 clip_space_pos = fragProj * fragView * vec4(pos.xyz, 1.0);\r\n\r\n\t\t\t\t// get the depth value in normalized device coordinates\r\n\t\t\t\tfloat clip_space_depth = clip_space_pos.z / clip_space_pos.w;\r\n\r\n\t\t\t\t// and compute the range based on gl_DepthRange settings (not necessary with default settings, but left for completeness)\r\n\t\t\t\tfloat far = gl_DepthRange.far;\r\n\t\t\t\tfloat near = gl_DepthRange.near;\r\n\r\n\t\t\t\tfloat depth = (((far-near) * clip_space_depth) + near + far) / 2.0;\r\n\r\n\t\t\t\t// and return the result\r\n\t\t\t\treturn depth;\r\n\t\t\t}\r\n\r\n\t\t\t\r\n\t\t\tvec4 grid(vec3 fragPos3D, float scale) {\r\n                vec2 coord = fragPos3D.xz * scale;\r\n                vec2 derivative = fwidth(coord);\r\n                vec2 grid = abs(fract(coord - 0.5) - 0.5) / derivative;\r\n                float line = min(grid.x, grid.y);\r\n                float minimumz = min(derivative.y, 1.0);\r\n                float minimumx = min(derivative.x, 1.0);\r\n\t\t\t\tvec3 refColor = vec3(47.0, 56.0, 70.0);\r\n\t\t\t\tvec3 gridColor = vec3(1.0 - min(line, 1.0));\r\n                vec4 color = vec4(mix(refColor, gridColor, 1.0), 1.0);\r\n                return color;\r\n            }\r\n\r\n            out vec4 finalColor;\r\n\r\n\t\t\tvoid main(void){\r\n\r\n                float t = -nearPoint.y / (farPoint.y - nearPoint.y);\r\n                vec3 fragPos3D = nearPoint + t * (farPoint - nearPoint);\r\n\t\r\n\t\t\t\tfloat isIntersect = (t > 0.0) ? 1.0 : 0.0;\r\n\t\t\t\tfloat linearFieldSection = 0.02 * length(fragPos3D.xz);\r\n\t\t\t\tfloat fading = min(1.0, 1.5 - linearFieldSection);\r\n\r\n\t\t\t\tvec4 gridPattern = grid(fragPos3D, 0.5);\r\n\t\t\t\t\r\n\t\t\t\tvec4 outColor = gridPattern;\r\n\r\n\t\t\t\tfinalColor = outColor * isIntersect;\r\n\t\t\t\tfinalColor *= fading;\r\n\r\n\t\t\t\tgl_FragDepth = computeDepth(fragPos3D);\r\n            }`;\t\t\t\t\t\t\t\t\t\t\r\n\r\n\t\tconst shaderProgram = new ShaderProgram(gl, vertexShader, fragmentShader);\r\n\r\n\t\tshaderProgram.activateShader()\r\n\r\n\t\tthis.positionLoc = gl.getAttribLocation(shaderProgram.program as WebGLProgram, GLSetttings.ATTR_POSITION_NAME)\r\n\r\n\t\tthis.modelViewMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_MODEL_MAT) as WebGLUniformLocation\r\n\t\tthis.perspectiveMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_PERSPECTIV_MAT) as WebGLUniformLocation\r\n\t\tthis.cameraMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_CAMERA_MAT) as WebGLUniformLocation\r\n\t\tthis.uColorLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_COLOR) as WebGLUniformLocation\r\n\t\t//Cleanup\r\n\t\tshaderProgram.deactivateShader()\r\n\r\n\t\tthis.perspectiveProjectionMatrix = camera.perspectiveProjection\r\n\t\tthis.orthoProjectionMatrix = camera.orthoProjection\r\n\t\tthis.viewModelMatrix = camera.viewMatrix\r\n\t\tthis.lightViewModelMatrix = lightViewCamera\r\n\t\tthis.shaderProgram = shaderProgram\r\n\t}\r\n\r\n\tpositionLoc: number\r\n  \r\n\tmodelViewMatrixLoc: WebGLUniformLocation\r\n\tperspectiveMatrixLoc: WebGLUniformLocation\r\n\tcameraMatrixLoc: WebGLUniformLocation\r\n\r\n\tuColorLoc: WebGLUniformLocation\r\n\r\n\tperspectiveProjectionMatrix: Float32Array\r\n\torthoProjectionMatrix:Float32Array\r\n\tviewModelMatrix:Float32Array\r\n\r\n\tlightViewModelMatrix:Camera\r\n\r\n\tshaderProgram: ShaderProgram\r\n\r\n\t\r\n\tsetUniforms(gl:WebGLRenderingContext, model: Geometry) {\r\n\t\tthis.shaderProgram.activateShader()\r\n\r\n\t\tgl.uniformMatrix4fv(this.perspectiveMatrixLoc, false, this.perspectiveProjectionMatrix)\r\n\t\tgl.uniformMatrix4fv(this.cameraMatrixLoc , false, this.viewModelMatrix)\r\n\t\tgl.uniformMatrix4fv(this.modelViewMatrixLoc, false, model.transform.getModelMatrix())\r\n\r\n\t\treturn this\r\n    }\r\n}\r\n\r\n\r\nclass InfiniteGrid {\r\n\r\n  \tconstructor() {}\r\n\r\n   \tstatic createGeometry(gl: WebGLRenderingContext, shaderProgram: InfiniteGridShader){ \r\n    \treturn  new Geometry( InfiniteGrid.createMesh(gl, shaderProgram)); \r\n  \t}\r\n\r\n   static createMesh(gl: WebGLRenderingContext, shaderProgram: InfiniteGridShader) {\r\n\r\n\t\tconst verts = [\r\n\t\t\t1,-1,0,\r\n\t\t\t1,1,0,\r\n\t\t\t-1,-1,0,\r\n\t\t\t-1,1,0,\r\n\t\t\t-1,-1,0,\r\n\t\t\t1,1,0,\r\n\t\t]\r\n\r\n\t\tconst vertexCount = verts.length/3;\r\n\t\tconst strideLen = Float32Array.BYTES_PER_ELEMENT * 3; //Stride Length is the Vertex Size for the buffer in Bytes\r\n\t\tconst mesh: MeshData = {\r\n\t\t\tpositions : new Vbuffer(gl, verts, vertexCount, GLSetttings.BUFFER_TYPE_ARRAY),\r\n\t\t\tdrawMode : gl.TRIANGLES,\r\n\t\t\tvertexCount,\r\n\t\t}\r\n\r\n\t\tmesh.positions?.bindToAttribute(shaderProgram.positionLoc as number, strideLen, GLSetttings.DEFAULT_OFFSET, GLSetttings.GRID_VECTOR_SIZE);\r\n\r\n\t\treturn mesh;\r\n  \t}\r\n}\r\n\r\nexport {\r\n\tInfiniteGridShader,\r\n\tInfiniteGrid\r\n}","import Geometry from './geometry'\r\nimport Texture from './Textures/texture'\r\nimport Vbuffer from './vbuffer'\r\nimport ShaderProgram from './shaderProgram'\r\nimport ObjLoader from './objLoader'\r\nimport { MeshData } from '@/entities'\r\nimport { GLSetttings } from '@/modules'\r\nimport { Camera } from './camera'\r\nimport { Matrix4 } from './math'\r\n\r\nclass ModelShader{\r\n\tconstructor(gl: WebGLRenderingContext, sceneViewCamera:Camera, lightViewCamera:Camera){\t\r\n\t\tconst vertexShader = `#version 300 es\r\n\t\t\tin vec3 a_position;\r\n\t\t\tin vec3 a_norm;\r\n\t\t\tin vec2 a_texCoord;\r\n\r\n\t\t\tuniform vec3 u_lightPosition;\r\n\t\t\tuniform vec3 u_cameraPosition;\r\n\r\n\t\t\tuniform mat4 u_mVMatrix;\r\n\t\t\tuniform mat4 u_cameraViewMatrix;\r\n\t\t\tuniform mat4 u_pMatrix;\r\n\t\t\tuniform mat4 u_textureMatrix;\r\n\r\n\t\t\tmat4 m_worldMatrix;\r\n\t\t\tmat4 m_viewProjectionMatrix;\r\n\t\t\tmat4 m_worldViewProjectionMatrix;\r\n\t\t\t\r\n\t\t\tout vec3 v_normal;\r\n\t\t\tout vec3 v_surfaceToLight;\r\n\t\t\tout vec3 v_surfaceToCamera;\r\n\r\n\t\t\tout vec2 v_texCoord;\r\n\t\t\tout vec4 v_projectedTexcoord;\r\n\r\n\t\t\tvoid main(void){\r\n\r\n\t\t\t\tm_worldMatrix = u_mVMatrix;\r\n\t\t\t\tm_viewProjectionMatrix = u_pMatrix * u_cameraViewMatrix;\r\n\t\t\t\tm_worldViewProjectionMatrix = m_viewProjectionMatrix * m_worldMatrix;\r\n\r\n\t\t\t\tgl_Position = m_worldViewProjectionMatrix * vec4(a_position, 1.0);\r\n\t\t\t\t\r\n\t\t\t\tv_normal = (u_cameraViewMatrix * vec4(a_norm, 0.0)).xyz;\r\n\r\n\t\t\t\tvec3 v_surfaceWorldPosition = (m_worldMatrix * vec4(a_position, 1.0)).xyz;\r\n\t\t\t\tv_surfaceToLight = u_lightPosition - v_surfaceWorldPosition;\r\n\t\t\t\tv_surfaceToCamera = u_cameraPosition - v_surfaceWorldPosition;\r\n\r\n\t\t\t\tv_texCoord = a_texCoord;\r\n\t\t\t\tv_projectedTexcoord = u_textureMatrix * vec4(v_surfaceWorldPosition, 1.0);\r\n\t\t\t}`;\r\n\r\n\t\tconst fragmentShader = `#version 300 es\r\n\t\t\tprecision highp float;\r\n\r\n\t\t\tin vec2 v_texCoord;\r\n\t\t\tin vec4 v_projectedTexcoord;\r\n\t\t\tin vec3 v_normal;\r\n\t\t\tin vec3 v_surfaceToLight;\r\n\t\t\tin vec3 v_surfaceToCamera;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tuniform vec4 u_lightColor;\r\n\t\t\tuniform vec4 u_ambientLightColor;\r\n\t\t\tuniform sampler2D u_diffuse;\r\n\t\t\tuniform sampler2D u_projectedTexture;\r\n\t\t\tuniform vec4 u_specularColor;\r\n\t\t\tuniform float u_shininess;\r\n\t\t\tuniform float u_specularFactor;\r\n\t\t\tuniform float u_bias;\r\n\t\t\tuniform vec3 u_reverseLightDirection;\r\n\r\n\t\t\tvec4 lit(float l ,float h, float m) {\r\n\t\t\t\treturn vec4(\r\n\t\t\t\t\t1.0,\r\n\t\t\t\t\tabs(l),\r\n\t\t\t\t\t(l > 0.0) ? pow(max(0.0, h), m) : 0.0,\r\n\t\t\t\t\t1.0\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tout vec4 finalColor;\r\n\r\n\t\t\tvoid main(void) {\r\n\r\n\t\t\t\tvec3 normal = normalize(v_normal);\r\n\r\n\t\t\t\tfloat light = dot(normal, u_reverseLightDirection);\r\n\r\n\t\t\t\tvec3 projectedTexcoord = v_projectedTexcoord.xyz / v_projectedTexcoord.w;\r\n\t\t\t\tfloat currentDepth = projectedTexcoord.z + u_bias;\r\n\r\n\t\t\t\tbool inRange =+\r\n\t\t\t\t\tprojectedTexcoord.x >= 0.0 &&+\r\n\t\t\t\t\tprojectedTexcoord.x <= 1.0 &&+\r\n\t\t\t\t\tprojectedTexcoord.y >= 0.0 &&+\r\n\t\t\t\t\tprojectedTexcoord.y <= 1.0;\r\n\r\n\t\t\t\tfloat projectedDepth = texture(u_projectedTexture, projectedTexcoord.xy).r;\r\n\t\t\t\tfloat shadowLight = (inRange && projectedDepth <= currentDepth) ? 0.0 : 1.0;\r\n\r\n\t\t\t\tvec3 surfaceToLightDirection = normalize(v_surfaceToLight);\r\n\t\t\t\tvec3 surfaceToCameraDirection = normalize(v_surfaceToCamera);\r\n\t\t\t\tvec3 halfVector = normalize(surfaceToLightDirection + surfaceToCameraDirection);\r\n\r\n\t\t\t\tvec4 diffuseColor = texture(u_diffuse, v_texCoord);\r\n\t\t\t\tvec4 litR = lit(dot(normal, surfaceToLightDirection), dot(normal, halfVector), u_shininess);\r\n\t\t\t\t\r\n\t\t\t\tvec4 mult1 = diffuseColor * litR.y;\r\n\t\t\t\tvec4 mult2 = diffuseColor * u_ambientLightColor;\r\n\t\t\t\tvec4 mult3 = u_specularColor * litR.z * u_specularFactor;\r\n\t\t\t\tvec4 mult4 = u_lightColor * ( mult1 + mult2 + mult3);\r\n\r\n\t\t\t\tvec4 outColor = mult4 * vec4(\r\n\t\t\t\t\tdiffuseColor.rgb * light * shadowLight,\r\n\t\t\t\t\tdiffuseColor.a);\r\n\r\n\r\n\t\t\t\tfinalColor = outColor;\r\n\t\t\t}`;\t\t\t\t\t\t\t\t\t\t\t\r\n\r\n\t\tconst shaderProgram = new ShaderProgram(gl, vertexShader, fragmentShader)\r\n\r\n\t\tshaderProgram.activateShader()\r\n\r\n\t\tthis.positionLoc = gl.getAttribLocation(shaderProgram.program as WebGLProgram, GLSetttings.ATTR_POSITION_NAME)\r\n\t\tthis.texCoordLoc = gl.getAttribLocation(shaderProgram.program as WebGLProgram, GLSetttings.ATTR_UV_NAME)\r\n\t\tthis.normalLoc = gl.getAttribLocation(shaderProgram.program as WebGLProgram, GLSetttings.ATTR_NORMAL_NAME)\r\n\r\n\t\tthis.modelViewMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_MODEL_MAT) as WebGLUniformLocation\r\n\t\tthis.perspectiveMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_PERSPECTIV_MAT) as WebGLUniformLocation\r\n\t\tthis.cameraMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_CAMERA_MAT) as WebGLUniformLocation\r\n\t\tthis.projectedTextureLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_PROJECTED_TEXTURE) as WebGLUniformLocation\r\n\t\tthis.textureMatrixLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_TEXTURE_MAT) as WebGLUniformLocation\r\n\t\tthis.reverseLightDirectionLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_REVERSE_LIGHT_DIRECTION_MAT) as WebGLUniformLocation\r\n\r\n\t\tthis.diffuseLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_DIFFUSE) as WebGLUniformLocation\r\n\t\tthis.ambientLightColorLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_LIGHT_AMBIENT) as WebGLUniformLocation\r\n\t\tthis.lightPositionLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_LIGHT_POSITION) as WebGLUniformLocation\r\n\t\tthis.cameraPositionLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_CAMERA_POSITION) as WebGLUniformLocation\r\n\t\tthis.shininessLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_CAMERA_SHININESS) as WebGLUniformLocation\r\n\t\tthis.lightColorLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_LIGHT_COLOR) as WebGLUniformLocation\r\n\t\tthis.specularColorLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_SPECULAR_COLOR) as WebGLUniformLocation\r\n\t\tthis.specularFactorLoc = gl.getUniformLocation(shaderProgram.program as WebGLProgram, GLSetttings.UNI_SPECULAR_FACTOR) as WebGLUniformLocation\r\n\t\t//Cleanup\r\n\t\tshaderProgram.deactivateShader()\r\n\r\n\t\tthis.perspectiveProjectionMatrix = sceneViewCamera.perspectiveProjection\r\n\t\tthis.orthoProjectionMatrix = sceneViewCamera.orthoProjection\r\n\t\tthis.viewModelMatrix = sceneViewCamera.viewMatrix\r\n\t\tthis.lightViewCamera = lightViewCamera\r\n\t\tthis.sceneViewCamera = sceneViewCamera\r\n\t\tthis.shaderProgram = shaderProgram\r\n\t}\r\n\r\n\tpositionLoc: number\r\n\tnormalLoc: number\r\n\ttexCoordLoc: number\r\n  \r\n\tmodelViewMatrixLoc: WebGLUniformLocation\r\n\tperspectiveMatrixLoc: WebGLUniformLocation\r\n\tcameraMatrixLoc: WebGLUniformLocation\r\n\ttextureMatrixLoc: WebGLUniformLocation\r\n\t\r\n\r\n\tdiffuseLoc: WebGLUniformLocation\r\n\tprojectedTextureLoc: WebGLUniformLocation\r\n\tambientLightColorLoc: WebGLUniformLocation\r\n\tlightPositionLoc: WebGLUniformLocation\r\n\tcameraPositionLoc: WebGLUniformLocation\r\n\tshininessLoc: WebGLUniformLocation\r\n\tlightColorLoc: WebGLUniformLocation\r\n\tspecularColorLoc: WebGLUniformLocation\r\n\tspecularFactorLoc: WebGLUniformLocation\r\n\treverseLightDirectionLoc: WebGLUniformLocation\r\n\r\n\tperspectiveProjectionMatrix: Float32Array\r\n\torthoProjectionMatrix: Float32Array\r\n\tviewModelMatrix: Float32Array\r\n\tlightViewMatrix: Float32Array|null = null\r\n\r\n\tlightViewCamera: Camera\r\n\tsceneViewCamera: Camera\r\n\r\n\tshaderProgram: ShaderProgram\r\n\r\n\r\n\tsetUniforms(gl:WebGLRenderingContext, model: Geometry) {\r\n\t\tthis.shaderProgram.activateShader()\r\n\r\n\t\tconst lightViewMatrix = this.getLightWorldMatrix(this.lightViewCamera, model) as Float32Array\r\n\r\n\t\tgl.uniformMatrix4fv(this.perspectiveMatrixLoc, false, this.perspectiveProjectionMatrix)\r\n\t\tgl.uniformMatrix4fv(this.cameraMatrixLoc , false, this.viewModelMatrix)\r\n\t\tgl.uniformMatrix4fv(this.textureMatrixLoc , false, this.getTextureMatrix(lightViewMatrix))\r\n\t\tgl.uniformMatrix4fv(this.modelViewMatrixLoc, false, model.transform.getModelMatrix())\t//Set the transform, so the shader knows where the model exists in 3d space\r\n\t\tgl.uniform3fv(this.cameraPositionLoc, this.sceneViewCamera.transform.position.getFloatArray())\r\n\t\tgl.uniform3fv(this.reverseLightDirectionLoc, lightViewMatrix.slice(8, 11))\r\n\t\treturn this\r\n    }\r\n\r\n\tgetTextureMatrix(lightWorldMatrix:Float32Array){\r\n\t\tlet textureMatrix = Matrix4.identity();\r\n\t\tMatrix4.translate(textureMatrix, 0.5, 0.5, 0.5);\r\n\t\tMatrix4.scale(textureMatrix, 0.5, 0.5, 0.5);\r\n\t\tMatrix4.mult(textureMatrix, textureMatrix, this.orthoProjectionMatrix)\r\n\t\tlet inverted:any = []\r\n\t\tMatrix4.invert(inverted, lightWorldMatrix)\r\n\t\tMatrix4.mult(textureMatrix, textureMatrix, inverted)\r\n\t\treturn textureMatrix\r\n\t}\r\n\r\n\tgetLightWorldMatrix(lightViewCamera:Camera, model:Geometry){\r\n\t\t// first draw from the POV of the light\r\n\t\treturn Matrix4.lookAt(\r\n\t\t\t[lightViewCamera.transform.position.x, lightViewCamera.transform.position.y, lightViewCamera.transform.position.z], // position\r\n\t\t\t[model.transform.position.x, model.transform.position.y, model.transform.position.z], // target\r\n\t\t\t[0, 1, 0],// up\r\n\t\t);\r\n\t}\r\n\r\n\r\n}\r\n\r\n\r\nclass Model {\r\n\r\n  constructor() {}\r\n\r\n  static  createGeometry(gl: WebGLRenderingContext, shaderProgram: ModelShader, vertices: ObjLoader, texture: Texture){ \r\n    return  new Geometry(Model.createMesh(gl, shaderProgram, vertices, texture)); \r\n  }\r\n\r\n  static createMesh(gl: WebGLRenderingContext, shaderProgram: ModelShader, vertices: ObjLoader, texture: Texture) {\r\n\r\n    const vertexCount = vertices.vertexCount();\r\n\t\r\n    const mesh: MeshData = {\r\n      positions : new Vbuffer(gl, vertices.positions(), vertexCount, GLSetttings.BUFFER_TYPE_ARRAY),\r\n      normals: new Vbuffer(gl, vertices.normals(), vertexCount, GLSetttings.BUFFER_TYPE_ARRAY),\r\n      uvs: new Vbuffer(gl, vertices.uvs(), vertexCount, GLSetttings.BUFFER_TYPE_ARRAY),\r\n      texture,\r\n      drawMode : gl.TRIANGLES,\r\n      vertexCount,\r\n    }\r\n\r\n    mesh.positions?.bindToAttribute(shaderProgram.positionLoc as number, GLSetttings.DEFAULT_STRIDE, GLSetttings.DEFAULT_OFFSET)\r\n    mesh.normals?.bindToAttribute(shaderProgram.normalLoc as number, GLSetttings.DEFAULT_STRIDE, GLSetttings.DEFAULT_OFFSET)\r\n    mesh.uvs?.bindToAttribute(shaderProgram.texCoordLoc as number, GLSetttings.DEFAULT_STRIDE, GLSetttings.DEFAULT_OFFSET)\r\n\r\n    return mesh;\r\n  }\r\n\r\n}\r\n\r\nexport {\r\n\tModelShader,\r\n\tModel\r\n}","import { Normal, Vector, Surface, UV, Vertex } from \"@/entities\";\r\nimport { NEW_LINE, ObjTypes, BACKSLASH, SPACE, SurfaceStruct, Vec2Struct, Vec3Struct, VertexStruct } from \"@/modules\";\r\n\r\nexport default class ObjLoader {\r\n\r\n    constructor(surfaces: Array < Surface > ) {\r\n        this.surfaces = surfaces;\r\n    }\r\n\r\n    surfaces: Surface[] = [];\r\n\r\n    static async parseOBJ(src: string) {\r\n\r\n        const POSITION = ObjTypes.V\r\n        const NORMAL = ObjTypes.VN\r\n        const UV = ObjTypes.VT\r\n        const SURFACE = ObjTypes.F\r\n\r\n        const lines = src.split(NEW_LINE);\r\n        const positions: Vector[] = [];\r\n        const uvs: UV[] = [];\r\n        const normals: Normal[] = [];\r\n        const surfaces: Surface[] = [];\r\n       \r\n        for(let item of lines){\r\n            // Match each line of the file against various RegEx-es\r\n            const lineItems = item.trim().split(SPACE)\r\n            const type = lineItems[0]\r\n\r\n            if ( POSITION === type) {\r\n                // Add new vertex position\r\n                positions.push(Vec3Struct(parseFloat(lineItems[1]), parseFloat(lineItems[2]), parseFloat(lineItems[3])))\r\n            } else if (NORMAL  === type) {\r\n                // Add new vertex normal\r\n                normals.push(Vec3Struct(parseFloat(lineItems[1]), parseFloat(lineItems[2]), parseFloat(lineItems[3])))\r\n            } else if (UV === type) {\r\n                // Add new texture mapping point\r\n                uvs.push(Vec2Struct(parseFloat(lineItems[1]), 1 - parseFloat(lineItems[2])))\r\n            } else if (SURFACE === type) {\r\n                let isQuad = false\r\n                let shouldExit = false\r\n                let size = 4\r\n                // Add new face\r\n                const vertices: Vertex[] = [];\r\n\r\n                // conditionally detect and parse quads to triangle\r\n                for (let i = 1; i < size; i ++) {\r\n                    if (lineItems.length>size && !shouldExit) {\r\n                        size+=1\r\n                    }else if (i===4 && !isQuad) {\r\n                        i = 3\r\n                        size+=1\r\n                        isQuad = true\r\n                    }else if (i===5 && isQuad) {\r\n                        i=1\r\n                        isQuad = false\r\n                        shouldExit = true\r\n                    } else if(i===2 && shouldExit){\r\n                        break\r\n                    }\r\n                    const part = lineItems[i].split(BACKSLASH)\r\n                    const position = positions[parseInt(part[0]) - 1]\r\n                    const uv = uvs[parseInt(part[1]) - 1]\r\n                    const normal = normals[parseInt(part[2]) - 1]\r\n                    vertices.push(VertexStruct(position, normal, uv))\r\n                }\r\n                \r\n                // split tesselated quads as individual surfaces\r\n                if (vertices.length > 3) {\r\n                    const triagle1 = vertices.slice(0, 3)\r\n                    const triangle2 = vertices.slice(3)\r\n                    surfaces.push(SurfaceStruct(triagle1))\r\n                    surfaces.push(SurfaceStruct(triangle2))\r\n                }else{\r\n                    surfaces.push(SurfaceStruct(vertices))\r\n                }\r\n            }\r\n        }\r\n\r\n        return new ObjLoader(surfaces);\r\n    }\r\n\r\n    static async loadOBJ(url: string) {\r\n        const response = await fetch(url);\r\n        const data = await response.text()\r\n        const [surfaces] = await Promise.all([ObjLoader.parseOBJ(data)]);\r\n        return surfaces;\r\n    }\r\n\r\n    vertexCount() {\r\n        return this.surfaces.length * 3;\r\n    }\r\n\r\n    positions() {\r\n        const result: number[] = [];\r\n        this.surfaces.forEach(function (surface: Surface) {\r\n            surface.vertices.forEach(function (vertex: Vertex) {\r\n                const v = vertex.position;\r\n                result.push(v.x, v.y, v.z);\r\n            })\r\n        })\r\n\r\n        return result;\r\n    }\r\n\r\n    normals() {\r\n        const result: number[] = [];\r\n        this.surfaces.forEach(function (surface: Surface) {\r\n            surface.vertices.forEach(function (vertex: Vertex) {\r\n                const v = vertex.normal;\r\n                result.push(v.x, v.y, v.z);\r\n            })\r\n        })\r\n\r\n        return result;\r\n    }\r\n\r\n    uvs() {\r\n        const result: number[] = [];\r\n        this.surfaces.forEach(function (surface: Surface) {\r\n            surface.vertices.forEach(function (vertex: Vertex) {\r\n                const v = vertex.uv;\r\n                result.push(v.x, v.y);\r\n            })\r\n        })\r\n\r\n        return result;\r\n    }\r\n}","export default class Texture {\r\n\r\n    constructor(gl: WebGLRenderingContext, image: HTMLImageElement) {\r\n        const texture = gl.createTexture() as WebGLTexture\r\n        gl.bindTexture(gl.TEXTURE_2D, texture as WebGLTexture)\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image)\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR)\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\r\n        gl.generateMipmap(gl.TEXTURE_2D)\r\n\r\n        this.gl = gl\r\n    }\r\n\r\n    gl: WebGLRenderingContext;\r\n\r\n    // Asynchronously load an image\r\n    static async loadTexture(gl: WebGLRenderingContext, url: string): Promise < Texture > {\r\n        const image = new Image()\r\n        image.src = url\r\n        await image.decode()\r\n        const result = new Texture(gl, image)\r\n        return result\r\n    }\r\n\r\n}","import { PATH_ASSETS_OBJ, PATH_ASSETS_TEXTURE, ProgramEntrySettings } from \"./modules\"\r\nimport { Camera, CameraController } from \"./core/camera\"\r\nimport GLContext from \"./core/glContext\"\r\nimport Light from \"./core/light\"\r\nimport { Vector3 } from \"./core/math\"\r\nimport { DirectionalShadow, DirectionalShadowShader } from \"./core/shadows/directional\"\r\nimport { InfiniteGrid, InfiniteGridShader } from \"./core/primitives/grid/infinite\"\r\nimport { Model, ModelShader } from \"./core/model\"\r\nimport DepthTexture from \"./core/Textures/depthTexture\"\r\nimport ObjLoader from \"./core/objLoader\"\r\nimport Texture from \"./core/Textures/texture\"\r\n\r\n\r\n(async()=>{\r\n    const glContext = new GLContext(ProgramEntrySettings.WEBGL_CANVAS_ID)\r\n    const [wp, wh] = [0.95, 0.90]\r\n    glContext.fitScreen(wp, wh).setClearColor(13, 17, 23, 1.0).clear()\r\n    const gl = glContext.getContext() as WebGLRenderingContext\r\n\r\n    const lightViewPosition = new Vector3(0, 2.5, 3)\r\n    const lightView = new Light(lightViewPosition)\r\n\r\n    const lightCameraView = new Camera(gl as WebGLRenderingContext)\r\n    lightCameraView.transform.position.set(lightViewPosition.x, lightViewPosition.y, lightViewPosition.z)\r\n\r\n    const vertices = await ObjLoader.loadOBJ(ProgramEntrySettings.PATH_ASSETS_OBJ)\r\n    const texture = await Texture.loadTexture(gl, ProgramEntrySettings.PATH_ASSETS_TEXTURE)\r\n    //const depthTexture = new DepthTexture(gl, ProgramEntrySettings.DEPTH_TEXTURE_SIZE)\r\n\r\n    const directionalShadowShader = new DirectionalShadowShader(gl as WebGLRenderingContext, lightCameraView)\r\n    const directionalShadow = DirectionalShadow.createGeometry(gl, directionalShadowShader, vertices)\r\n    \r\n    const camera = new Camera(gl as WebGLRenderingContext)\r\n    camera.transform.position.set(0, 0.5, 1.5)\r\n    new CameraController(gl as WebGLRenderingContext, camera)\r\n\r\n    const infiniteGridShader = new InfiniteGridShader(gl as WebGLRenderingContext, camera, lightCameraView)\r\n    const infiniteGrid = InfiniteGrid.createGeometry(gl, infiniteGridShader)\r\n\r\n    const modelShader = new ModelShader(gl as WebGLRenderingContext, camera, lightCameraView)\r\n    const model = Model.createGeometry(gl, modelShader, vertices, texture)\r\n    model.setScale(0.0035,0.0035,0.0035).setRotation(0,30,0)\r\n\r\n    const loop = () => {\r\n        lightCameraView.updateViewMatrix()\r\n        // rendering scene depth\r\n        //glContext.depthRender(depthTexture)\r\n        directionalShadowShader.setUniforms(gl, directionalShadow.preRender()).shaderProgram\r\n            .renderModel(directionalShadow.preRender())\r\n\r\n        glContext.clearFramebuffer().fitScreen(wp, wh).clear()\r\n\r\n        camera.updateViewMatrix()\r\n\r\n         infiniteGridShader.setUniforms(gl, infiniteGrid.preRender()).shaderProgram\r\n            .renderModel(infiniteGrid.preRender())\r\n\r\n        modelShader.setUniforms(gl, model.preRender())\r\n            .shaderProgram.renderModel(model.preRender())\r\n\r\n        lightView.setUniforms(gl, modelShader)\r\n\r\n        requestAnimationFrame(loop)\r\n    }\r\n    loop()\r\n})()"],"sourceRoot":""}